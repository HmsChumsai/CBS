//DO NOT MODIFY  Batch Filter for ACN,CIF extraction|ZBSWEEP||||||ZCONVRPT|PID='ACN' or PID='CID'||100|32000||0|||10|10|0||0||0
---------- REVHIST ------ Section marker

---------- OPEN    ------ Section marker
	do SYSVAR^SCADRV0()
---------- SCHINIT ------ Section marker

---------- SCHEXEC ------ Section marker

---------- SCHPOST ------ Section marker

---------- SCHEXIT ------ Section marker

---------- THRINIT ------ Section marker

---------- THREXEC ------ Section marker

---------- EXEC    ------ Section marker
	
	if PID='ACN' do ACN(SEQ)
	if PID='CID' do CID(SEQ)
	
	quit
	
ACN(CID)

	type String ZGRP 
	type Number ZTYPE
	type RecordACN acn = Db.getRecord("ACN","CID=:CID")
	if acn.cls = "L" set ^ZCONVEXT("ACNEXT",SEQ)="" 
	else do {
		set ZGRP=acn.grp
		set ZTYPE=acn.type
		if $D(^XDTJ(TJD-1,SEQ)) set ^ZCONVEXT("ACNEXT",CID)="" quit
		if $D(^DTJFM(TJD-1,"D",ZGRP,ZTYPE,CID)) set ^ZCONVEXT("ACNEXT",CID)="" quit
	}
	quit
	
CIF(ACN)

	type Date ZTJD
	type String ZSEQ
	set ZSEQ=$O(^CIFH(ACN,""),-1)
	set ZTJD=ZSEQ.piece("|",1)
	if ZTJD=TJD set ^ZCONVEXT("CIFEXT",ACN)=""
	
	quit
	
---------- THREXIT ------ Section marker
