//DO NOT MODIFY  Fix DAYENDINP for DEP account|ZFIXDAYE|||||||1
	
	/* Created By Ravipong.Ch 2012/04/17
	*/
	

001

	type Number ZFIXID = 500
	kill ^ZFIXL(ZFIXID)

	do SYSVAR^SCADRV0()
	
	type DbSet ds = Db.selectDbSet("DEP","CLS='D' AND GRP='CD' AND TYPE=3003")
	while ds.next() do {
		
		type String ZIPF,OIPF
		type Number CID
		type Date ZMLD,OINP,ZINP
		
		type RecordDEP dep = ds.getRecord("DEP")

		if dep.zstatcd'=0 quit
		if dep.dftmdt'="K470" quit
		if dep.ipf'="1MAE" quit

		set CID = dep.cid

		set OIPF=dep.ipf
		set OINP=dep.inp
		set ZMLD=dep.mld.toString("DD/MM/YEAR")
		set ZMLD=ZMLD.piece("/",1)
		set ZIPF="1MA"_ZMLD
		set ZINP=%SystemDate.nextFreqDate(ZIPF)
		
		set dep.ipf=ZIPF
		set dep.inp=ZINP
		set ^DAYEND(ZINP,"INP",CID,0)=""
		
		do dep.save()
		
		set ^ZFIXL(ZFIXID,"MAIN","OK",CID)=OIPF_"|"_ZIPF_"|"_OINP.toString("DD/MM/YEAR")_"|"_ZINP.toString("DD/MM/YEAR")
	}

	quit
	

BOD

	type Date ZTJD

	do SYSVAR^SCADRV0()
	
	set ZTJD=%SystemDate.toString("DD/MM/YEAR")
	type DbSet ds = Db.selectDbSet("DEP","MLD=:%SystemDate")
	while ds.next() do {

		type Date ZIPF

		type RecordDEP dep = ds.getRecord("DEP")

		if dep.type'=3003 quit
		if dep.ipf'="1MAE" quit

		set ZIPF="1MA"_ZTJD.piece("/",1)
		set ZINP=ZTJD.nextFreqDate(ZIPF)
		set dep.ipf=ZIPF
		set dep.inp=ZINP
		set ^DAYEND(ZINP,"INP",CID,0)=""
		
		do dep.save()
	}
	
	quit
	