//DO NOT MODIFY  All bank branch number in Cheque Clearin|ZBCHBKBR||||||ZBKBRCH|||100|32000||0|||10|10|0||0||0
---------- REVHIST ------ Section marker

---------- OPEN    ------ Section marker

	kill ^TMP("ZBKBRCH")
	do READ


---------- SCHINIT ------ Section marker

---------- SCHEXEC ------ Section marker

---------- SCHPOST ------ Section marker

---------- SCHEXIT ------ Section marker

---------- THRINIT ------ Section marker

	do SYSVAR^SCADRV0()
	
---------- THREXEC ------ Section marker

---------- EXEC    ------ Section marker

	do Runtime.rollback()
	type Number ZBK,ZBRCD
	set ZBK		=BK
	set ZBRCD	=BRCD
	do PROC(ZBK,ZBRCD)
	quit

PROC(ZBK,ZBRCD)

	type String zdata,ClearingHouseCodeI,ClearingHouseCodeII,ActiveStatus
	type ResultSet rs = Db.select("DATA","ZBKBRCH","BK=:ZBK and BRCD=:ZBRCD")
	
	set ClearingHouseCodeI	=output.piece("|",1)
	set ClearingHouseCodeII	=output.piece("|",2)
	set ActiveStatus	=output.piece("|",3)
	
	type RecordZUTBLBKBRCH ZBKBRCH = Db.getRecord("ZUTBLBKBRCH","BK=:ZBK,BRCD=ZBRCD",1)
	set ZBKBRCH.BK=ZBK
	set ZBKBRCH.BRCD=ZBRCD
	set ZBKBRCH.CHCD1=ClearingHouseCodeI
	set ZBKBRCH.CHCD2=ClearingHouseCodeII
	set ZBKBRCH.ACTIVE=ActiveStatus
	set ZBKBRCH.UPDDT = %SystemDate
	do ZBKBRCH.setAuditFlag()
	do ZBKBRCH.save()
		

	quit
READ

	type IO in =Class.new("IO")
	set in.fileName =$$TRNLNM^%ZFUNC("SCAU_SPOOL")_"/TESTZBCHBKBRCH.txt"
	set in.openParams ="READ"
	set in.recordSize =1024
	do in.open()
	
	type Number EXIT
	set EXIT=0

	for  set REC =in.read() { quit:EXIT
		type Number BankNumber,BranchNumber
		type String ClearingHouseCodeI,ClearingHouseCodeII,ActiveStatus,output
		set output=""
		if REC["H01" quit
		if REC["T01" set EXIT=1 quit
		set BankNumber=$E(REC,1,3)
		set BranchNumber=$E(REC,4,7)
		set ClearingHouseCodeI=$E(REC,8,12)
		set ClearingHouseCodeII=$E(REC,13,17)
		set ActiveStatus=$E(REC,18,18)
		set output.piece("|",1)=ClearingHouseCodeI
		set output.piece("|",2)=ClearingHouseCodeII
		set output.piece("|",3)=ActiveStatus
		set ^TMP("ZBKBRCH",BankNumber,BranchNumber)=output

	}

	do in.close()

	quit



---------- THREXIT ------ Section marker
