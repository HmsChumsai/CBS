//DO NOT MODIFY  Utility for CIF Extract|ZEXTUTIL|||||||1


	/*
	ORIG: Ravipong Chumsai Na Ayuthaya - 15/12/2011
	DESC: CMS Conversion-Extraction Utility
	*/


	do SYSVAR^SCADRV0()

CIFEXT()
	
	new ZFID,tWRITE,ZDATA
	set ZPID = "ZEXTCMS"
	set ZTJD = %SystemDate
	//set ZEXTDAT = $$DAT^%ZM(ZTJD,"YEARMMDD")
	type IO io=Class.new("IO")
	set io.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_CIF_"_ZEXTDAT_".TXT"
	set io.openParams="NEWV/WRITE"
	set io.recordSize = 1024
	do io.open()
	//Setup Header
	
	set tWRITE = "ACN"_"|"_"THAI_TITLE"_"|"_"THAI_FNAME"_"|"_"THAI_LNAME"_"|"_"THAI_MNAME"_"|"_"CITIZEN_ID"_"|"_"TAX_ID"_"|"_"LEGAL_ADDR1"
	set tWRITE = tWRITE_"|"_"LEGAL_ADDR2"_"|"_"LEGAL_ADDR3"_"|"_"LEGAL_TAMBOL_CD"_"|"_"LEGAL_AMPHUR_CD"_"|"_"LEGAL_PROVINCE_CD"
	set tWRITE = tWRITE_"|"_"LEGAL_COUNTRY_CD"_"|"_"|"_"LEGAL_POSTAL_CD"_"|"_"HOME_PHONE"_"|"_"MOBILE_PHONE"_"|"_"OFFICE_PHONE"
	set tWRITE = tWRITE_"|"_"OFFICE_PHONE_EXT"_"|"_"JURISTIC_ID"_"|"_"MAILING_ADDR1"_"|"_"MAILING_ADDR2"_"|"_"MAILING_ADDR3"
	set tWRITE = tWRITE_"|"_"MAILING_TAMBOL_CD"_"|"_"MAILING_AMPHUR_CD"_"|"_"MAILING_PROVINCE_CD"_"|"_"MAILING_COUNTRY_CD"
	set tWRITE = tWRITE_"|"_"MAILING_POSTAL_CD"_"|"_"OFFICE_ADDR1"_"|"_"OFFICE_ADDR3"_"|"_"OFFICE_ADDR2"_"|"_"OFFICE_TAMBOL_CD"
	set tWRITE = tWRITE_"|"_"OFFICE_AMPHUR_CD"_"|"_"OFFICE_PROVINCE_CD"_"|"_"OFFICE_COUNTRY_CD"_"|"_"OFFICE_POSTAL_CD"
	set tWRITE = tWRITE_"|"_"MARITAL_STATUS"_"|"_"SEX"_"|"_"DATE_OF_BIRTH"_"|"_"FAX_NUMBER"_"|"_"EMAIL"_"|"_"CUST_CD"_"|"_"CUST_TYPE"_"|"_"PASSPORT_NUMBER"
	
	do io.write(tWRITE)
	
	
	set ZDATA=""
	
	
	type ResultSet rs = Db.select("DATA","TMPRPT1","PID=:ZPID")
	while rs.next() do { 
		
		set ZDATA = rs.getCol(1).piece("|",1,35)
		do io.write(ZDATA)
		
		}
	
	do io.close()
	
	quit
	
ACNEXT()	
	
	new ZFID,tWRITE,ZDATA
	set ZPID = "ZEXTCMS2"
	set ZTJD = %SystemDate
	//set ZEXTDAT = $$DAT^%ZM(ZTJD,"YEARMMDD")
	set ZDATA=""
	type IO io=Class.new("IO")
	set io.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ACN_"_ZEXTDAT_".TXT"
	set io.recordSize = 1024
	set io.openParams="NEWV/WRITE"
	do io.open()
	
	set tWRITE = "CID"_"|"_"PRODUCT_CLASS"_"|"_"PRODUCT_GRP"_"|"_"PRODUCT_GRP_DESC"_"|"_"PRODUCT_TYPE"_"|"_"PRODUCT_TYPE_DESC"_"|"_"ACCT_NAME"
	set tWRITE = tWRITE_"|"_"PRIMARY_CIF"_"|"_"ACCT_STATUS"_"|"_"ACCT_STATUS_DESC"_"|"_"OUTS_BAL"_"|"_"AVAIL_BAL"
	set tWRITE = tWRITE_"|"_"MASTER_ACCT_NO"_"|"_"ACCT_SUBTYPE"_"|"_"MARKET_CD"_"|"_"MARKET_CD_DESC"_"|"_"LIMIT_AMT"_"|"_"DT_OPENED"
	set tWRITE = tWRITE_"|"_"DT_CLOSED"_"|"_"OWNER_BR"_"|"_"OWNER_BR_DESC"_"|"_"INT_RECEIVE"_"|"_"INT_SUSPENSE"
	set tWRITE = tWRITE_"|"_"LEGAL_ID"_"|"_"TOTAL_DUE"_"|"_"MISC_CHARGE"_"|"_"LATE_CHARGE_AMT"
	set tWRITE = tWRITE_"|"_"INT_PASS_DUE"_"|"_"PRIN_PASS_DUE"_"|"_"LOAN_CLASS"_"|"_"RESCIDENCE_CLASS"_"|"_"ACCT_SUBTYPE_DESC"_"|"_"DATE_OF_NOTE"_"|"_"OD_LIMIT TOTAL_LOAN_BAL"_"|"_"UNPAID_FEE"
	
	do io.write(tWRITE)
	
	type ResultSet rs = Db.select("DATA","TMPRPT1","PID=:ZPID")
	
	while rs.next() do { 
		
		set ZDATA = rs.getCol(1)
		do io.write(ZDATA)
		}
	
	do io.close()
				
	quit

	
ZCOLEXT()
	
	do SYSVAR^SCADRV0()
	
	kill ^TMP("ZRPT1")
	kill ^TMP("ZRPT5")
	type Date ZTJD
	new ZPID,tWRITE,ZDATA,ZDATA2,ZRSCOL,ZCNT,ztmp,zlength,ZTMP2DATA
	set ZPID = "ZCONVCOL"
	//set ZTJD = %SystemDate
	//set ZEXTDAT = $$DAT^%ZM(ZTJD,"YEARMMDD")	
		
	set ZRPT1="ZRPT1"
	set ZRPT4="ZRPT4"
	set ZRPT5="ZRPT5"
	type IO io=Class.new("IO")
	set io.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_COL_"_ZEXTDAT_".TXT"
	set io.recordSize = 2048
	set io.openParams="NEWV/WRITE"
	do io.open()
	
	type IO io2=Class.new("IO")
	set io2.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCOLOWNLINK_"_ZEXTDAT_".TXT"
	set io2.recordSize = 1024
	set io2.openParams="NEWV/WRITE"
	do io2.open()
	
	
	
	set tWRITE = "AMPHUR"_"|"_"AO"_"|"_"APDCODE"_"|"_"APPBOO"_"|"_"APPBY"_"|"_"APPDT"_"|"_"APPOFF1"_"|"_"APPOFF2"_"|"_"APPOFF3"_"|"_"APPTID"_"|"_"APPVAL"
	set tWRITE = tWRITE_"|"_"ASDATE"_"|"_"BKNUMBER"_"|"_"BLASTID"_"|"_"BLDCODE"_"|"_"BLDNAME"_"|"_"BLDNUM"_"|"_"BLDTYPE"_"|"_"BLDVAL"_"|"_"BOO"
	set tWRITE = tWRITE_"|"_"BOOTFR"_"|"_"BOTCODE"_"|"_"BOTRSKRT"_"|"_"BSOI"_"|"_"BSTRTID"_"|"_"BUILDNO"_"|"_"CACN"_"|"_"CC"_"|"_"CCRDT"_"|"_"CCRNUM"
	set tWRITE = tWRITE_"|"_"CERNO"_"|"_"CID"_"|"_"CMDCD"_"|"_"COLL"_"|"_"COLSUBT"_"|"_"COLTYP"_"|"_"CONDPAR"_"|"_"CONVDT"_"|"_"CRCD"_"|"_"DATETRF"
	set tWRITE = tWRITE_"|"_"DESC"_"|"_"DOB"_"|"_"DOCLCT"_"|"_"DOD"_"|"_"ENGCAP"_"|"_"EXTRSKR"_"|"_"FLOOR"_"|"_"GRPNO"_"|"_"GTEL"_"|"_"INSREQ"_"|"_"KTBRKR"_"|"_"LNDINFO"
	set tWRITE = tWRITE_"|"_"LNDNO"_"|"_"LNDVAL"_"|"_"LNDVOL1"_"|"_"LNDVOL2"_"|"_"LNDVOL3"_"|"_"LNDVOL4"_"|"_"LOC1"_"|"_"LOC2"_"|"_"LOC3"_"|"_"LQCD"_"|"_"LRTRVDT"
	set tWRITE = tWRITE_"|"_"MCODE1"_"|"_"MCODE2"_"|"_"NONCRM"_"|"_"OPRIMKEY"_"|"_"OWNLNDVOL1"_"|"_"OWNLNDVOL2"_"|"_"OWNLNDVOL3"_"|"_"OWNLNDVOL4"_"|"_"OWNPORTN"
	set tWRITE = tWRITE_"|"_"PACN"_"|"_"PAGENO"_"|"_"PARTLFLG"_"|"_"PAYPARTY"_"|"_"PCHPRICE"_"|"_"PCOLVAL"_"|"_"PERSONID"_"|"_"PROVINCE"_"|"_"RAVANG"
	set tWRITE = tWRITE_"|"_"REASON"_"|"_"REMARKS"_"|"_"RESPUNIT"_"|"_"RIGHBAL"_"|"_"RIGHVAL"_"|"_"RMAREA"_"|"_"RMKPORTN"_"|"_"RMNUMBER"_"|"_"ROAD"
	set tWRITE = tWRITE_"|"_"RSCD"_"|"_"RULCOST"_"|"_"SEQNO"_"|"_"SHRHLDRG"_"|"_"SHRTNAME"_"|"_"STCKNO"_"|"_"STOREY"_"|"_"SUBBOT"_"|"_"SYMBOL"_"|"_"TAMBOL"
	set tWRITE = tWRITE_"|"_"TOTPORTN"_"|"_"UNITCD"_"|"_"USEDSTDT"_"|"_"SEFULIF"_"|"_"ZATEEXP"_"|"_"ZATEISSUEDT"_"|"_"ZATEISSUER"_"|"_"ZATENUM"_"|"_"ZCERTBAL"
	set tWRITE = tWRITE_"|"_"ZCERTCID"_"|"_"ZCERTGRP"_"|"_"ZCERTID"_"|"_"ZCERTLOTH"_"|"_"ZCERTLOTL"_"|"_"ZCERTPERIOD"_"|"_"ZCERTUNIT"_"|"_"ZLGISSUEDT"_"|"_"ZLGNUM"_"|"_"ZRADUR"_"|"_"ZRAEXP"_"|"_"ZRAISSUER"_"|"_"ZRANUM"_"|"_"ZRATYPE"
	set tWRITE = tWRITE_"|"_"BONDTYPE"_"|"_"BONDCODE"_"|"_"BONDNAME"_"|"_"ISSYEAR"_"|"_"BSEQ"_"|"_"BOWNNAME"_"|"_"BEXPDATE"_"|"_"BINTRATE"_"|"_"BUPRICE"
	set tWRITE = tWRITE_"|"_"MKDATE"_"|"_"MKPRICE"_"|"_"TOTBNVAL"_"|"_"LISTED"_"|"_"SENIORITY"_"|"_"APPAMT"_"|"_"SHRTNAME"_"|"_"STCKTYP"_"|"_"STCKNAME"
	set tWRITE = tWRITE_"|"_"ISSNAME"_"|"_"TAXID"_"|"_"ISSDATE"_"|"_"NOSHARE"_"|"_"PARPRC"_"|"_"PARD"_"|"_"BKPRICE"_"|"_"BKDATE"_"|"_"ISSRSKRT"_"|"_"STCKTYP2"_"|"_"RSKWOCL"_"|"_"STCKSHR"
	
	
	
	do io.write(tWRITE)
	
	
	set tWRITE = "ACN"_"|"_"COLL"_"|"_"PAROWNFLG|"
	
	do io2.write(tWRITE)
	set i = 0
	
	type ResultSet rs = Db.select("DATA,KEY1","TMPRPT1","PID=:ZPID")
	//first 1000
	while rs.next() do { 
		
		
		set (ZDATA,ZDATA2,ZRSCOL,ZSUBBOTDES,ZCNT,ztmp,ZTMP2DATA,ZTMP5DATA)=""	
		set ZRSCOL	= rs.getCol(2)
		set ZDATA 	= rs.getCol(1)
		set ZBOO	= ZDATA.piece("|",20)
		set ZCOLTYP 	= ZDATA.piece("|",36)
		set ZCOLSUBT	= ZDATA.piece("|",35)
		set ZBOTCD	= ZDATA.piece("|",22)
		set ZSUBBOTCD	= ZDATA.piece("|",98)
		set ZAMT	= ZDATA.piece("|",11)
		set ZCOLLID	= ZDATA.piece("|",34)
		//set ZPACN	= ZDATA.piece("|",73)
		set ZCOLL	= ZDATA.piece("|",34)
		set APPRAISEDBY = ZDATA.piece("|",5)
		set APPRAISEDDT = ZDATA.piece("|",6).toString("DD/MM/YEAR")
		set APPRAISALVAL = ZDATA.piece("|",11)
		set ZDETAIL	= ""
				
	
		set (ZBRNAME,ZCOLTYPDES,ZSUBBOTDES,ZCOLSUBDESC)="N/A"
		
		
		if Db.isDefined("UTBLBRCD","BRCD=:ZBOO") do {
			type RecordUTBLBRCD zbr = Db.getRecord("UTBLBRCD","BRCD=:ZBOO")
			set ZBRNAME = zbr.desc
		}
		if Db.isDefined("ZUTBLCOLTYP","COLCD=:ZCOLTYP") do {
			type RecordZUTBLCOLTYP coldesc = Db.getRecord("ZUTBLCOLTYP","COLCD=:ZCOLTYP")  
			set ZCOLTYPDESC=coldesc.desc
		}
		if Db.isDefined("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT") do {
			type RecordZUTBLCOLSUBT colsubdesc = Db.getRecord("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT")
			set ZCOLSUBDESC = colsubdesc.desc
		}
		

		
		type ResultSet botdesc = Db.select("DESC","ZUTBLSUBBOT","BOTCODE=:ZBOTCD AND SUBBOT=:ZSUBBOTCD")
		if 'botdesc.isEmpty(),botdesc.next() set ZSUBBOTDES=botdesc.getCol(1)
		
		type ResultSet rscol = Db.select("ACN,COLL,PAROWNFLG","ZCOLOWNLINK","COLL=:ZRSCOL")
		while rscol.next() do {
			set ZACN=rscol.getCol(1)
			type RecordTMPRPT5 rpt5 = Db.getRecord("TMPRPT5","PID='ZRPT5',ZBOO,ZCOLTYP,ZCOLSUBT,ZCOLLID,ZACN",1)
			type RecordCIF cif = Db.getRecord("CIF","ACN=:rscol.getCol(1)") 
			set ZTMP5DATA.piece("|",1) = ZBRNAME
			set ZTMP5DATA.piece("|",2) = ZCOLTYPDES
			set ZTMP5DATA.piece("|",3) = ZCOLSUBDESC
			set ZTMP5DATA.piece("|",4) = rscol.getCol(2)	//COLL
			set ZTMP5DATA.piece("|",5) = ZACN
			set ZTMP5DATA.piece("|",6) = cif.fname_"-"_cif.lnm
			
			set rpt5.DATA = ZTMP5DATA
			do rpt5.save()
			
			set ZDATA2 = rscol.getCol(1)_"|"_rscol.getCol(2)_"|"_rscol.getCol(3)
			do io2.write(ZDATA2)
		}
		
			if ZSUBBOTCD="" set ZSUBBOTCD="N/A"
			if ZBOTCD=""    set ZBOTCD="N/A"
			if ZBOO="" 	set ZBOO="N/A"
			if ZCOLTYP=""	set ZCOLTYP="N/A"
			if ZCOLSUBT=""	set ZCOLSUBT="N/A"
			
			
			
			
		type RecordTMPRPT5 rpt2 = Db.getRecord("TMPRPT5","PID=:ZRPT1,ZBOO,ZCOLTYP,ZCOLSUBT,ZBOTCD,ZSUBBOTCD",1)
		set ZTMP2DATA.piece("|",1) = ZBRNAME
		set ZTMP2DATA.piece("|",2) = ZCOLTYPDESC
		set ZTMP2DATA.piece("|",3) = ZCOLSUBDESC
		set ZTMP2DATA.piece("|",4) = ZSUBBOTDES
		set ZTMP2DATA.piece("|",5) = rpt2.DATA.piece("|",5)+1
		set ZTMP2DATA.piece("|",6) = rpt2.DATA.piece("|",6)+ZAMT
		set rpt2.DATA		   = ZTMP2DATA		
		do rpt2.save()			
		do io.write(ZDATA)
		
			
	}
	
		
	do io.close()	
	do io2.close()
			
	quit

ZCTRCTEXT()
	
	do SYSVAR^SCADRV0()	
	kill ^TMP("ZRPT2")	
	kill ^TMP("ZRPT3")
	kill ^TMP("ZRPT6")
	kill ^TMP("ZRPT7")
	kill ^TMP("ZRPT8")
	kill ^TMP("ZRPT9")
	kill ^TMP("ZTMP3")
		
	new ZPID,tWRITE,ZDATA1,ZDATA2,ZDATA3,ZDATA4,ZTMP,ZCID,ZACN
	set ZPID = "ZCONVCNT"
	//set TJD = %Systemdate
	//set ZEXTDAT = $$DAT^%ZM(TJD,"YEARMMDD")
	
	
	type IO io1=Class.new("IO")
	set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCT_"_ZEXTDAT_".TXT"
	set io1.openParams="NEWV/WRITE"
	set io1.recordSize = 1024
	do io1.open()
	set tWRITE = "BOO"_"|"_"CC"_"|"_"CONTRREL"_"|"_"CONVDT"_"|"_"CRTDATE"_"|"_"CRTUSER"_"|"_"CTRCT"_"|"_"CTRCTDT"_"|"_"CTRSTAT"_"|"_"MCTRCT"
	set tWRITE = tWRITE_"|"_"PLDGAMT"_"|"_"PLDGSEQ"_"|"_"RELDATE"_"|"_"REMARKS"_"|"_"RESPUNIT"
	do io1.write(tWRITE)
	
	type IO io2=Class.new("IO")
	set io2.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTACN_"_ZEXTDAT_".TXT"
	set io2.openParams="NEWV/WRITE"
	set io2.recordSize = 1024
	do io2.open()
	set tWRITE = "CID"_"|"_"CTRCT"
	do io2.write(tWRITE)
	
	type IO io3=Class.new("IO")
	set io3.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTCIF_"_ZEXTDAT_".TXT"
	set io3.openParams="NEWV/WRITE"
	set io3.recordSize = 1024
	do io3.open()
	set tWRITE = "ACN"_"|"_"CTRCT"
	do io3.write(tWRITE)
	
	type IO io4=Class.new("IO")
	set io4.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTCOL_"_ZEXTDAT_".TXT"
	set io4.openParams="NEWV/WRITE"
	set io4.recordSize = 1024
	do io4.open()
	set tWRITE = "CTRCT"_"|"_"COLL"_"|"_"CCSTAT"_"|"_"PLDGVAL"_"|"_"RELDATE"_"|"_"PLDGAMT"_"|"_"CRTDATE"_"|"_"CRTUSER"
	
	do io4.write(tWRITE)
	
	set ZPOINTER = $O(^TMP("ZCONVCNT",""))
	type Date ZCTRCTDT,ZRELDATE
	
	while 'ZPOINTER.isNull() do {
		
		set (ZDATA1,ZDATA2,ZDATA3,ZDATA4,ZCID,ZACN,rpt2DATA,rpt3DATA,rpt6DATA,rpt7DATA,rpt8DATA,rpt9DATA)=""
		set ZTMP = ^TMP("ZCONVCNT",ZPOINTER)
		set ZPOINTER = $O(^TMP("ZCONVCNT",ZPOINTER))

		set ZBOO 	= $P(ZTMP,"|",1)
         	set ZTYP 	= $P(ZTMP,"|",3)
         	set ZCTRCTDT	= $P(ZTMP,"|",8)
         	set ZSTAT 	= $P(ZTMP,"|",9)
         	set ZMCTRCT	= $P(ZTMP,"|",10)
         	set ZAMT	= $P(ZTMP,"|",11)
         	set ZRELDATE	= $P(ZTMP,"|",13)	
		
		set ZCTRCT = ZTMP.piece("|",7)
		
		set (ZBRNAME,ZCTRTYPDES,ZSTATDESC)="N/A"
		
		
		if Db.isDefined("UTBLBRCD","BRCD=:ZBOO") do {
			type RecordUTBLBRCD zbr = Db.getRecord("UTBLBRCD","BRCD=:ZBOO")
			set ZBRNAME = zbr.desc
		}
		if Db.isDefined("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT") do {
			type RecordZUTBLCNTSTAT CNTSTAT = Db.getRecord("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT")  
			set ZSTATDESC=CNTSTAT.desc
		}
		if Db.isDefined("ZUTBLCONTREL","CONTRREL=:ZTYP") do {
			type RecordZUTBLCONTREL CONTRREL = Db.getRecord("ZUTBLCONTREL","CONTRREL=:ZTYP")
			set ZCTRTYPDES = CONTRREL.desc
		}
		
		
         	type ResultSet rscol = Db.select("COLL","ZCTRCTCOL","ZCTRCTCOL.CTRCT=:ZCTRCT")					
		while rscol.next() do {			
			set (ZCOLTYPDES,ZCOLSUBDESC)="N/A"
			set ZRSCOL = rscol.getCol(1)	
			type RecordZCOL zcol = Db.getRecord("ZCOL","COLL=:ZRSCOL")
		        set ZCOLTYP	= zcol.COLTYP
		        set ZCOLSUBT	= zcol.COLSUBT
			        
			
			if Db.isDefined("ZUTBLCOLTYP","COLCD=:ZCOLTYP") do {
				type RecordZUTBLCOLTYP coldesc = Db.getRecord("ZUTBLCOLTYP","COLCD=:ZCOLTYP")  
				set ZCOLTYPDESC=coldesc.desc
			}
			if Db.isDefined("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT") do {
				type RecordZUTBLCOLSUBT colsubdesc = Db.getRecord("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT")
				set ZCOLSUBDESC = colsubdesc.desc
			}
		       
		        type RecordTMPRPT5 tmp3 = Db.getRecord("TMPRPT5","PID='ZTMP3',ZBOO,ZTYP,ZSTAT,ZCOLTYP,ZCOLSUBT",1)								
			
			set tmp3DATA.piece("|",1)  = ZCOLTYPDESC
			set tmp3DATA.piece("|",2)  = ZCOLSUBDESC
			set tmp3DATA.piece("|",3)  = tmp3.DATA+1
			set tmp3.DATA = tmp3DATA
			do tmp3.bypassSave()
			
			type RecordTMPRPT4 rpt9 = Db.getRecord("TMPRPT4","PID='ZRPT9',ZBOO,ZTYP,ZSTAT,ZCTRCT",1)
			set rpt9DATA.piece("|",1)	= ZBRNAME
			set rpt9DATA.piece("|",2)	= ZCTRTYPDES
			set rpt9DATA.piece("|",3)	= ZSTATDESC
			set rpt9DATA.piece("|",4)	= ZCOLTYP
			set rpt9DATA.piece("|",5)	= ZCOLTYPDES
			set rpt9DATA.piece("|",6)	= ZCOLSUBT
			set rpt9DATA.piece("|",7)	= ZCOLSUBDESC
			set rpt9DATA.piece("|",8)	= ZRSCOL
			set rpt9.DATA = rpt9DATA
			do rpt9.bypassSave()
		}
					
		
		type ResultSet data2 = Db.select("CID","ZCTRCTACN","CTRCT=:ZCTRCT")
		while data2.next() do {
			
			set ZCID = data2.getCol(1)
			set ZDATA2=ZCID_"|"_ZCTRCT
			do io2.write(ZDATA2)
			
			type RecordACN acn = Db.getRecord("ACN","CID=:ZCID")       	
	         	set ZPRODTYP	= acn.type
	         	set ZPRODDES	= "N/A"
	         	if Db.isDefined("PRODCTL","TYPE=:ZPRODTYP") do {
			type RecordPRODCTL prod = Db.getRecord("PRODCTL","TYPE=:ZPRODTYP")
			set ZPRODDES = prod.des
			}
	         	type RecordTMPRPT6 rpt8 = Db.getRecord("TMPRPT6","PID='ZRPT8',ZBOO,ZTYP,ZSTAT,ZCTRCT,ZPRODTYP,ZCID",1)        	         	    	
         		set rpt8DATA.piece("|",1)	= ZBRNAME
			set rpt8DATA.piece("|",2)	= ZCTRTYPDES
			set rpt8DATA.piece("|",3)	= ZSTATDESC
         		set rpt8DATA.piece("|",4)	= ZPRODDES
         		set rpt8DATA.piece("|",5)	= acn.title1
        
         		set rpt8.DATA = rpt8DATA

         		do rpt8.bypassSave()
			
			type RecordTMPRPT4 rpt3 = Db.getRecord("TMPRPT4","PID='ZRPT3',ZBOO,ZTYP,ZSTAT,ZPRODTYP",1)								
			set rpt3DATA.piece("|",1)	= rpt3.DATA+1
			set rpt3DATA.piece("|",2)	= ZBRNAME
			set rpt3DATA.piece("|",3)	= ZCTRTYPDES
			set rpt3DATA.piece("|",4)	= ZSTATDESC
			set rpt3.DATA = rpt3DATA
			do rpt3.bypassSave()
			
			
	    		
	         	
		}
		
		
			
		type ResultSet data3 = Db.select("ACN","ZCTRCTCIF","CTRCT=:ZCTRCT")
		while data3.next() do {
			set ZACN = data3.getCol(1)
			set ZDATA3 = ZACN_"|"_ZCTRCT			
			do io3.write(ZDATA3)
			
			type RecordTMPRPT5 rpt7 = Db.getRecord("TMPRPT5","PID='ZRPT7',ZBOO,ZTYP,ZSTAT,ZCTRCT,ZACN",1) 
			
			type RecordCIF cif = Db.getRecord("CIF","ACN=:ZACN")
			set rpt7DATA.piece("|",1) = ZBRNAME
			set rpt7DATA.piece("|",2) = ZCTRTYPDES
			set rpt7DATA.piece("|",3) = ZSTATDESC
			set rpt7DATA.piece("|",4) = cif.fname_"-"_cif.lnm
			set rpt7.DATA = rpt7DATA
			
			do rpt7.bypassSave()
		}
		
		
		
		type ResultSet data4 = Db.select("CTRCT,COLL,CCSTAT,PLDGVAL,RELDATE,PLDGAMT,CRTDATE,CRTUSER","ZCTRCTCOL","CTRCT=:ZCTRCT")
		while data4.next() do {			
			type Date ZRELDATE = data4.getCol(5)
			type Date ZCRTDATE = data4.getCol(7)
			if 'data4.getCol(5).isNull(),data4.getCol(5)'=0 set ZRELDATE = ZRELDATE.toString("YEAR-MM-DD")
			if 'data4.getCol(7).isNull(),data4.getCol(7)'=0 set ZCRTDATE = ZCRTDATE.toString("YEAR-MM-DD")
			
			else set ZRELDATE=""
			else set ZCRTDATE=""
			set ZDATA4.piece("|",7) = ""
			set ZDATA4.piece("|",1) = data4.getCol(1)
			set ZDATA4.piece("|",2) = data4.getCol(2)
			set ZDATA4.piece("|",3) = data4.getCol(3)
			set ZDATA4.piece("|",4) = data4.getCol(4)
			set ZDATA4.piece("|",5) = ZRELDATE
			set ZDATA4.piece("|",6) = data4.getCol(6)
			set ZDATA4.piece("|",7) = ZCRTDATE
			set ZDATA4.piece("|",8) = data4.getCol(8)
			
			do io4.write(ZDATA4)	
			
		}
		
			
	         type RecordTMPRPT3 rptext = Db.getRecord("TMPRPT3","PID='ZRPT2',ZBOO,ZTYP,ZSTAT",1)
	         
	         set ZTMPDATA.piece("|",1) = rptext.DATA.piece("|",1)+1
		 set ZTMPDATA.piece("|",2) = rptext.DATA.piece("|",2)+ZAMT
		 set ZTMPDATA.piece("|",3) = ZBRNAME
		 set ZTMPDATA.piece("|",4) = ZCTRTYPDES
		 set ZTMPDATA.piece("|",5) = ZSTATDESC
	         set rptext.DATA	   = ZTMPDATA
	         	
	         do rptext.bypassSave()
	         	
	         type RecordTMPRPT4 rpt6 = Db.getRecord("TMPRPT4","PID='ZRPT6',ZBOO,ZTYP,ZSTAT,ZCTRCT",1)        	         	    	
	         set rpt6DATA.piece("|",1)	= ZBRNAME
		 set rpt6DATA.piece("|",2)	= ZCTRTYPDES
		 set rpt6DATA.piece("|",3)      = ZSTATDESC
	         set rpt6DATA.piece("|",4)	= ZCTRCTDT
	         set rpt6DATA.piece("|",5)	= ZAMT
	         set rpt6DATA.piece("|",6)	= ZMCTRCT
	         set rpt6DATA.piece("|",7)	= ZRELDATE
	         set rpt6.DATA = rpt6DATA
	         do rpt6.bypassSave()
	
         	
		 do io1.write(ZDATA1)
	
	}
	
	do io1.close()
	do io2.close()
	do io3.close()
	do io4.close()
	
	quit

ZMKWRITE(IO io,String str)
	
	//Prevent end of line problem
	while (str.length()>80) do {
			
			set ztmp = str.extract(1,80)
			do io.write(ztmp)
			set str	= str.extract(81,str.length())
		
		}
		
		do io.write(str)
	
	quit
	
ZRPT()	
	//do SYSVAR^SCADRV0()
	//set TJD=%SystemDate
	set ZRPT1="ZRPT1"
	set ZRPT2="ZRPT2"
	set ZRPT3="ZRPT3"
	set ZRPT4="ZRPT4"
	set ZRPT5="ZRPT5"
	set ZRPT6="ZRPT6"
	set ZRPT7="ZRPT7"
	set ZRPT8="ZRPT8"
	set ZRPT9="ZRPT9"
	set ZTMP3="ZTMP3"
	
	type IO io1=Class.new("IO")
	set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT1_"_TJD_".TXT"
	set io1.openParams="NEWV/WRITE"
	do io1.open()
	/*
	REPORT		GLOBAL
	
	BOO  		ZBRNAME
	BOO DESC	ZCOLTYPDESC
	COLTYP		ZCOLSUBDESC
	COLTYP DESC	ZSUBBOTDES
	COLSUBT		ZSUM
	COLSUBT DESC	ZAMT
	BOTCODE
	SUBBOTCODE
	SUBBOTDESC
	SUMCOL
	SUMCOLAMT
	

	*/
	
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"COLTYP"_"|"_"COLTYP DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"BOTCODE"_"|"_"SUBBOTCODE"_"|"_"SUBBOTDESC"_"|"_"SUMCOL"_"|"_"SUMCOLAMT"
	do io1.write(tWRITE)
	
	type ResultSet rs1 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT1")
	while rs1.next() do {
		set ZBRNAME     = rs1.getCol(6).piece("|",1)
		set ZCOLTYPDESC = rs1.getCol(6).piece("|",2)
		set ZCOLSUBDESC = rs1.getCol(6).piece("|",3)
		set ZSUBBOTDES	= rs1.getCol(6).piece("|",4)
		set ZSUM	= rs1.getCol(6).piece("|",5)
		set ZAMT	= rs1.getCol(6).piece("|",6)
		//set tWRITE = rs1.getCol(1)_"|"_rs1.getCol(2)_"|"_rs1.getCol(3)_"|"_rs1.getCol(4)_"|"_rs1.getCol(5)_"|"_rs1.getCol(6)_"|"
		set tWRITE.piece("|",1) = rs1.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs1.getCol(2)
		set tWRITE.piece("|",4) = ZCOLTYPDESC
		set tWRITE.piece("|",5) = rs1.getCol(3)
		set tWRITE.piece("|",6) = ZCOLSUBDESC
		set tWRITE.piece("|",7) = rs1.getCol(4)
		set tWRITE.piece("|",8) = rs1.getCol(5)
		set tWRITE.piece("|",9) = ZSUBBOTDES
		set tWRITE.piece("|",10) = ZSUM
		set tWRITE.piece("|",11) = ZAMT
		do io1.write(tWRITE)
		}
	do io1.close()
	
	
	type IO io2=Class.new("IO")
	set io2.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT2_"_TJD_".TXT"
	set io2.openParams="NEWV/WRITE"
	do io2.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"SUMCTR"_"|"_"SUMCTRAMT"
	do io2.write(tWRITE)
	
	type ResultSet rs2 = Db.select("KEY1,KEY2,KEY3,DATA","TMPRPT3","PID=:ZRPT2")
	while rs2.next() do {
		set ZBRNAME     = rs2.getCol(4).piece("|",3)
		set ZCTRDESC 	= rs2.getCol(4).piece("|",4)
		set ZSTATDESC 	= rs2.getCol(4).piece("|",5)
		
		set tWRITE.piece("|",1) = rs2.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs2.getCol(2)
		set tWRITE.piece("|",4) = ZCTRDESC
		set tWRITE.piece("|",5) = rs2.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs2.getCol(4).piece("|",1)	//SUM
		set tWRITE.piece("|",8) = rs2.getCol(4).piece("|",2)	//AMOUNT
		do io2.write(tWRITE)
		}
	do io2.close()
	
	
	type IO io3=Class.new("IO")
	set io3.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT3_"_TJD_".TXT"
	set io3.openParams="NEWV/WRITE"
	do io3.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"PRODUCTTYP"_"|"_"SUMACCT"_"|"_"COLTYP"_"|"_"COLTYP_DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"SUMCOL"
	do io3.write(tWRITE)
	type ResultSet rs3 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT3")
	while rs3.next() do {
		new tWRITE
		set ZBOO		= rs3.getCol(1)
		set ZTYP		= rs3.getCol(2)
		set ZSTAT		= rs3.getCol(3)
		
		set ZBRNAME		= rs3.getCol(5).piece("|",2)
		set ZCTRTYPDES		= rs3.getCol(5).piece("|",3)
		set ZSTATDESC		= rs3.getCol(5).piece("|",4)
		
		set tWRITE.piece("|",1) = rs3.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs3.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs3.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs3.getCol(4)
		set tWRITE.piece("|",8) = rs3.getCol(5).piece("|",1)
		
		
		type ResultSet ztmp3 = Db.select("KEY4,KEY5,DATA","TMPRPT5","PID=:ZTMP3 AND KEY1=:ZBOO AND KEY2=:ZTYP AND KEY3=:ZSTAT")
		if ztmp3.isEmpty() do {
			set tWRITE.piece("|",9) = "N/A"
			set tWRITE.piece("|",10) = "N/A"
			set tWRITE.piece("|",11) = "N/A"
			set tWRITE.piece("|",12) = "N/A"
			set tWRITE.piece("|",13) = "N/A"
			do io3.write(tWRITE)
		}
			
		while ztmp3.next() do {
			set ZCOLTYPDESC		= ztmp3.getCol(3).piece("|",1)
			set ZCOLTSUBDESC	= ztmp3.getCol(3).piece("|",2)
			set ZSUM		= ztmp3.getCol(3).piece("|",3)
			set tWRITE.piece("|",9)		= ztmp3.getCol(1)	//COLTYP
			set tWRITE.piece("|",10)	= ZCOLTYPDESC
			set tWRITE.piece("|",11)	= ztmp3.getCol(2)	//COLSUBT
			set tWRITE.piece("|",12)	= ZCOLTSUBDESC
			set tWRITE.piece("|",13)	= ZSUM			//SUMCOL
			do io3.write(tWRITE)
		}
			
	}
	do io3.close()	
	
	/*
	type IO io4=Class.new("IO")
	set io4.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT4_"_TJD_".TXT"
	set io4.recordSize = 1024
	set io4.openParams="NEWV/WRITE"
	do io4.open()
	new tWRITE
	set tWRITE = "BOO"_"|"_"COLTYP"_"|"_"COLSUBT"_"|"_"COLLID"_"|"_"COLLDETAIL"_"|"_"APPRAISEDBY"_"|"_"APPRAISEDDT"_"|"_"APPRAISALVAL"
	do io4.write(tWRITE)
	set ZPOINT = $O(^TMP(ZRPT4,""))
	while ZPOINT do { 		
		set tWRITE = ^TMP(ZRPT4,ZPOINT)
		do io4.write(tWRITE)
		set ZPOINT = $O(^TMP(ZRPT4,ZPOINT))
		}
	do io4.close()
	quit
	*/
	
	
	/*
	type IO io5=Class.new("IO")
	set io5.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT5_"_TJD_".TXT"
	set io5.openParams="NEWV/WRITE"
	do io5.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"COLTYP"_"|"_"COLTYP DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"COLLID"_"|"_"COLLCIF"_"|"_"COLLOWNERNAME"
	do io5.write(tWRITE)
	type ResultSet rs5 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT5 AND KEY1 in ('1,2,565,94')")
	while rs5.next() do {
		set ZBOO		= rs5.getCol(1)
		set ZTYP		= rs5.getCol(2)
		set ZSTAT		= rs5.getCol(3)
		
		set ZBRNAME		= rs5.getCol(6).piece("|",1)
		set ZCTRTYPDES		= rs5.getCol(6).piece("|",2)
		set ZSTATDESC		= rs5.getCol(6).piece("|",3)
		
		set tWRITE.piece("|",1) = ZBOO
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = ZTYP
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = ZSTAT	
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs5.getCol(4)
		set tWRITE.piece("|",8) = rs5.getCol(5)
		set tWRITE.piece("|",9) = rs5.getCol(6).piece("|",6)
		do io5.write(tWRITE)
		}
	do io5.close()
	
	
	type IO io6=Class.new("IO")
	set io6.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT6_"_TJD_".TXT"
	set io6.openParams="NEWV/WRITE"
	do io6.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CONTRACTDT"_"|"_"PLEDGEAMT"_"|"_"MASTERCTRID"_"|"_"RELEASEDDT"
	do io6.write(tWRITE)
	type ResultSet rs6 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT6 AND KEY1=1")
	while rs6.next() do {
		new tWRITE
		set ZBOO		= rs6.getCol(1)
		set ZTYP		= rs6.getCol(2)
		set ZSTAT		= rs6.getCol(3)
	
		set ZBRNAME		= rs6.getCol(5).piece("|",1)
		set ZCTRTYPDES		= rs6.getCol(5).piece("|",2)
		set ZSTATDESC		= rs6.getCol(5).piece("|",3)
		
		set tWRITE.piece("|",1) = rs6.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs6.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs6.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs6.getCol(4)
		set tWRITE.piece("|",8) = rs6.getCol(5).piece("|",4,7)
		do io6.write(tWRITE)
		}
	do io6.close()
	
	
	
	type IO io7=Class.new("IO")
	set io7.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT7_"_TJD_".TXT"
	set io7.openParams="NEWV/WRITE"
	do io7.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CTRCIF"_"|"_"CTROWNERNAME"
	do io7.write(tWRITE)
	type ResultSet rs7 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT7 AND KEY1=1")
	while rs7.next() do {
		
		set ZBOO		= rs7.getCol(1)
		set ZTYP		= rs7.getCol(2)
		set ZSTAT		= rs7.getCol(3)
	
		set ZBRNAME		= rs7.getCol(6).piece("|",1)
		set ZCTRTYPDES		= rs7.getCol(6).piece("|",2)
		set ZSTATDESC		= rs7.getCol(6).piece("|",3)
		
		set tWRITE.piece("|",1) = rs7.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs7.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs7.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs7.getCol(4)
		set tWRITE.piece("|",8) = rs7.getCol(5)
		set tWRITE.piece("|",8) = rs7.getCol(6).piece("|",4)
		do io7.write(tWRITE)
		}
	do io7.close()
	
	
	type IO io8=Class.new("IO")
	set io8.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT8_"_TJD_".TXT"
	set io8.openParams="NEWV/WRITE"
	do io8.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"ACCTTYP"_"|"_"ACCTTYP_DESC"_"|"_"ACCTNO"_"|"_"ACCTNAME"
	do io8.write(tWRITE)
	type ResultSet rs8 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,KEY6,DATA","TMPRPT6","PID=:ZRPT8 AND KEY1=1")
	while rs8.next() do {
		set ZBRNAME		= rs8.getCol(7).piece("|",1)
		set ZCTRTYPDES		= rs8.getCol(7).piece("|",2)
		set ZSTATDESC		= rs8.getCol(7).piece("|",3)
		
		set tWRITE.piece("|",1) = rs8.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs8.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs8.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs8.getCol(4)
		set tWRITE.piece("|",8) = rs8.getCol(5)
		set tWRITE.piece("|",9) = rs8.getCol(7).piece("|",4)
		set tWRITE.piece("|",10) = rs8.getCol(6)
		set tWRITE.piece("|",11) = rs8.getCol(7).piece("|",5)
		do io8.write(tWRITE)
		}
	do io8.close()
	
	
	type IO io9=Class.new("IO")
	set io9.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT9_"_TJD_".TXT"
	set io9.openParams="NEWV/WRITE"
	do io9.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"COLTYP"_"|"_"COLTYP_DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"COLLID"
	do io9.write(tWRITE)
	type ResultSet rs9 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT9 AND KEY1=1")
	while rs9.next() do {
		set ZBRNAME		= rs9.getCol(5).piece("|",1)
		set ZCTRTYPDES		= rs9.getCol(5).piece("|",2)
		set ZSTATDESC		= rs9.getCol(5).piece("|",3)
		set ZCOLTYP		= rs9.getCol(5).piece("|",4)
		set ZCOLTYPDESC		= rs9.getCol(5).piece("|",5)
		set ZCOLSUBT		= rs9.getCol(5).piece("|",6)
		set ZCOLSUBTDES		= rs9.getCol(5).piece("|",7)
		set ZCOLL		= rs9.getCol(5).piece("|",8)
		
		set tWRITE.piece("|",1) = rs9.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs9.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs9.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs9.getCol(4)
		set tWRITE.piece("|",8) = ZCOLTYP
		set tWRITE.piece("|",9) = ZCOLTYPDESC
		set tWRITE.piece("|",10) = ZCOLSUBT
		set tWRITE.piece("|",11) = ZCOLSUBTDES
		set tWRITE.piece("|",12) = ZCOLL
		
		
		do io9.write(tWRITE)
		}
	do io9.close()
	
	*/
	quit

	
	
ZRPT4(i)
	set TJD="20120228"
	//set up header
	set tWRITE=""
	if (i=1) do { 
		set tWRITE.piece("|",1) = "LRTRVDT"
		set tWRITE.piece("|",2) = "GRPNO"
		set tWRITE.piece("|",3) = "AMPHUR"
		set tWRITE.piece("|",4) = "BKNUMBER"
		set tWRITE.piece("|",5) = "PARTLFLG"
		set tWRITE.piece("|",6) ="LNDNO"
		set tWRITE.piece("|",7) ="LNDVOL1"
		set tWRITE.piece("|",8) ="LNDVOL2"
		set tWRITE.piece("|",9) ="LNDVOL3"
		set tWRITE.piece("|",10) ="LNDVOL4"
		set tWRITE.piece("|",11) ="LOC1"
		set tWRITE.piece("|",12) ="LOC2"
		set tWRITE.piece("|",13) ="LOC3"
		set tWRITE.piece("|",14) ="OWNPORTN"
		set tWRITE.piece("|",15) ="OWNLNDVOL1"
		set tWRITE.piece("|",16) ="OWNLNDVOL2"
		set tWRITE.piece("|",17) ="OWNLNDVOL3"
		set tWRITE.piece("|",18) ="OWNLNDVOL4"
		set tWRITE.piece("|",19) ="PAGENO"
		set tWRITE.piece("|",20) ="CONDPAR"
		set tWRITE.piece("|",21) ="RMKPORTN"
		set tWRITE.piece("|",22) ="PROVINCE"
		set tWRITE.piece("|",23) ="RAVANG"
		set tWRITE.piece("|",24) ="SEQNO"
		set tWRITE.piece("|",25) ="TAMBOL"
		set tWRITE.piece("|",26) ="TOTPORTN"
		set tWRITE.piece("|",27) ="LNDINFO"
		set tWRITE.piece("|",28) ="PROVINCE"
		set tWRITE.piece("|",29) ="ROAD"
		set tWRITE.piece("|",30) ="BSOI"
		set tWRITE.piece("|",31) ="TAMBOL"
		set tWRITE.piece("|",32) ="BLDCODE"
		set tWRITE.piece("|",33) ="BLDNAME"
		set tWRITE.piece("|",34) ="BLDNUM"
		set tWRITE.piece("|",35) ="BUILDNO"
		set tWRITE.piece("|",36) ="RMNUMBER"
		set tWRITE.piece("|",37) ="STOREY"
		set tWRITE.piece("|",38) ="RMAREA"
			
	}
	
	if (i=2!i=8) do { 
		set tWRITE.piece("|",1) = "LRTRVDT"
		set tWRITE.piece("|",2) = "PROVINCE"
		set tWRITE.piece("|",3) = "ROAD"
		set tWRITE.piece("|",4) = "BSOI"
		set tWRITE.piece("|",5) = "TAMBOL"
		set tWRITE.piece("|",6) ="BLDCODE"
		set tWRITE.piece("|",7) ="BLDNAME"
		set tWRITE.piece("|",8) ="BLDNUM"
		set tWRITE.piece("|",9) ="BUILDNO"
		set tWRITE.piece("|",10) ="RMNUMBER"
		set tWRITE.piece("|",11) ="STOREY"
		set tWRITE.piece("|",12) ="RMAREA"
			
	}
	
	if (i=3!i=8) do { 
		set tWRITE.piece("|",1) = "AMPHUR"
		set tWRITE.piece("|",2) = "ENGCAP"
		set tWRITE.piece("|",3) = "MCODE1"
		set tWRITE.piece("|",4) = "MCODE2"
		set tWRITE.piece("|",5) = "UNITCD"
		set tWRITE.piece("|",6) ="USEDSTDT"
		set tWRITE.piece("|",7) ="PROVINCE"
		set tWRITE.piece("|",8) ="ROAD"
		set tWRITE.piece("|",9) ="BSOI"
		set tWRITE.piece("|",10) ="TAMBOL"
		
			
	}
	
	if (i=4) do {
		set tWRITE.piece("|",1) = "CID"
	}
	
	if (i=5!i=6) do { 
		set tWRITE.piece("|",1) = "BLASTID"
		set tWRITE.piece("|",2) = "BSTRTID"
		set tWRITE.piece("|",3) = "SHRHLDRG"
	}
	
	if (i=7) do { 
		set tWRITE.piece("|",1) = "GTEL"
		set tWRITE.piece("|",2) = "BSTRTID"
		set tWRITE.piece("|",3) = "SHRHLDRG"
		
	}
	
	if (i=11!12) do { 

		set tWRITE.piece("|",1) ="AMPHUR"
		set tWRITE.piece("|",2) ="PROVINCE"
		set tWRITE.piece("|",3) ="ROAD"
		set tWRITE.piece("|",4) ="BSOI"
		set tWRITE.piece("|",5) ="TAMBOL"
		set tWRITE.piece("|",6) ="RIGHBAL"
		set tWRITE.piece("|",7) ="ZLGNUM"
		set tWRITE.piece("|",8) ="ZATEISSUER"
		set tWRITE.piece("|",9) ="ZLGISSUEDT"
		set tWRITE.piece("|",10) ="ZATEEXP"
		set tWRITE.piece("|",11) ="ZATEISSUEDT"
		set tWRITE.piece("|",12) ="ZATENUM"
		set tWRITE.piece("|",13) ="ZRAEXP"
		set tWRITE.piece("|",14) ="ZRAISSUER"
		set tWRITE.piece("|",15) ="ZRANUM"
		set tWRITE.piece("|",16) ="ZRATYPE"
		set tWRITE.piece("|",17) ="ASDATE"
		set tWRITE.piece("|",18) ="CCRDT"
		set tWRITE.piece("|",19) ="CCRNUM"
		set tWRITE.piece("|",20) ="PAYPARTY"
		set tWRITE.piece("|",21) ="RIGHVAL"
		set tWRITE.piece("|",22) ="BOOTFR"
		set tWRITE.piece("|",23) ="DATETRF"

			
	}
	
	if (i=14) do { 

		set tWRITE.piece("|",1) ="CID"
		set tWRITE.piece("|",2) ="ZCERTID"
		set tWRITE.piece("|",3) ="ZCERTCID"
		set tWRITE.piece("|",4) ="ZCERTBAL"
		set tWRITE.piece("|",5) ="ZCERTGRP"
		set tWRITE.piece("|",6) ="ZCERTLOTH"
		set tWRITE.piece("|",7) ="ZCERTLOTL"
		set tWRITE.piece("|",8) ="ZCERTPERIOD"
		set tWRITE.piece("|",9) ="ZCERTUNIT"
		
	}
		
	

	type IO io1=Class.new("IO")
	set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT4_TYPE"_i_"BRANCH1_"_TJD_".TXT"
	set io1.recordSize = 1024
	set io1.openParams="NEWV/WRITE"
	do io1.open()
	do io1.write(tWRITE)
		
	type IO io2=Class.new("IO")
	set io2.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT4_TYPE"_i_"BRANCH2_"_TJD_".TXT"
	set io2.recordSize = 1024
	set io2.openParams="NEWV/WRITE"	
	do io2.open()
	do io2.write(tWRITE)
	
	type IO io3=Class.new("IO")
	set io3.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT4_TYPE"_i_"BRANCH94_"_TJD_".TXT"
	set io3.recordSize = 1024
	set io3.openParams="NEWV/WRITE"	
	do io3.open()
	do io3.write(tWRITE)
	
	type IO io4=Class.new("IO")
	set io4.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT4_TYPE"_i_"BRANCH565_"_TJD_".TXT"
	set io4.recordSize = 1024
	set io4.openParams="NEWV/WRITE"
	do io4.open()
	do io4.write(tWRITE)
	
	set ZPOINT = $O(^TMP("ZRPT4",i,""))
	while (ZPOINT) do { 		
		set tWRITE = ^TMP("ZRPT4",i,ZPOINT)
		set ZPOINT = $O(^TMP("ZRPT4",i,ZPOINT))
		if tWRITE.piece("|",1)=1 do io1.write(tWRITE) quit
		if tWRITE.piece("|",1)=2 do io2.write(tWRITE) quit
		if tWRITE.piece("|",1)=94 do io3.write(tWRITE) quit
		if tWRITE.piece("|",1)=565 do io4.write(tWRITE)
		
	}
	
	do io4.close()
	do io3.close()
	do io2.close()
	do io1.close()
	
	quit

FIX()

	set ZPOINTER = $O(^TMP("ZCONVCNT",""))
	type Date ZCTRCTDT,ZRELDATE
	
	while 'ZPOINTER.isNull() do {
		
		set (ZDATA1,ZDATA2,ZDATA3,ZDATA4,ZCID,ZACN,rpt2DATA,rpt3DATA,rpt6DATA,rpt7DATA,rpt8DATA,rpt9DATA)=""
		set ZTMP = ^TMP("ZCONVCNT",ZPOINTER,0)
		set ZDATA1 = ^TMP("ZCONVCNT",ZPOINTER,0)
		set ZPOINTER = $O(^TMP("ZCONVCNT",ZPOINTER))

		set ZBOO 	= $P(ZTMP,"|",1)
         	set ZTYP 	= $P(ZTMP,"|",3)
         	set ZCTRCTDT	= $P(ZTMP,"|",8)
         	set ZSTAT 	= $P(ZTMP,"|",9)
         	set ZMCTRCT	= $P(ZTMP,"|",10)
         	set ZAMT	= $P(ZTMP,"|",11)
         	set ZRELDATE	= $P(ZTMP,"|",13)	
		
		set ZCTRCT = ZTMP.piece("|",7)
		
		type ResultSet data3 = Db.select("ACN","ZCTRCTCIF","CTRCT=:ZCTRCT")
		while data3.next() do {
			set ZACN = data3.getCol(1)
			set ZDATA3 = ZACN_"|"_ZCTRCT			
			//do io3.write(ZDATA3)
			
			type RecordTMPRPT5 rpt7 = Db.getRecord("TMPRPT5","PID='ZRPT7',ZBOO,ZTYP,ZSTAT,ZCTRCT,ZACN",1) 

			type RecordCIF cif = Db.getRecord("CIF","ACN=:ZACN")
			set rpt7DATA.piece("|",1) = cif.fname_"-"_cif.lnm
			set rpt7.DATA = rpt7DATA
			
			do rpt7.bypassSave()
		}
		
		type RecordTMPRPT4 rpt6 = Db.getRecord("TMPRPT4","PID='ZRPT6',ZBOO,ZTYP,ZSTAT,ZCTRCT",1)        	         	    	
	        set rpt6DATA.piece("|",1)	= ZCTRCTDT
	        set rpt6DATA.piece("|",2)	= ZAMT
	        set rpt6DATA.piece("|",3)	= ZMCTRCT
	        set rpt6DATA.piece("|",4)	= ZRELDATE
	        set rpt6.DATA = rpt6DATA
	        do rpt6.bypassSave()
         	
         	
         }
         quit
         
ZDETAILRPT()
	set i=1
	
	set ZRPT5="ZRPT5"
	set ZRPT6="ZRPT6"
	set ZRPT7="ZRPT7"
	set ZRPT8="ZRPT8"
	set ZRPT9="ZRPT9"
	
	while (i'<0) do {
		type IO io5=Class.new("IO")
		set io5.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT5BRANCH"_i_"_"_TJD_".TXT"
		set io5.openParams="NEWV/WRITE"
		do io5.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"COLTYP"_"|"_"COLTYP DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"COLLID"_"|"_"COLLCIF"_"|"_"COLLOWNERNAME"
		do io5.write(tWRITE)
		type ResultSet rs5 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT5 AND KEY1=:i")
		while rs5.next() do {
			set tWRITE=""
			set ZBOO		= rs5.getCol(1)
			set ZTYP		= rs5.getCol(2)
			set ZSTAT		= rs5.getCol(3)
			
			set ZBRNAME		= rs5.getCol(6).piece("|",1)
			set ZCTRTYPDES		= rs5.getCol(6).piece("|",2)
			set ZSTATDESC		= rs5.getCol(6).piece("|",3)
			
			set tWRITE.piece("|",1) = ZBOO
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = ZTYP
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = ZSTAT	
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs5.getCol(4)
			set tWRITE.piece("|",8) = rs5.getCol(5)
			set tWRITE.piece("|",9) = rs5.getCol(6).piece("|",6)
			do io5.write(tWRITE)
		}
		do io5.close()
		
		type IO io6=Class.new("IO")
		set io6.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT6BRANCH"_i_"_"_TJD_".TXT"
		set io6.openParams="NEWV/WRITE"
		do io6.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CONTRACTDT"_"|"_"PLEDGEAMT"_"|"_"MASTERCTRID"_"|"_"RELEASEDDT"
		do io6.write(tWRITE)
		type ResultSet rs6 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT6 AND KEY1=:i")
		while rs6.next() do {
			set tWRITE=""
			set ZBOO		= rs6.getCol(1)
			set ZTYP		= rs6.getCol(2)
			set ZSTAT		= rs6.getCol(3)
			
			set ZBRNAME		= rs6.getCol(5).piece("|",1)
			set ZCTRTYPDES		= rs6.getCol(5).piece("|",2)
			set ZSTATDESC		= rs6.getCol(5).piece("|",3)
			
			set tWRITE.piece("|",1) = rs6.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs6.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs6.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs6.getCol(4)
			set tWRITE.piece("|",8) = rs6.getCol(5).piece("|",4,7)
			do io6.write(tWRITE)
		}
		do io6.close()
		
		type IO io7=Class.new("IO")
		set io7.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT7BRANCH"_i_"_"_TJD_".TXT"
		set io7.openParams="NEWV/WRITE"
		do io7.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CTRCIF"_"|"_"CTROWNERNAME"
		do io7.write(tWRITE)
		type ResultSet rs7 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT7 AND KEY1=:i")
		while rs7.next() do {
			set tWRITE=""
			set ZBOO		= rs7.getCol(1)
			set ZTYP		= rs7.getCol(2)
			set ZSTAT		= rs7.getCol(3)
		
			set ZBRNAME		= rs7.getCol(6).piece("|",1)
			set ZCTRTYPDES		= rs7.getCol(6).piece("|",2)
			set ZSTATDESC		= rs7.getCol(6).piece("|",3)
			
			set tWRITE.piece("|",1) = rs7.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs7.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs7.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs7.getCol(4)
			set tWRITE.piece("|",8) = rs7.getCol(5)
			set tWRITE.piece("|",8) = rs7.getCol(6).piece("|",4)
			do io7.write(tWRITE)
		}
		do io7.close()
		
		type IO io8=Class.new("IO")
		set io8.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT8BRANCH"_i_"_"_TJD_".TXT"
		set io8.openParams="NEWV/WRITE"
		do io8.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"ACCTTYP"_"|"_"ACCTTYP_DESC"_"|"_"ACCTNO"_"|"_"ACCTNAME"
		do io8.write(tWRITE)
		type ResultSet rs8 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,KEY6,DATA","TMPRPT6","PID=:ZRPT8 AND KEY1=:i")
		while rs8.next() do {
			set ZBRNAME		= rs8.getCol(7).piece("|",1)
			set ZCTRTYPDES		= rs8.getCol(7).piece("|",2)
			set ZSTATDESC		= rs8.getCol(7).piece("|",3)
			
			set tWRITE.piece("|",1) = rs8.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs8.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs8.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs8.getCol(4)
			set tWRITE.piece("|",8) = rs8.getCol(5)
			set tWRITE.piece("|",9) = rs8.getCol(7).piece("|",4)
			set tWRITE.piece("|",10) = rs8.getCol(6)
			set tWRITE.piece("|",11) = rs8.getCol(7).piece("|",5)
			do io8.write(tWRITE)
		}
		do io8.close()
		
		
		type IO io9=Class.new("IO")
		set io9.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT9BRANCH"_i_"_"_TJD_".TXT"
		set io9.openParams="NEWV/WRITE"
		do io9.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"COLTYP"_"|"_"COLTYP_DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"COLLID"
		do io9.write(tWRITE)
		type ResultSet rs9 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT9 AND KEY1=:i")
		while rs9.next() do {
			set ZBRNAME		= rs9.getCol(5).piece("|",1)
			set ZCTRTYPDES		= rs9.getCol(5).piece("|",2)
			set ZSTATDESC		= rs9.getCol(5).piece("|",3)
			set ZCOLTYP		= rs9.getCol(5).piece("|",4)
			set ZCOLTYPDESC		= rs9.getCol(5).piece("|",5)
			set ZCOLSUBT		= rs9.getCol(5).piece("|",6)
			set ZCOLSUBTDES		= rs9.getCol(5).piece("|",7)
			set ZCOLL		= rs9.getCol(5).piece("|",8)
			
			set tWRITE.piece("|",1) = rs9.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs9.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs9.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs9.getCol(4)
			set tWRITE.piece("|",8) = ZCOLTYP
			set tWRITE.piece("|",9) = ZCOLTYPDESC
			set tWRITE.piece("|",10) = ZCOLSUBT
			set tWRITE.piece("|",11) = ZCOLSUBTDES
			set tWRITE.piece("|",12) = ZCOLL
			
			
			do io9.write(tWRITE)
		}
		do io9.close()
		
		if i=1 set i=2 quit
		if i=2 set i=94 quit
		if i=94 set i=565 quit
		if i=565 set i=-1 quit
	}	

	quit
	
ZGEN()
	kill ^TMP("ZRPT8")
	kill ^TMP("ZRPT9")
	set ZPOINTER = $O(^TMP("ZCONVCNT",""))
	type Date ZCTRCTDT,ZRELDATE	
	while 'ZPOINTER.isNull() do {
		
		set (ZDATA1,ZDATA2,ZDATA3,ZDATA4,ZCID,ZACN,rpt2DATA,rpt3DATA,rpt6DATA,rpt7DATA,rpt8DATA,rpt9DATA)=""
		set ZTMP = ^TMP("ZCONVCNT",ZPOINTER,0)
		set ZDATA1 = ^TMP("ZCONVCNT",ZPOINTER,0)
		set ZPOINTER = $O(^TMP("ZCONVCNT",ZPOINTER))

		set ZBOO 	= $P(ZTMP,"|",1)
         	set ZTYP 	= $P(ZTMP,"|",3)
         	set ZCTRCTDT	= $P(ZTMP,"|",8)
         	set ZSTAT 	= $P(ZTMP,"|",9)
         	set ZMCTRCT	= $P(ZTMP,"|",10)
         	set ZAMT	= $P(ZTMP,"|",11)
         	set ZRELDATE	= $P(ZTMP,"|",13)	
		
		set ZCTRCT = ZTMP.piece("|",7)
		
		set (ZBRNAME,ZCTRTYPDES,ZSTATDESC)="N/A"
		
		
		if Db.isDefined("UTBLBRCD","BRCD=:ZBOO") do {
			type RecordUTBLBRCD zbr = Db.getRecord("UTBLBRCD","BRCD=:ZBOO")
			set ZBRNAME = zbr.desc
		}
		if Db.isDefined("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT") do {
			type RecordZUTBLCNTSTAT CNTSTAT = Db.getRecord("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT")  
			set ZSTATDESC=CNTSTAT.desc
		}
		if Db.isDefined("ZUTBLCONTREL","CONTRREL=:ZTYP") do {
			type RecordZUTBLCONTREL CONTRREL = Db.getRecord("ZUTBLCONTREL","CONTRREL=:ZTYP")
			set ZCTRTYPDES = CONTRREL.desc
		}
		
		
         	type ResultSet rscol = Db.select("COLL","ZCTRCTCOL","ZCTRCTCOL.CTRCT=:ZCTRCT")					
		while rscol.next() do {			
			set (ZCOLTYPDES,ZCOLSUBDESC)="N/A"
			set ZRSCOL = rscol.getCol(1)	
			type RecordZCOL zcol = Db.getRecord("ZCOL","COLL=:ZRSCOL")
		        set ZCOLTYP	= zcol.COLTYP
		        set ZCOLSUBT	= zcol.COLSUBT
			        
			
			if Db.isDefined("ZUTBLCOLTYP","COLCD=:ZCOLTYP") do {
				type RecordZUTBLCOLTYP coldesc = Db.getRecord("ZUTBLCOLTYP","COLCD=:ZCOLTYP")  
				set ZCOLTYPDESC=coldesc.desc
			}
			if Db.isDefined("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT") do {
				type RecordZUTBLCOLSUBT colsubdesc = Db.getRecord("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT")
				set ZCOLSUBDESC = colsubdesc.desc
			}
		       
		       
			
			type RecordTMPRPT4 rpt9 = Db.getRecord("TMPRPT4","PID='ZRPT9',ZBOO,ZTYP,ZSTAT,ZCTRCT",1)
			set rpt9DATA.piece("|",1)	= ZBRNAME
			set rpt9DATA.piece("|",2)	= ZCTRTYPDES
			set rpt9DATA.piece("|",3)	= ZSTATDESC
			set rpt9DATA.piece("|",4)	= ZCOLTYP
			set rpt9DATA.piece("|",5)	= ZCOLTYPDES
			set rpt9DATA.piece("|",6)	= ZCOLSUBT
			set rpt9DATA.piece("|",7)	= ZCOLSUBDESC
			set rpt9DATA.piece("|",8)	= ZRSCOL
			set rpt9.DATA = rpt9DATA
			do rpt9.bypassSave()
		}
					
		
		type ResultSet data2 = Db.select("CID","ZCTRCTACN","CTRCT=:ZCTRCT")
		while data2.next() do {
			
			set ZCID = data2.getCol(1)
			set ZDATA2=ZCID_"|"_ZCTRCT
			
			
			type RecordACN acn = Db.getRecord("ACN","CID=:ZCID")       	
	         	set ZPRODTYP	= acn.type
	         	set ZPRODDES	= "N/A"
	         	if Db.isDefined("PRODCTL","TYPE=:ZPRODTYP") do {
			type RecordPRODCTL prod = Db.getRecord("PRODCTL","TYPE=:ZPRODTYP")
			set ZPRODDES = prod.des
			}
	         	type RecordTMPRPT6 rpt8 = Db.getRecord("TMPRPT6","PID='ZRPT8',ZBOO,ZTYP,ZSTAT,ZCTRCT,ZPRODTYP,ZCID",1)        	         	    	
         		set rpt8DATA.piece("|",1)	= ZBRNAME
			set rpt8DATA.piece("|",2)	= ZCTRTYPDES
			set rpt8DATA.piece("|",3)	= ZSTATDESC
         		set rpt8DATA.piece("|",4)	= ZPRODDES
         		set rpt8DATA.piece("|",5)	= acn.title1
        
         		set rpt8.DATA = rpt8DATA

         		do rpt8.bypassSave()
	
	         	
		}
		

         	
	
	}
	
	quit
	
ZGEN2()

	kill ^TMP("ZTMP3")
	set ZPOINTER = $O(^TMP("ZCONVCNT",""))
	while 'ZPOINTER.isNull() do {
		
		set (ZDATA1,ZDATA2,ZDATA3,ZDATA4,ZCID,ZACN,rpt2DATA,rpt3DATA,rpt6DATA,rpt7DATA,rpt8DATA,rpt9DATA)=""
		set ZTMP = ^TMP("ZCONVCNT",ZPOINTER,0)
		set ZDATA1 = ^TMP("ZCONVCNT",ZPOINTER,0)
		set ZPOINTER = $O(^TMP("ZCONVCNT",ZPOINTER))

		set ZBOO 	= $P(ZTMP,"|",1)
         	set ZTYP 	= $P(ZTMP,"|",3)
         	set ZCTRCTDT	= $P(ZTMP,"|",8)
         	set ZSTAT 	= $P(ZTMP,"|",9)
         	set ZMCTRCT	= $P(ZTMP,"|",10)
         	set ZAMT	= $P(ZTMP,"|",11)
         	set ZRELDATE	= $P(ZTMP,"|",13)	
		
		set ZCTRCT = ZTMP.piece("|",7)
		
		set (ZBRNAME,ZCTRTYPDES,ZSTATDESC)="N/A"
		
		
		if Db.isDefined("UTBLBRCD","BRCD=:ZBOO") do {
			type RecordUTBLBRCD zbr = Db.getRecord("UTBLBRCD","BRCD=:ZBOO")
			set ZBRNAME = zbr.desc
		}
		if Db.isDefined("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT") do {
			type RecordZUTBLCNTSTAT CNTSTAT = Db.getRecord("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT")  
			set ZSTATDESC=CNTSTAT.desc
		}
		if Db.isDefined("ZUTBLCONTREL","CONTRREL=:ZTYP") do {
			type RecordZUTBLCONTREL CONTRREL = Db.getRecord("ZUTBLCONTREL","CONTRREL=:ZTYP")
			set ZCTRTYPDES = CONTRREL.desc
		}
		
		
         	type ResultSet rscol = Db.select("COLL","ZCTRCTCOL","ZCTRCTCOL.CTRCT=:ZCTRCT")					
		while rscol.next() do {			
			set (ZCOLTYPDES,ZCOLSUBDESC)="N/A"
			set ZRSCOL = rscol.getCol(1)	
			type RecordZCOL zcol = Db.getRecord("ZCOL","COLL=:ZRSCOL")
		        set ZCOLTYP	= zcol.COLTYP
		        set ZCOLSUBT	= zcol.COLSUBT
			        
			
			if Db.isDefined("ZUTBLCOLTYP","COLCD=:ZCOLTYP") do {
				type RecordZUTBLCOLTYP coldesc = Db.getRecord("ZUTBLCOLTYP","COLCD=:ZCOLTYP")  
				set ZCOLTYPDESC=coldesc.desc
			}
			if Db.isDefined("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT") do {
				type RecordZUTBLCOLSUBT colsubdesc = Db.getRecord("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT")
				set ZCOLSUBDESC = colsubdesc.desc
			}
		       
		        type RecordTMPRPT5 tmp3 = Db.getRecord("TMPRPT5","PID='ZTMP3',ZBOO,ZTYP,ZSTAT,ZCOLTYP,ZCOLSUBT",1)								
			
			set tmp3DATA.piece("|",1)  = ZCOLTYPDESC
			set tmp3DATA.piece("|",2)  = ZCOLSUBDESC
			set tmp3DATA.piece("|",3)  = tmp3.DATA.piece("|",3)+1
			set tmp3.DATA = tmp3DATA
			do tmp3.bypassSave()
			
			
		}
		
	}
	
	quit
	
FIX2()

	set ZEXTDAT="20120302"
	type IO io4=Class.new("IO")
	set io4.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTCOL_"_ZEXTDAT_".TXT"
	set io4.openParams="NEWV/WRITE"
	set io4.recordSize = 1024
	do io4.open()
	set tWRITE = "CTRCT"_"|"_"COLL"_"|"_"CCSTAT"_"|"_"PLDGVAL"_"|"_"RELDATE"_"|"_"PLDGAMT"_"|"_"CRTDATE"_"|"_"CRTUSER"
	
	do io4.write(tWRITE)
	
	set ZPOINTER = $O(^TMP("ZCONVCNT",""))
	type Date ZCTRCTDT,ZRELDATE
	
	while 'ZPOINTER.isNull() do {
		set ZCTRCT = ZTMP.piece("|",7)	
		
		type ResultSet data4 = Db.select("CTRCT,COLL,CCSTAT,PLDGVAL,RELDATE,PLDGAMT,CRTDATE,CRTUSER","ZCTRCTCOL","CTRCT=:ZCTRCT")
		while data4.next() do {			
			type Date ZRELDATE = data4.getCol(5)
			type Date ZCRTDATE = data4.getCol(7)
			if 'data4.getCol(5).isNull(),data4.getCol(5)'=0 set ZRELDATE = ZRELDATE.toString("YEAR-MM-DD")
			if 'data4.getCol(7).isNull(),data4.getCol(7)'=0 set ZCRTDATE = ZCRTDATE.toString("YEAR-MM-DD")
			
			else set ZRELDATE=""
			else set ZCRTDATE=""
			set ZDATA4.piece("|",7) = ""
			set ZDATA4.piece("|",1) = data4.getCol(1)
			set ZDATA4.piece("|",2) = data4.getCol(2)
			set ZDATA4.piece("|",3) = data4.getCol(3)
			set ZDATA4.piece("|",4) = data4.getCol(4)
			set ZDATA4.piece("|",5) = ZRELDATE
			set ZDATA4.piece("|",6) = data4.getCol(6)
			set ZDATA4.piece("|",7) = ZCRTDATE
			set ZDATA4.piece("|",8) = data4.getCol(8)
			
			do io4.write(ZDATA4)	
			
		}
	
	quit
			
		