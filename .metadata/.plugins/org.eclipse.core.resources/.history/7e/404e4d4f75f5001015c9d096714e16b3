//DO NOT MODIFY  CBS Messages Interface For GSB-Collatera|ZCBSCMS|||||||1

CIFINQ(String input)
	
	/* Created By Ravipong Chumsai Na Ayuthaya 04/10/11 */
							
	type public Number ER = 0
	type public String RM = ""
	type String custName, custNum, custSurname, custType, header, inqType, output, searchCond, typeValue
	type String respCode = "0000", respDesc = ""
	type Number ACN = "", CNT = 0, recordCount = 0,recordCifCount=0
	type String WHERE=""
	
	set zheader 		= input.piece("|",1,10)	
	set SearchFlg 		= input.piece("|",11)	
	set SearchVal1 		= input.piece("|",12)	
	set SearchVal2		= input.piece("|",13)	
	set LastSearchVal 	= input.piece("|",14)
	set CurrentPage 	= input.piece("|",15)
	set RecordPerPage 	= input.piece("|",16)	
	
	new output
	set output=""
	
	if SearchFlg.isNull() set ER = 1, RM = "Search Flag Required" quit RM
	if SearchVal1.isNull(),SearchFlg'="N" set ER = 1, RM = "Invalid Inquiry" quit RM
	if 'SearchVal2.isNull(),SearchFlg'="N" set ER = 1, RM = "Invalid Inquiry" quit RM
	//if SearchFlg.isNull(),SearchVal1.isNull(),SearchVal2.isNull() set output
	/* Search for the customer based on customer citizenship card ID, passport number, or
	   customer number.
	   
	   Get the customer number from the database and use that for the main select statement below */
	
	
	
	if SearchFlg = "N" do {
		
		// Search by customer Name
		if 'SearchVal1.isNull() do {
			set WHERE = "ZXNAME BETWEEN '"_SearchVal1_"' AND '"_SearchVal1_$C(255)_"'"
			if 'SearchVal2.isNull() set WHERE = WHERE_" AND LNM BETWEEN '"_SearchVal2_"' AND "_SearchVal2_$C(255)
		}
		if SearchVal1.isNull(),'SearchVal2.isNull() set WHERE = "LNM BETWEEN '"_SearchVal2_"' AND "_SearchVal2_$C(255)
			
		
		
		}
	if SearchFlg = "I" do {
		
		// Search by Identification Number
		if 'SearchVal1.isNull() do {
			type ResultSet rs = Db.select("ACN","CIF","ZCIZID=:SearchVal1")
			if 'rs.next() set ER = 1, RM = "Customer Citizenship ID Not Found: "_ SearchVal1 quit
			set ACN = rs.getCol("ACN")
			set WHERE = "ACN="_ACN
			
		}
		
		
	}
	
	if SearchFlg = "P" do {
		
		// Search by Passport Number
		if 'SearchVal1.isNull() do {
			type ResultSet rs = Db.select("ACN","CIF","PASNUM=:SearchVal1")
			if 'rs.next() set ER = 1, RM = "Passport Number Not Found: "_SearchVal1 quit
			set ACN = rs.getCol("ACN")
			set WHERE = "ACN="_ACN
		}
		
	}	
	if SearchFlg = "T" do {
		
		// Search by Tax ID
		if 'SearchVal1.isNull() do {
			type ResultSet rs = Db.select("ACN","CIF","TAXID=:SearchVal1")
			if 'rs.next() set ER = 1, RM = "Tax ID Not Found: "_SearchVal1 quit
			set ACN = rs.getCol("ACN")
			set WHERE = "ACN="_ACN
		}
		 
		
		
	}
	
		 
		
		
	
	
	if WHERE.isNull() set ER = 1, RM = "Invalid Inquiry"
	if ER set header.piece("|",2) = RM, header.piece("|",1) = 1 quit zheader_"|"_header
	
	do {
	
		type String exe()

		type ResultSet recCount = Db.select("COUNT(ACN)","CIF",WHERE)
		if recCount.next() set recordCount = recCount.getCol(1)
	
	}
	
		
		
		if RecordPerPage.isNull() set RecordPerPage=20
		if CurrentPage.isNull() set CurrentPage=0
		if 'CurrentPage.isNull() do {
		
		set zwait=CurrentPage*RecordPerPage
		//set WHERE =WHERE_" AND ACN>"_LastSearchVal
		
		}
		
		set zstart=0
		set ztmp=""
		set exit=0
		type DbSet ds = Db.selectDbSet("CIF",WHERE)
		set more="N"
		set i=0
		while ds.next() do { quit:exit
		
		type RecordCIF cif = ds.getRecord()
			if (i'<zwait) set zstart=1
				
			if zstart=1 do { 
					
				set output.piece("|",1) = cif.acn
				set ztitle=cif.ztitle
				if 'cif.ztitle.isNull(),Db.isDefined("ZUTBLTITLE","cif.ztitle,0") set output.piece("|",2) = Db.getOneRow("DESC","ZUTBLTITLE","ztitle,0")		
				set output.piece("|",3) = cif.fname		
				set output.piece("|",4) = cif.lnm			
				set output.piece("|",5) = cif.mname			
				set output.piece("|",6) = cif.ZCIZID			
				set output.piece("|",8) = cif.taxid
				
				if cif.pers=0 do {
					set output.piece("|",7) = ""	
					if 'cif.mcity.isNull(),'cif.mstate.isNull(),'cif.mcntry do {
					set mcity=cif.mcity, mstate=cif.mstate, mcntry=cif.mcntry						
					if Db.isDefined("ZUTBLDIST","mcntry,mstate,mcity") set city = Db.getOneRow("DES","ZUTBLDIST","mcntry,mstate,mcity")
					if Db.isDefined("STBLCNTRY1","mcntry,mstate") set state = Db.getOneRow("DESC","STBLCNTRY1","mcntry,mstate")
					set output.piece("|",9) = cif.mad1_" "_cif.mad2_" "_cif.mad3_" "_cif.mad4_" "_city_" "_state_" "_cif.mzip
					}
					else set output.piece("|",9) = ""
				}
				if cif.pers=1 do {
					set output.piece("|",7) = "T"
					if 'cif.zocity.isNull(),'cif.zostate.isNull(),'cif.zocntry do {
					set zcity=cif.zocity, zstate=cif.zostate, zcntry=cif.zocntry						
					if Db.isDefined("ZUTBLDIST","zcntry,zstate,zcity") set city = Db.getOneRow("DES","ZUTBLDIST","zcntry,zstate,zcity")
					if Db.isDefined("STBLCNTRY1","zcntry,zstate") set state = Db.getOneRow("DESC","STBLCNTRY1","zcntry,zstate")
					set output.piece("|",9) = cif.zoad1_" "_cif.zoad2_" "_cif.zoad3_" "_cif.zoad4_" "_city_" "_state_" "_cif.zozip
					}
					else set output.piece("|",9) = ""
				}
								
			}
						
				if i=(CurrentPage+RecordPerPage) set more="Y", exit=1 quit 
				set ztmp=ztmp_output_"|"
				set i=i+1
				set header.piece("|",3) = cif.acn		
					
			}
			
	set header.piece("|",1) = 0
	set header.piece("|",2)	= ""	
	set header.piece("|",4) = recordCount
	set header.piece("|",5) = more
	set output=zheader_"|"_header_"|"_ztmp			
	if ER set header.piece("|",2) = RM, header.piece("|",1) = 1 quit zheader_"|"_header
		
	quit output
	
DEPINQ(String input)
	type public Number ER = 0
	type public String RM = ""
	type String custName, custNum, custSurname, custType, header, inqType, output, searchCond, typeValue
	type String respCode = "0000", respDesc = ""
	type Number ACN = "", CNT = 0, recordCount = 0,recordCifCount=0
	type String WHERE=""
	
	set zheader 		= input.piece("|",1,10)
	set FunctionFlag 	= input.piece("|",11)	
	set CifId 		= input.piece("|",12)	
	set AcctId		= input.piece("|",13)	
	set LastAcctId 		= input.piece("|",14)	
	set CurrentPage 	= input.piece("|",15)
	set RecordPerPage 	= input.piece("|",16)
	
	
	new output
	set output =""
	
	/* Search for the customer based on  Account number, or 
	   Get the customer number from the database and use that for the main select statement below */
	
	
	
	if FunctionFlag = "C" do {
		
		// Search by CIF No.
		if CifId.isNull() set ER = 1, RM = "CIF Number required " quit
		if 'Db.isDefined("CIF","ACN=:CifId") set ER = 1, RM = "CIF ID Not Found"
		set WHERE = "ACN="_CifId
			
		}
		
	if FunctionFlag = "A" do {
		
		// Search by Acct No.
		if AcctId.isNull() set ER = 1, RM = "Account Number required " quit
		if 'Db.isDefined("DEP","CID=:AcctId") set ER = 1, RM = "Account Not Found"
		set WHERE = "CID="_AcctId
			
		}
	
	
	if WHERE.isNull() set ER=1, RM="Invalid Inquiry" 	
	if ER set header.piece("|",2) = RM, header.piece("|",1) = 1 quit zheader_"|"_header
	
	do {
	
		type String exe()
		
		type ResultSet recCount = Db.select("COUNT(CID)","DEP",WHERE)
		if recCount.next() set recordCount = recCount.getCol(1)
	
	}
		
		
		if RecordPerPage.isNull() set RecordPerPage=20
		if CurrentPage.isNull() set CurrentPage=0
		if 'CurrentPage.isNull() set zwait=CurrentPage*RecordPerPage
		
		set zstart=0
		set exit=0
		set ztmp=""
		type DbSet ds = Db.selectDbSet("DEP",WHERE)
		set more="N"
		set i=0
		while ds.next() do { quit:exit
		
		type RecordDEP dep = ds.getRecord()
			
			if (i'<zwait) set zstart=1
				
				if zstart=1 do { 
										
				set output.piece("|",1) = dep.cid
				set output.piece("|",2) = dep.type			
				set output.piece("|",3) = dep.grp		
				set output.piece("|",4) = dep.zstatcd			
				set output.piece("|",5) = dep.boo			
				set output.piece("|",6) = dep.odlim			
				set output.piece("|",7) = dep.balavl
				set output.piece("|",8) = dep.bal
				set output.piece("|",9) = "0"
				set output.piece("|",10) = "0"
				set output.piece("|",11) = dep.tld.toString("YEAR/MM/DD")
				set output.piece("|",12) = "0"
				set output.piece("|",13) = dep.crcd
				set output.piece("|",14) = dep.acnrelc
				set output.piece("|",15) = dep.title1
				set output.piece("|",16) = dep.hldamt
				set output.piece("|",17) = dep.zcltot
				set output.piece("|",18) = dep.chkhld
				//set output.piece("|"8) = ...
				set output.piece("|",20) = dep.negacr+dep.negacrun
				set output.piece("|",21) = dep.negacr
				set output.piece("|",22) = dep.negacrun
				set output.piece("|",23) = dep.posacr
				set output.piece("|",24) = dep.zrstr
				set output.piece("|",25) = dep.PBI
				set output.piece("|",26) = dep.rflg
				set output.piece("|",27) = dep.cc
				set output.piece("|",28) = dep.odt.toString("YEAR/MM/DD")
				set output.piece("|",29) = dep.acn
				
			}
				if i=(CurrentPage+RecordPerPage) set more="Y", exit=1 quit 
				set ztmp=ztmp_output_"|"
					 
				set footer.piece("|",1) = dep.cid
				set footer.piece("|",2) = recordCount
				set i=i+1		
				
			}
	if ER set header.piece("|",2) = RM, header.piece("|",1) = 1 quit zheader_"|"_header	
	
	set footer.piece("|",3)= more		
	set header.piece("|",1) = 0
	set header.piece("|",2)	= ""
	set output=""
	set output=zheader_"|"_header_"|"_footer_"|"_ztmp_"|"
			
	
	quit output

CIFDET(String input)
	type public Number ER = 0
	type public String RM = ""
	type String respCode = "0000", respDesc = ""
	type Number ACN = "",recordCount = 0
	type String WHERE=""
	
	set zheader 		= input.piece("|",1,10)
	set CIFNo 		= input.piece("|",11)	
		
	
	set output =""
	if 'CIFNo.isNull() do {
		
		// Search by Customer No.
		
		if 'Db.isDefined("CIF","ACN=:CIFNo") set ER = 1, RM = "CIF ID Not Found"
		set WHERE = "ACN="_CIFNo
			
		}
		set ztmp=""
		type DbSet ds = Db.selectDbSet("CIF",WHERE)
		while ds.next() do {
		
		type RecordCIF cif = ds.getRecord()
		
				type String mar=cif.mar, sex=cif.sex, educ=cif.educ, zrescd=cif.zrescd, own=cif.own, zocc=cif.zocc, zsocc=cif.zsocc, zposcd=cif.zposcd, emplno=cif.emplno, zoffcd=cif.zoffcd, mf=cif.mf, zresunit=cif.zresunit
				type String zisicsd=cif.zisicsd, zisicgc=cif.zisicgc,  zisicts=cif.zisicts, inc=cif.inc, nation=cif.nation, zrrt=cif.zrrt, zkycstat=cif.zkycstat, dlstate=cif.dlstate, ccode=cif.ccode
				type String pcntry=cif.pcntry, pstate=cif.pstate, pdist=cif.pcity, psubdist=cif.zpsdiscd, priv=cif.priv, cd1=cif.ZMINISTRYCD1, cd2=cif.ZMINISTRYCD2, cd3=cif.ZMINISTRYCD3
				type String mcntry=cif.mcntry, mstate=cif.mstate, mdist=cif.mcity, msubdist=cif.zmsdiscd, cc=cif.cc, relicd=cif.ZRELIGIONCD
				type String zocntry=cif.zocntry, zostate=cif.zostate, zodist=cif.zocity, zosubdist=cif.zosdiscd, dobcd=cif.zdobcd, zetitle=cif.zetitle
	
				set output.piece("|",1) = cif.acn
				set output.piece("|",2) = cif.pers
				set output.piece("|",3) = cif.ztitle
				set output.piece("|",4) = cif.fname
				set output.piece("|",5) = cif.lnm
				set output.piece("|",6) = cif.mname
				set output.piece("|",7) = $S(cif.pers=1:cif.fname+cif.mname+cif.lnm,1:cif.nam)
				//set output.piece("|",8) = $$DESC("DESC","ZUTBLTITLE","ZETITLE="_cif.zetitle_","_1")
				set output.piece("|",8) = cif.zetitle
				set output.piece("|",9) = cif.zefname
				set output.piece("|",10) = cif.zelnm
				set output.piece("|",11) = cif.zemname
				set output.piece("|",12) = cif.zenam
				set output.piece("|",13) = cif.pad1
				set output.piece("|",14) = cif.pad2
				set output.piece("|",15) = cif.pad3
				
				set output.piece("|",16) = psubdist
				set output.piece("|",17) = cif.pcity
				set output.piece("|",18) = cif.pstate
				set output.piece("|",19) = cif.pzip
				set output.piece("|",20) = cif.pcntry
				set output.piece("|",21) = cif.mad1
				set output.piece("|",22) = cif.mad2
				set output.piece("|",23) = cif.mad3
				
				set output.piece("|",24) = cif.ZMSDISCD
				set output.piece("|",25) = cif.mcity
				set output.piece("|",26) = cif.mstate
				set output.piece("|",27) = cif.mzip
				set output.piece("|",28) = cif.mcntry
				set output.piece("|",29) = cif.zoad1
				set output.piece("|",30) = cif.zoad2
				set output.piece("|",31) = cif.zoad3
				
				set output.piece("|",32) = cif.ZOSDISCD
				set output.piece("|",33) = cif.zocity
				set output.piece("|",34) = cif.zostate
				set output.piece("|",35) = cif.zozip
				set output.piece("|",36) = cif.zocntry
								
				set output.piece("|",37) = Db.getOneRow("DESC","UTBLMS","mar")
				set output.piece("|",38) = Db.getOneRow("DESC","UTBLSEX","sex")
				set output.piece("|",39) = cif.dob.toString("DD/MM/YEAR")
				set output.piece("|",40) = Db.getOneRow("TDES","ZUTBLNATION","nation")
				if 'educ.isNull(),Db.isDefined("UTBLEDUC","educ") set output.piece("|",41) = Db.getOneRow("DESC","UTBLEDUC","educ")
				if 'zrescd.isNull(),Db.isDefined("STBLCNTRY","zrescd") set output.piece("|",42) = Db.getOneRow("DESC","STBLCNTRY","zrescd")
				if 'own.isNull(),Db.isDefined("UTBLOWN","own") set output.piece("|",43) = Db.getOneRow("DESC","UTBLOWN","own")
				set output.piece("|",44) = cif.dep
				if 'zocc.isNull(),Db.isDefined("ZUTBLOC","zocc") set output.piece("|",45) = Db.getOneRow("TDES","ZUTBLOC","zocc")
				if 'zocc.isNull(),'zsocc.isNull(),Db.isDefined("ZUTBLSOC","zocc,zsocc") set output.piece("|",46) = Db.getOneRow("TDES","ZUTBLSOC","zocc,zsocc")
				if 'zposcd.isNull(),Db.isDefined("ZUTBLPOSITN","zposcd") set output.piece("|",47) = Db.getOneRow("DESC","ZUTBLPOSITN","zposcd")
				if 'emplno.isNull(),Db.isDefined("UTBLEMPLOYER","emplno") set output.piece("|",48) = Db.getOneRow("FMDESC","UTBLEMPLOYER","emplno")
				if 'zisicsd.isNull(),Db.isDefined("ZUTBLISICSD","zisicsd") set output.piece("|",49) = Db.getOneRow("TDES","ZUTBLISICSD","zisicsd")
				if 'zisicsd.isNull(),'zisicgc.isNull(),Db.isDefined("ZUTBLISICGC","zisicsd,zisicgc") set output.piece("|",50) = Db.getOneRow("TDES","ZUTBLISICGC","zisicsd,zisicgc")
				if 'zisicsd.isNull(),'zisicgc.isNull(),'zisicts.isNull(),Db.isDefined("ZUTBLISICTS","zisicsd,zisicgc,zisicts") set output.piece("|",51) = Db.getOneRow("TDES","ZUTBLISICTS","zisicsd,zisicgc,zisicts")
				if 'inc.isNull(),Db.isDefined("UTBLIC","inc") set output.piece("|",52) = Db.getOneRow("DESC","UTBLIC","inc")
				set output.piece("|",53) = cif.hph
				set output.piece("|",54) = cif.aph
				set output.piece("|",55) = cif.bph
				set output.piece("|",56) = cif.bphext
				set output.piece("|",57) = cif.faxnum
				set output.piece("|",58) = $S(cif.zvipflg=1:"Yes",1:"No")
				set output.piece("|",59) = cif.extcif
				set output.piece("|",60) = cif.dod.toString("YEAR/MM/DD")
				set output.piece("|",61) = cif.email
				if 'zrrt.isNull(),Db.isDefined("ZUTBLRRT","zrrt") set output.piece("|",62) =  Db.getOneRow("DESC","ZUTBLRRT","zrrt")
				set output.piece("|",63) = cif.atn
				set output.piece("|",64) = cif.zcrrtdt.toString("YEAR/MM/DD")
				if 'zkycstat.isNull(),Db.isDefined("ZUTBLKYCSTAT","zkycstat") set output.piece("|",65) = Db.getOneRow("DESC1","ZUTBLKYCSTAT","zkycstat")
				set output.piece("|",66) = cif.zstfid
				set output.piece("|",67) = $S(cif.znfa<0:"-",1:"+")	//Net Fixed Asset (exclude Land) Sign "-" for minus, "+" for plus
				set output.piece("|",68) = cif.znfa
				set output.piece("|",69) = $S(cif.as<0:"-",1:"+")	//Annual Sales Sign "-" for minus, "+" for plus
				set output.piece("|",70) = cif.as
				set output.piece("|",71) = cif.ne
				
				set output.piece("|",72) = $S(cif.ta<0:"-",1:"+")	//Total Assets Sign "-" for minus, "+" for plus
				set output.piece("|",73) = cif.ta
				set output.piece("|",74) = cif.lfu.toString("YEAR/MM/DD")
				set output.piece("|",75) = $S(cif.nw<0:"-",1:"+") 	//NetWorthSign
				set output.piece("|",76) = cif.nw
				set output.piece("|",77) = $S(cif.cre<0:"-",1:"+")	//CreditLineSign
				set output.piece("|",78) = cif.cre
				set output.piece("|",79) = cif.fye.toString("MM/DD")
				set output.piece("|",80) = cif.govt
				set output.piece("|",81) = cif.con
				set output.piece("|",82) = cif.zextbnk
				set output.piece("|",83) = cif.boo
				set output.piece("|",84) = cif.co
				set output.piece("|",85) = cif.zktbccode
				set output.piece("|",86) = cif.zipc
				set output.piece("|",87) = cif.zcizid
				set output.piece("|",88) = cif.taxid
				set output.piece("|",89) = cif.dlnum
				//if 'pcntry.isNull(),'dlstate.isNull(),Db.isDefined("STBLCNTRY1","pcntry,dlstate") set output.piece("|",90) = Db.getOneRow("DESC","STBLCNTRY1","pcntry,dlstate")
				set output.piece("|",90) = cif.dlexpdt.toString("YEAR/MM/DD")
				set output.piece("|",91) = cif.pasnum
				set output.piece("|",92) = cif.pci
				set output.piece("|",93) = cif.ped.toString("YEAR/MM/DD")
				set output.piece("|",94) = cif.zbotnum
				set output.piece("|",95) = cif.zgovnum
				set output.piece("|",96) = cif.zovrseaj
				set output.piece("|",97) = cif.zciflg
				set output.piece("|",98) = cif.zboiflg
				set output.piece("|",99) = cif.zjin
				set output.piece("|",100) = cif.zjrdate.toString("YEAR/MM/DD")
				set output.piece("|",101) = cif.zswiftcd
				set output.piece("|",102) = cif.zficd
				set output.piece("|",103) = cif.zfiasscd
				set output.piece("|",104) = cif.zintovgov
				set output.piece("|",105) = cif.zothjid
				set output.piece("|",106) = cif.oit
				set output.piece("|",107) = cif.issr
				set output.piece("|",108) = cif.oin
				set output.piece("|",109) = cif.oed.toString("YEAR/MM/DD")
				if 'ccode.isNull(),Db.isDefined("UTBLCC","ccode") set output.piece("|",110) = Db.getOneRow("DESC","UTBLCC","ccode")
				if 'zoffcd.isNull(),Db.isDefined("ZUTBLOFFICER","zoffcd") set output.piece("|",111) = Db.getOneRow("EMPNAME","ZUTBLOFFICER","zoffcd")
				if 'mf.isNull(),Db.isDefined("UTBLMF","mf") set output.piece("|",112) = Db.getOneRow("DESC","UTBLMF","mf")
				if 'zresunit.isNull(),Db.isDefined("UTBLCCNTR","zresunit") set output.piece("|",113) = Db.getOneRow("DESC","UTBLCCNTR","zresunit")
				if 'priv.isNull(),Db.isDefined("STBLCIFPRIV","priv") set output.piece("|",118) = Db.getOneRow("DES","STBLCIFPRIV","priv")
				//set zSTMGRP = Db.getOneRow("STMGRP","CMBCID","cif.cid,110,cif.acn")
				//type RecordCMBGRP zcmb = Db.getRecord("CMBGRP","cif.acn,zSTMGRP")
				//set output.piece("|",115) = zcmb.sfre
				//set output.piece("|",116) = zcmb.addr
				//set output.piece("|",117) = zcmb.sndt
				//set output.piece("|",118) = zcmb.desc
				//set output.piece("|",119) = cif.priv
				set output.piece("|",119) = cif.sol
				set output.piece("|",120) = $S(cif.martel=1:"Yes",1:"No")
				set output.piece("|",121) = $S(cif.marem=1:"Yes",1:"No")
				set output.piece("|",122) = $S(cif.mardm=1:"Yes",1:"No")
				set output.piece("|",123) = $S(cif.agent=1:"Yes",1:"No")
				set output.piece("|",124) = cif.locale
				set output.piece("|",125) = cif.brreg
				set output.piece("|",126) = cif.shhld
				set output.piece("|",127) = $S(cif.cusamt<0:"-",1:"+")
				set output.piece("|",128) = cif.cusamt
				set output.piece("|",129) = cif.cusdate.toString("YEAR/MM/DD")
				set output.piece("|",130) = cif.plan
				set output.piece("|",131) = cif.crcd
				set output.piece("|",132) = cif.rflgc
				set output.piece("|",133) = cif.dao.toString("YEAR/MM/DD")
				set output.piece("|",134) = cif.fmld.toString("YEAR/MM/DD")
				set output.piece("|",135) = cif.convcif
				set output.piece("|",136) = cif.zrbnam
				set output.piece("|",137) = cif.zrbtnam
				set output.piece("|",138) = cif.zcikey
				set output.piece("|",139) = cif.zciupddat.toString("YEAR/MM/DD")
				set output.piece("|",140) = cif.zciby
				set output.piece("|",141) = cif.zcirip1
				set output.piece("|",142) = cif.zciipt1
				set output.piece("|",143) = cif.zcirit
				set output.piece("|",144) = cif.zdataset.toString("YEAR/MM/DD")
				set output.piece("|",145) = $S(cif.zmoufl=1:"Yes",1:"No")
				set output.piece("|",146) = cif.zmemberdt.toString("YEAR/MM/DD")
				set output.piece("|",147) = $S(cif.zktbonfl=1:"Yes",1:"No")
		
					
				
			}
	
		
	set header.piece("|",1) = 0
	set header.piece("|",2)	= 0
	new output
	set output=zheader_"|"_header_"|"_output
	
	quit output
	
LNINQ(String input)
	/*
	type public Number ER = 0
	type public String RM = ""
	
	type Number ACN = "", CNT = 0, recordCount = 0,recordCifCount=0
	type String WHERE=""
	
	set header 		= input.piece("|",1,10)	
	set FunctionFlag 	= input.piece("|",11)	
	set CifId 		= input.piece("|",12)	
	set AcctId		= input.piece("|",13)	
	set LastAcctId 		= input.piece("|",14)	
	
	set output =""
	
	
	
	// Base search on citizenship ID number
	if FunctionFlag = "C" do {
		
		// Search by customer Name
		if CifId.isNull() set ER = 1, RM = "CIF Number required " quit
		if 'Db.isDefined("CIF","ACN=:CifId") set ER = 1, RM = "CIF ID Not Found"
		set WHERE = "ACN="_CifId
			
		}
		
	if FunctionFlag = "A" do {
		
		// Search by customer Name
		if AcctId.isNull() set ER = 1, RM = "Account Number required " quit
		if 'Db.isDefined("DEP","CID=:AcctId") set ER = 1, RM = "Account Not Found"
		set WHERE = "CID="_AcctId
			
		}
	
	
		
	
	
	do {
	
		type String exe()
		
		#ACCEPT Date=04/18/2011; Pgm=Pete Chenard; CR=unknown; Group=Dynamic
		type ResultSet recCount = Db.select("COUNT(CID)","ACN",WHERE)
		if recCount.next() set recordCount = recCount.getCol(1)
	
	}
	
		
		if RecordPerPage.isNull() set RecordPerPage=20
		if CurrentPage.isNull() set CurrentPage=0
		if 'CurrentPage.isNull() set zwait=CurrentPage*RecordPerPage

		set zstart=0
		set exit=0
		set ztmp=""
		set more="N"
		set i=0
		while ds.next() do { quit:exit
		if ds.getRecord().cls ="D" do {
		type RecordACN dep = ds.getRecord()
		
				if (LastAcctId=dep.cid) set zstart=1
				if (zstart=1) do {	
				// For DEP Account(OD)							
				set output.piece("|",1) = dep.cid
				set output.piece("|",2) = dep.grp			
				set output.piece("|",3) = dep.type		
				set output.piece("|",4) = ""			
				set output.piece("|",5) = "0010"			
				set output.piece("|",6) = dep.TITLE1+dep.TITLE2+ dep.TITLE3+dep.TITLE4			
				set output.piece("|",7) = dep.odt
				set output.piece("|",8) = dep.boo
				set output.piece("|",9) = dep.cc
				set output.piece("|",10) = dep.crcd
				set output.piece("|",11) = dep.zstatcd
				set output.piece("|",12) = $S(dep.zcltot'<0:"+",1:"-")
				set output.piece("|",13) = dep.zcltot
				set output.piece("|",14) = ""
				type RecordZODTIER od = Db.getRecord("ZODTIER","d.cid,")
				set output.piece("|",15) = od.ctrcdate.toString("YEAR/MM/DD")
				set output.piece("|",16) = od.expdt.toString("YEAR/MM/DD")
				set output.piece("|",17) = $S(dep.bal'<0:"+",1:"-")
				set output.piece("|",18) = dep.bal
				set output.piece("|",19) = $S(dep.balavl'<0:"+",1:"-")
				set output.piece("|",20) = dep.avlbal
				set output.piece("|",21) = dep.negacr+dep.negacrun
				set output.piece("|",22) = dep.zasint
				set output.piece("|",23) = dep.zarrpur
				set output.piece("|",24) = dep.zisicsd
				set output.piece("|",25) = dep.zisicgc
				set output.piece("|",26) = dep.zisicts
				set output.piece("|",27) = $S(dep.zcomline=1:"Yes",1:"No")
				set output.piece("|",28) = dep.darcls
				set output.piece("|",29) = dep.zcrdsc
				set output.piece("|",30) = relcode.reltyp
				set output.piece("|",31) = dep.zresunit
				set output.piece("|",32) = dep.zaccoid
				set output.piece("|",33) = dep.acn
				
				// For LN Account							
				set output.piece("|",1) = ln.cid
				set output.piece("|",2) = ln.grp			
				set output.piece("|",3) = ln.type		
				set output.piece("|",4) = ln.subt			
				set output.piece("|",5) = ln.zmktcd			
				set output.piece("|",6) = ln.TITLE1+ln.TITLE2+ ln.TITLE3+ln.TITLE4			
				set output.piece("|",7) = ln.odt
				set output.piece("|",8) = ln.boo
				set output.piece("|",9) = ln.cc
				set output.piece("|",10) = ln.crcd
				set output.piece("|",11) = ln.stat
				set output.piece("|",12) = $S(ln.zcltot'<0:"+",1:"-")
				set output.piece("|",13) = ln.zcltot
				set output.piece("|",14) = ln.trm
				set output.piece("|",15) = ln.odt.toString("YEAR/MM/DD")
				set output.piece("|",16) = lm.mdt.toString("YEAR/MM/DD")
				set output.piece("|",17) = $S(ln.bal'<0:"+",1:"-")
				set output.piece("|",18) = ln.bal
				set output.piece("|",19) = $S(ln.balavl'<0:"+",1:"-")
				set output.piece("|",20) = ln.avlbal
				//set output.piece("|",21) = ln.negacr+dep.negacrun
				set output.piece("|",22) = $S(ln.zdelstat=2:ln.acr,1:0)
				set output.piece("|",23) = ln.zarrpur
				set output.piece("|",24) = ln.zisicsd
				set output.piece("|",25) = ln.zisicgc
				set output.piece("|",26) = ln.zisicts
				set output.piece("|",27) = $S(ln.zcomline=1:"Yes",1:"No")
				set output.piece("|",28) = ln.darcls
				set output.piece("|",29) = ln.zcrdsc
				set output.piece("|",30) = relcode.reltyp
				set output.piece("|",31) = ln.zresunit
				set output.piece("|",32) = ln.zaccoid
				set output.piece("|",33) = ln.acn
				
				
				}
				if (i=20) set exit=1, zstart = 0, more="1" quit 
					
				set zheader.piece("|",1) = dep.acn
				set zheader.piece("|",1) = recordCount
				set zheader.piece("|",1) = more
				set ztmp=ztmp_output
				set i=i+1			
			}
		if ds.getRecord().cls ="L" do {	
				
				
				}
			}
		
		
		
	
	set output=""
	set output=header_"|"_zheader_"|"_ztmp			
	*/
	quit output
	
ACCTINQ(String input)
	/*
	type public Number ER = 0
	type public String RM = ""
	type String respCode = "0000", respDesc = ""
	type Number ACN = "",recordCount = 0
	type String WHERE=""
	
	set zheader 		= input.piece("|",1,10)	
	set AcctNo = input.piece("|",11)	
		
	
	set output =""
	if 'AcctNo.isNull() do {
		
		// Search by customer Name
		
		if 'Db.isDefined("ACN","CID=:AcctNo") set ER = 1, RM = "Account Not Found"
		set WHERE = "CID="_AcctNo
			
		}
		set ztmp=""
		type DbSet ds = Db.selectDbSet("ACN",WHERE)
		while ds.next() do {
		if ds.getRecord().cls = "D" do {
		type RecordDEP dep = Db.getRecord("DEP","CID=:AcctNo")
		
				
				set output.piece("|",1) = dep.cid
				set output.piece("|",2) = dep.cls
				set output.piece("|",3) = dep.grp
				type RecordSTBLGRP grp = Db.getRecord("STBLGRP","CLS=:dep.cls,grp=:dep.grp")
				set output.piece("|",4) = grp.des
				set output.piece("|",5) = dep.type
				type RecordPRODCTL tpe = Db.getRecord("PRODCTL","TYPE=:dep.type")
				set output.piece("|",6) = tpe.des
				set output.piece("|",7) = dep.title1
				set output.piece("|",8) = dep.acn
				set output.piece("|",9) = dep.odt.toString("YEAR/MM/DD")
				set output.piece("|",10) = dep.tld.toString("YEAR/MM/DD")
				set output.piece("|",11) = dep.dtc.toString("YEAR/MM/DD")
				set output.piece("|",12) = dep.boo
				type RecordUTBLBRCD boo = Db.getRecord("UTBLBRCD","BRCD=:dep.type")
				set output.piece("|",13) = boo.desc
				set output.piece("|",14) = dep.cc
				type RecordUTBLCCNTR cc = Db.getRecord("UTBLCCNTR","CC=:dep.cc")
				set output.piece("|",15) = cc.desc
				set output.piece("|",16) = dep.crcd
				set output.piece("|",17) = dep.zstatcd
				type RecordZUTBLSTATD stat = Db.getRecord("ZUTBLSTATD","ZSTATCD=:dep.zstatcd")
				set output.piece("|",18) = stat.DES
				set output.piece("|",19) = dep.zresunit
				type RecordUTBLCCNTR unit = Db.getRecord("UTBLCCNTR","CC=:dep.zresunit")
				set output.piece("|",20) = unit.desc
				set output.piece("|",21) = dep.acnrelc
				type RecordUTBLREL2 relc = Db.getRecord("UTBLREL2","GRP=:dep.cls,KEY=:dep.acnrelc")
				set output.piece("|",22) = relc.desc
				type RecordACNADDR ddr 	 = Db.getRecord("ACNADDR","CID=:dep.cid")
				set output.piece("|",23) = ddr.ad1
				set output.piece("|",24) = ddr.ad2
				set output.piece("|",25) = ddr.ad3
				set output.piece("|",26) = ddr.ZSDISTCD
				type RecordZUTBLSDISTCD zdist = Db.getRecord("ZUTBLSDISTCD","ddr.cntry,ddr.state,ddr.city,ddr.zsdistcd"))
				set output.piece("|",27) = Db.getOneRow("DESC","ZUTBLSDISTCD","ddr.cntry,ddr.state,ddr.city,ddr.zsdistcd")
				set output.piece("|",28) = ddr.city
				set output.piece("|",29) = Db.getOneRow("DES","ZUTBLDIST","ddr.cntry,ddr.state,ddr.city")
				set output.piece("|",30) = ddr.state
				set output.piece("|",31) = Db.getOneRow("DESC","STBLCNTRY1","ddr.cntry,ddr.state")
				set output.piece("|",32) = ddr.mzip
				set output.piece("|",33) = ddr.cntry
				set output.piece("|",34) = dep.bal
				set output.piece("|",35) = dep.balavl
				set output.piece("|",36) = dep.zarrpur
				set output.piece("|",37) = Db.getOneRow("DESC","ZUTBLARRPUR","dep.cls,dep.zarrpur")
				set output.piece("|",38) = dep.zpercons
				set output.piece("|",39) = Db.getOneRow("DESC","ZUTBLPERCONS","dep.type,dep.zpercons")
				set output.piece("|",40) = dep.zisicsd
				set output.piece("|",41) = Db.getOneRow("TDES","ZUTBLISICSD","dep.zisicsd")
				set output.piece("|",42) = dep.zisicgc
				set output.piece("|",43) = Db.getOneRow("TDES","ZUTBLISICGC","dep.zisicsd,dep.zisicgc")
				set output.piece("|",44) = dep.zisicts
				set output.piece("|",45) = Db.getOneRow("TDES","ZUTBLISICTS","dep.zisicsd,dep.zisicgc,dep.zisicts")
				set output.piece("|",46) = dep.mf
				set output.piece("|",47) = dep.smet
				set output.piece("|",48) = dep.glsc
				set output.piece("|",49) = dep.irn
				set output.piece("|",50) = dep.index
				set output.piece("|",51) = dep.zsmecd
				set output.piece("|",52) = Db.getOneRow("DESC","ZUTBLSMECD","dep.zsmecd")
				set output.piece("|",53) = dep.zmaster
				set output.piece("|",54) = dep.zeduflg
				set output.piece("|",55) = dep.chkhld
				//set output.piece("|",56) = $S(dep.zvipflg=1:"Yes",dep.zvipflg=0:"No")
				set output.piece("|",57) = dep.pbi
				set output.piece("|",58) = dep.negacr+dep.negacrun
				set output.piece("|",59) = dep.negacr
				set output.piece("|",60) = dep.negacrun
				set output.piece("|",61) = dep.posacr
				set output.piece("|",62) = dep.trm
				set output.piece("|",63) = Db.getOneRow("DESC","RFLG","dep.cid,dep.rflg")
				set output.piece("|",64) = dep.zsallpd
				
				}
		if ds.getRecord().cls = "L" do {
		type RecordLN ln = Db.getRecord("LN","CID=:AcctNo")		
				set output.piece("|",1) = ln.cid
				set output.piece("|",2) = ln.cls
				set output.piece("|",3) = ln.grp
				type RecordSTBLGRP grp = Db.getRecord("STBLGRP","CLS=:ln.cls,grp=:ln.grp")
				set output.piece("|",4) = grp.des
				set output.piece("|",5) = ln.type
				type RecordPRODCTL tpe = Db.getRecord("PRODCTL","TYPE=:ln.type")
				set output.piece("|",6) = tpe.des
				set output.piece("|",7) = ln.title1
				set output.piece("|",8) = ln.odt
				set output.piece("|",9) = ln.acn
				set output.piece("|",10) = ln.tld
				set output.piece("|",11) = ln.dtc
				set output.piece("|",12) = ln.boo
				type RecordUTBLBRCD boo = Db.getRecord("UTBLBRCD","BRCD=:ln.type")
				set output.piece("|",13) = boo.desc
				set output.piece("|",14) = ln.cc
				type RecordUTBLCCNTR cc = Db.getRecord("UTBLCCNTR","CC=:ln.cc")
				set output.piece("|",15) = cc.desc
				set output.piece("|",16) = ln.crcd
				set output.piece("|",17) = ln.stat
				type RecordSTBLSTATL stat = Db.getRecord("STBLSTATL","STAT=:ln.stat")
				set output.piece("|",18) = stat.DESC
				set output.piece("|",19) = ln.zresunit
				type RecordUTBLCCNTR unit = Db.getRecord("UTBLCCNTR","CC=:ln.zresunit")
				set output.piece("|",20) = unit.desc
				set output.piece("|",21) = ln.acnrelc
				type RecordUTBLREL2 relc = Db.getRecord("UTBLREL2","GRP=:ln.cls,KEY=:ln.acnrelc")
				set output.piece("|",22) = relc.desc
				type RecordACNADDR ddr 	 = Db.getRecord("ACNADDR","CID=:ln.cid")
				set output.piece("|",23) = ddr.ad1
				set output.piece("|",24) = ddr.ad2
				set output.piece("|",25) = ddr.ad3
				set output.piece("|",26) = ddr.ZSDISTCD
				type ResultSet zdist = Db.select("DESC","ZUTBLSDISTCD","CNTRY=:ddr.CNTRY AND STATE=:ddr.STATE AND DIST=:ddr.city AND SUBDIST=:ddr.zsdistcd")
				set output.piece("|",27) = Db.getOneRow("DESC","ZUTBLSDISTCD","ddr.cntry,ddr.state,ddr.city,ddr.zsdistcd")
				set output.piece("|",28) = ddr.city
				set output.piece("|",29) = Db.getOneRow("DES","ZUTBLDIST","ddr.cntry,ddr.state,ddr.city")
				set output.piece("|",30) = ddr.state
				set output.piece("|",31) = Db.getOneRow("DESC","STBLCNTRY1","ddr.cntry,ddr.state")
				set output.piece("|",32) = ddr.mzip
				set output.piece("|",33) = ddr.cntry
				set output.piece("|",34) = ln.bal
				set output.piece("|",35) = ln.avlbal
				set output.piece("|",36) = ln.zarrpur
				set output.piece("|",37) = Db.getOneRow("DESC","ZUTBLARRPUR","ln.cls,ln.zarrpur")
				set output.piece("|",38) = ln.zpercons
				set output.piece("|",39) = Db.getOneRow("DESC","ZUTBLPERCONS","ln.type,ln.zpercons")
				set output.piece("|",40) = ln.zisicsd
				set output.piece("|",41) = Db.getOneRow("TDES","ZUTBLISICSD","ln.zisicsd")
				set output.piece("|",42) = ln.zisicgc
				set output.piece("|",43) = Db.getOneRow("TDES","ZUTBLISICGC","ln.zisicsd,ln.zisicgc")
				set output.piece("|",44) = ln.zisicts
				set output.piece("|",45) = Db.getOneRow("TDES","ZUTBLISICTS","ln.zisicsd,ln.zisicgc,ln.zisicts")
				set output.piece("|",46) = ln.mf
				set output.piece("|",47) = ln.smet
				set output.piece("|",48) = ln.glsc
				set output.piece("|",49) = ln.irn
				set output.piece("|",50) = ln.index
				set output.piece("|",51) = ln.zsmecd
				set output.piece("|",52) = Db.getOneRow("DESC","ZUTBLSMECD","ln.zsmecd")
				set output.piece("|",53) = ln.subt
				set output.piece("|",54) = ln.zmktcd
				set output.piece("|",55) = Db.getOneRow("DESC","ZUTBLMKTCD","ln.grp,ln.subt,ln.mktcd")
				set output.piece("|",56) = ln.crlmt
				set output.piece("|",57) = ln.trm
				set output.piece("|",58) = ln.dtnt.toString("YEAR/MM/DD")
				set output.piece("|",59) = ln.mdt.toString("YEAR/MM/DD")
				//set output.piece("|",60) = ln.negacrun
				if (ln.zdelstat=2) set output.piece("|",61) = ln.acr
				else set output.piece("|",61) = 0
				set output.piece("|",62) = ln.zaccoid
				set output.piece("|",63) = ln.darcls
				set output.piece("|",64) = Db.getOneRow("DESC","UTBLACC","ln.cls,ln.darcls")
				set output.piece("|",63) = ln.zcrdsc
				set output.piece("|",63) = ln.zlgid
				set output.piece("|",63) = ln.zcomline
				set output.piece("|",63) = ln.ccl
				set output.piece("|",63) = ln.pcm
				set output.piece("|",64) = Db.getOneRow("DESC","UTBLPCM","ln.grp,ln.pcm")
				set output.piece("|",63) = ln.auptcid
				set output.piece("|",63) = ln.gtdue
				set output.piece("|",63) = ln.zsplend
				set output.piece("|",64) = Db.getOneRow("DESC","ZUTBLSPLEND","ln.zsplend")
				set output.piece("|",63) = ln.ZCOMMNTYCD
				set output.piece("|",64) = Db.getOneRow("DESC","ZUTBLCOMMCD","ln.ZCOMMNTYCD")
				set output.piece("|",63) = ln.zresflg
				set output.piece("|",63) = ln.schnd
				set output.piece("|",63) = ln.zpwof
				set output.piece("|",63) = ln.zpwos
				set output.piece("|",63) = ln.coa
				set output.piece("|",63) = ln.zfwos
				set output.piece("|",63) = ln.mcnd
				set output.piece("|",63) = ln.lchg
				set output.piece("|",63) = ln.tdr
				set output.piece("|",63) = ln.poam
				set output.piece("|",63) = ln.daa
				set output.piece("|",63) = ln.dfp
				set output.piece("|",63) = ln.odd
				set output.piece("|",63) = ln.ladt
				set output.piece("|",63) = ln.lpdt
				set output.piece("|",63) = ln.duin
				set output.piece("|",63) = ln.dupr
				type RecordCRCD crcd = Db.getRecord("CRCD","CO=:%CO,CRCD=:ln.crcd")
				set output.piece("|",63) = crcd.midrate
				set output.piece("|",63) = crcd.finspot
				set output.piece("|",63) = ln.cctlb
				set output.piece("|",63) = ln.zextcfin
				set output.piece("|",64) = Db.getOneRow("UTBLACC","ln.cls,ln.zextcfin")
				
				
				

				
				
				}
	
		
	set header.piece("|",1) = 0
	set header.piece("|",2)	= 0
	set output=zheader_"|"_header_"|"_ztmp
	*/
	quit output
SALAK(String input)
	
	/* Created By Ravipong Chumsai Na Ayuthaya 04/10/11 */
							
	type public Number ER = 0
	type public String RM = ""
	type Number ACN = "", recordCount = 0,recordCifCount=0
	type String WHERE=""
	
	set zheader 		= input.piece("|",1,10)	
	set SearchFlg 		= input.piece("|",11)	
	set Cercid		= input.piece("|",12)	
	set SalakId		= input.piece("|",13)	
	set CerId	 	= input.piece("|",14)
	set CurrentPage 	= input.piece("|",15)
	set RecordPerPage 	= input.piece("|",16)	
	
	new output
	set output=""
	/*
	if SearchFlg = "C" do {
		
		// Search by customer Name
		if 'SearchVal1.isNull() do {
			set WHERE = "ZXNAME BETWEEN '"_SearchVal1_"' AND '"_SearchVal1_$C(255)_"'"
			if 'SearchVal2.isNull() set WHERE = WHERE_" AND LNM BETWEEN '"_SearchVal2_"' AND "_SearchVal2_$C(255)
		}
		if SearchVal1.isNull(),'SearchVal2.isNull() set WHERE = "LNM BETWEEN '"_SearchVal2_"' AND "_SearchVal2_$C(255)
			
		
		
		}
	if SearchFlg = "I" do {
		
		// Search by Identification Number
		if 'SearchVal1.isNull() do {
			type ResultSet rs = Db.select("ACN","CIF","ZCIZID=:SearchVal1")
			if 'rs.next() set ER = 1, RM = "Customer Citizenship ID Not Found: "_ SearchVal1 quit
			set ACN = rs.getCol("ACN")
			set WHERE = "ACN="_ACN
			
		}
		
		
	}
	
	if SearchFlg = "P" do {
		
		// Search by Passport Number
		if 'SearchVal1.isNull() do {
			type ResultSet rs = Db.select("ACN","CIF","PASNUM=:SearchVal1")
			if 'rs.next() set ER = 1, RM = "Passport Number Not Found: "_SearchVal1 quit
			set ACN = rs.getCol("ACN")
			set WHERE = "ACN="_ACN
		}
		
	}	
	if SearchFlg = "T" do {
		
		// Search by Tax ID
		if 'SearchVal1.isNull() do {
			type ResultSet rs = Db.select("ACN","CIF","TAXID=:SearchVal1")
			if 'rs.next() set ER = 1, RM = "Tax ID Not Found: "_SearchVal1 quit
			set ACN = rs.getCol("ACN")
			set WHERE = "ACN="_ACN
		}
		 
		
		
	}
	
		 
		
		
	
	
	if WHERE.isNull() set ER = 1, RM = "Invalid Inquiry"
	if ER set header.piece("|",2) = RM, header.piece("|",1) = 1 quit zheader_"|"_header
	
	do {
	
		type String exe()

		type ResultSet recCount = Db.select("COUNT(ACN)","CIF",WHERE)
		if recCount.next() set recordCount = recCount.getCol(1)
	
	}
	
		
		
		if RecordPerPage.isNull() set RecordPerPage=20
		if CurrentPage.isNull() set CurrentPage=0
		if 'CurrentPage.isNull() do {
		
		set zwait=CurrentPage*RecordPerPage
		//set WHERE =WHERE_" AND ACN>"_LastSearchVal
		
		}
		
		set zstart=0
		set ztmp=""
		set exit=0
		type DbSet ds = Db.selectDbSet("CIF",WHERE)
		set more="N"
		set i=0
		while ds.next() do { quit:exit
		
		type RecordCIF cif = ds.getRecord()
			if (i'<zwait) set zstart=1
				
			if zstart=1 do { 
					
				set output.piece("|",1) = zcert.cid
				set ztitle=cif.ztitle
				if 'cif.ztitle.isNull(),Db.isDefined("ZUTBLTITLE","cif.ztitle,0") set output.piece("|",2) = Db.getOneRow("DESC","ZUTBLTITLE","ztitle,0")		
				set output.piece("|",3) = zcert.certid		
				set output.piece("|",4) = zcert.lotl-zcert.loth			
				set output.piece("|",5) = zcert.grp			
				set output.piece("|",6) = zcert.period			
				set output.piece("|",7) = dep.title1
				set output.piece("|",8) = zcert.unit	
				set output.piece("|",9) = zcert.bal
				set output.piece("|",10) = zcol.botcode
				set output.piece("|",11) = zcol.subbot
				set output.piece("|",12) = zcol.doclct	
				set header.piece("|",13) = zcol.noncrm		
				
				if (i>zwait) set exit=1, footer.piece("|",1)= zcert.	
			}
			
	set header.piece("|",1) = 0
	set header.piece("|",2)	= ""	
	set header.piece("|",4) = recordCount
	set header.piece("|",5) = more
	set output=zheader_"|"_header_"|"_ztmp			
	if ER set header.piece("|",2) = RM, header.piece("|",1) = 1 quit zheader_"|"_header
	*/	
	quit output	
DESC(OM,IM)
	set ret=""
	//set where= w.piece(""
	//String s,String f,String w
	//if s.isNull()!f.isNull()!w.isNull() quit ""
	set X = "set OM=Db.getOneRow"_"(IM)"
	XECUTE X
	//type DbSet tmp = Db.selectDbSet(f,w)
	//type ResultSet tmp = Db.select(s,f,w)
	//if tmp.next() set ret=tmp.s
	
	
	quit 
	
	
	
	
	
