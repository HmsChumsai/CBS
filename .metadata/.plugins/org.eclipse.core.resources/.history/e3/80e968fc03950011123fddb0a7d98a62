//DO NOT MODIFY  Batch for ACN Extraction|ZBEXTCM2||||||ZACNCTRCOL|||100|32000||0|||10|10|0||0|CID|0
---------- REVHIST ------ Section marker

---------- OPEN    ------ Section marker

---------- SCHINIT ------ Section marker

---------- SCHEXEC ------ Section marker

---------- SCHPOST ------ Section marker

---------- SCHEXIT ------ Section marker

---------- THRINIT ------ Section marker

---------- THREXEC ------ Section marker

---------- EXEC    ------ Section marker

	new output,ZDATA,ZCLS,ZCID,GRPDES,PRODDES,STATDESC,BRCDESC,MKTCDES,ZSUBT 
	set (ZDATA,GRPDES,PRODDES,BRCDESC,STATDESC,MKTCDES,SUBDESC)  = ""
	set ZCID = CID
	
		
	do ZEXT()
	quit		

ZEXT()		
		type RecordACN acn = Db.getRecord("ACN","CID=:ZCID",1)
		if acn.getMode()=0 quit
		set output.piece("|",36)=""
		set ZCLS = acn.CLS
		set ZSUBT= acn.ZSUBT
		type RecordTMPRPT1 zextcms2 =Class.new("RecordTMPRPT1")
		set zextcms2.PID = "ZEXTCMS2"
		set zextcms2.key1 = ZCID
		
		if ZCLS="D" do {
			type RecordDEP dep = Db.getRecord("DEP","CID=:ZCID")
			set output.piece("|",1) = dep.cid
			set output.piece("|",2) = dep.cls
			set output.piece("|",3) = dep.grp
			
			if 'dep.grp.isNull() do {			
			type RecordSTBLGRP desc = Db.getRecord("STBLGRP","CLS=:dep.cls,GRP=dep.grp",1)
			if 'desc.getMode()=0 set GRPDES = desc.des			
			}
			
			set output.piece("|",4) = GRPDES
			set output.piece("|",5) = dep.type
			
			if 'dep.type.isNull() do {
			type RecordPRODCTL desc = Db.getRecord("PRODCTL","TYPE=:dep.type",1)
			if 'desc.getMode()=0 set PRODDES = desc.des
			}
			
			set output.piece("|",6) = PRODDES
			set output.piece("|",7) = dep.title1
			set output.piece("|",8) = dep.acn
			set output.piece("|",9) = dep.zstatcd
			
			if 'dep.zstatcd.isNull() do {
			type RecordZUTBLSTATD desc = Db.getRecord("ZUTBLSTATD","ZSTATCD=:dep.zstatcd",1)
			if 'desc.getMode()=0 set STATDESC = desc.des
			}
			
			set output.piece("|",10) = STATDESC
			set output.piece("|",11) = dep.bal
			set output.piece("|",12) = dep.balavl
			set output.piece("|",13) = dep.ZMASTER
			set output.piece("|",14) = ""
			set output.piece("|",15) = ""
			set output.piece("|",16) = ""
			set output.piece("|",17) = dep.zcltot   
			if dep.tld'=0,dep.tld'="" set output.piece("|",18) = dep.tld.toString("YEAR-MM-DD")_"-00.00.00"
			if dep.dtc'=0,dep.dtc'="" set output.piece("|",19) = dep.dtc.toString("YEAR-MM-DD")_"-00.00.00"
			set output.piece("|",20) = dep.boo
			
			if 'dep.boo.isNull() do {
			type RecordUTBLBRCD desc = Db.getRecord("UTBLBRCD","BRCD=:dep.boo",1)
			if 'desc.getMode()=0 set BRCDESC = desc.desc		
			}
			
			set output.piece("|",21) = BRCDESC
			set output.piece("|",22) = dep.NEGACR+dep.NEGACRUN
			set output.piece("|",23) = dep.ZASINT
			set output.piece("|",24) = dep.zlgid
			set output.piece("|",25) = ""
			set output.piece("|",26) = ""
			set output.piece("|",27) = ""
			set output.piece("|",28) = ""
			set output.piece("|",29) = ""
			set output.piece("|",30) = dep.darcls
			set output.piece("|",31) = ""
			if 'ZSUBT.isNull() do {
			type RecordUTBLSUBT desc = Db.getRecord("UTBLSUBT","GRP=:dep.grp,KEY=:ZSUBT",1)
			if 'desc.getMode()=0 set SUBDESC = desc.desc
			}
			
			set output.piece("|",32) = SUBDESC
			set output.piece("|",33) = ""
			set output.piece("|",34) = dep.ODLIM
			set output.piece("|",36) = ""
			
			
			}
	
		if (ZCLS="L") do {
		type RecordLN ln = Db.getRecord("LN","CID=:ZCID")
			
			set output.piece("|",1) = ln.cid
			set output.piece("|",2) = ln.cls
			set output.piece("|",3) = ln.grp
			
			if 'ln.grp.isNull() do {
			type RecordSTBLGRP desc = Db.getRecord("STBLGRP","CLS=:ln.cls,GRP=:ln.grp",1)
			if 'desc.getMode()=0 set GRPDES = desc.des
			}
			
			set output.piece("|",4) = GRPDES
			set output.piece("|",5) = ln.type
			
			if 'ln.type.isNull() do {
			
			type RecordPRODCTL desc = Db.getRecord("PRODCTL","TYPE=:ln.type",1)
			if 'desc.getMode()=0 set PRODDES = desc.des
			
			}
			
			set output.piece("|",6) = PRODDES
			set output.piece("|",7) = ln.title1
			set output.piece("|",8) = ln.acn
			set output.piece("|",9) = ln.stat
			
			if 'ln.zstatcd.isNull() do {
			
			type RecordZUTBLSTATD desc = Db.getRecord("ZUTBLSTATD","ZSTATCD=:ln.zstatcd",1)
			if 'desc.getMode()=0 set STATDESC = desc.des
			
			}
			set output.piece("|",10) = STATDESC
			set output.piece("|",11) = ln.bal
			set output.piece("|",12) = ln.balavail
			set output.piece("|",13) = ""
			set output.piece("|",14) = ln.subt
			set output.piece("|",15) = ln.zmktcd
			
			if 'ln.zmktcd.isNull() do {
			
			type RecordZUTBLMKTCD desc = Db.getRecord("ZUTBLMKTCD","GRP=:ln.grp,SUBT=:ln.subt,CODE=:ln.zmktcd",1)
			if 'desc.getMode()=0 set MKTCDES = desc.DESC
			
			}
			set output.piece("|",16) = MKTCDES
			set output.piece("|",17) = ln.crlmt
			if ln.tld'=0,ln.tld'="" set output.piece("|",18) = ln.tld.toString("YEAR-MM-DD")_"-00.00.00"
			if ln.dtc'=0,ln.dtc'="" set output.piece("|",19) = ln.dtc.toString("YEAR-MM-DD")_"-00.00.00"
			set output.piece("|",20) = ln.boo
			
			if 'ln.boo.isNull() do {
			type RecordUTBLBRCD desc = Db.getRecord("UTBLBRCD","BRCD=:ln.boo",1)
			if 'desc.getMode()=0 set BRCDESC = desc.desc
			
			}
			set output.piece("|",21) = BRCDESC
			
			if ln.ZDELSTAT=1 		set output.piece("|",22) = ln.acr
			if ln.ZDELSTAT=2 		set output.piece("|",22) = 0
			if 'ln.ZDELSTAT=2,ln.ZDELSTAT=1 set output.piece("|",22) = ""
			
			if ln.ZDELSTAT=2 		set output.piece("|",23) = ln.acr
			if 'ln.ZDELSTAT=2 		set output.piece("|",23) = 0
			
			
			set output.piece("|",24) = ln.zlgid
			set output.piece("|",25) = ln.gtdue
			set output.piece("|",26) = ln.mcnd
			set output.piece("|",27) = ln.lchg
			set output.piece("|",28) = ln.duin
			set output.piece("|",29) = ln.dupr
			set output.piece("|",30) = ln.darcls
			set output.piece("|",31) = ln.rescls
			if 'ZSUBT.isNull() do {
			type RecordUTBLSUBT desc = Db.getRecord("UTBLSUBT","GRP=:ln.grp,KEY=:ZSUBT",1)
			if 'desc.getMode()=0 set SUBDESC = desc.desc
			}
			
			set output.piece("|",32) = SUBDESC
			if ln.DTNT'=0,ln.DTNT'="" set output.piece("|",33) = ln.DTNT.toString("YEAR-MM-DD")_"-00.00.00"
			set output.piece("|",34) = ""
			set output.piece("|",35) = ln.cctlb
			set output.piece("|",36) = ln.MCHG
			
		}
		set zextcms2.DATA = output
		do zextcms2.bypassSave()
			
	quit
	
---------- THREXIT ------ Section marker
