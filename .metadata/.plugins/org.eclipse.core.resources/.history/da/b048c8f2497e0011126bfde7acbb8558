//DO NOT MODIFY  Utility for CIF Extract|ZEXTUTIL|||||||1


	/*
	ORIG: Ravipong Chumsai Na Ayuthaya - 15/12/2011
	DESC: CMS Conversion-Extraction Utility
	*/


	do SYSVAR^SCADRV0()

CIFEXT()
	
	new ZFID,tWRITE,ZDATA
	set ZPID = "ZEXTCMS"
	//set ZTJD = %SystemDate
	//set ZEXTDAT = $$DAT^%ZM(ZTJD,"YEARMMDD")
	type IO io=Class.new("IO")
	set io.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_CIF_"_ZEXTDAT_".TXT"
	set io.openParams="NEWV/WRITE"
	set io.recordSize = 1024
	do io.open()
	//Setup Header
	
	set tWRITE = "ACN"_"|"_"THAI_TITLE|THAI_FNAME|THAI_LNAME|THAI_MNAME|CITIZEN_ID|TAX_ID|LEGAL_ADDR1"
	set tWRITE = tWRITE_"|LEGAL_ADDR2|LEGAL_ADDR3|LEGAL_TAMBOL_CD|LEGAL_AMPHUR_CD|LEGAL_PROVINCE_CD"
	set tWRITE = tWRITE_"|LEGAL_COUNTRY_CD|LEGAL_POSTAL_CD|HOME_PHONE|MOBILE_PHONE|OFFICE_PHONE"
	set tWRITE = tWRITE_"|OFFICE_PHONE_EXT|JURISTIC_ID|MAILING_ADDR1|MAILING_ADDR2|MAILING_ADDR3"
	set tWRITE = tWRITE_"|MAILING_TAMBOL_CD|MAILING_AMPHUR_CD|MAILING_PROVINCE_CD|MAILING_COUNTRY_CD"
	set tWRITE = tWRITE_"|MAILING_POSTAL_CD|OFFICE_ADDR1|OFFICE_ADDR3|OFFICE_ADDR2|OFFICE_TAMBOL_CD"
	set tWRITE = tWRITE_"|OFFICE_AMPHUR_CD|OFFICE_PROVINCE_CD|OFFICE_COUNTRY_CD|OFFICE_POSTAL_CD"
	set tWRITE = tWRITE_"|MARITAL_STATUS|SEX|DATE_OF_BIRTH|FAX_NUMBER|EMAIL|CUST_CD|CUST_TYPE|PASSPORT_NUMBER|2012-01-01-00.00.00|CONVERSION|"
	
	do io.write(tWRITE)
	
	
	set ZDATA=""
	
	set ZPOINTER=$O(^ZCONV("ACN",""))
	set i=0
	while 'ZPOINTER.isNull() do { 
		new ZDATA
		set ZDATA = ^ZCONV("ACN",ZPOINTER)_"|2012-01-01-00.00.00|CONVERSION|"
		do io.write(ZDATA)
		set ZPOINTER=$O(^ZCONV("ACN",ZPOINTER))
		set i=i+1
	}
	write !,i
	do io.close()
	
	quit
	
ACNEXT()	
	
	new ZFID,tWRITE,ZDATA
	set ZPID = "ZEXTCMS2"
	set ZTJD = %SystemDate
	//set ZEXTDAT = $$DAT^%ZM(ZTJD,"YEARMMDD")
	set ZDATA=""
	type IO io=Class.new("IO")
	set io.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ACN_"_ZEXTDAT_".TXT"
	set io.recordSize = 1024
	set io.openParams="NEWV/WRITE"
	do io.open()
	
	set tWRITE = "CID|PRODUCT_CLASS|PRODUCT_GRP|PRODUCT_GRP_DESC|PRODUCT_TYPE|PRODUCT_TYPE_DESC|ACCT_NAME"
	set tWRITE = tWRITE_"|PRIMARY_CIF|ACCT_STATUS|ACCT_STATUS_DESC|OUTS_BAL|AVAIL_BAL"
	set tWRITE = tWRITE_"|MASTER_ACCT_NO|ACCT_SUBTYPE|MARKET_CD|MARKET_CD_DESC|LIMIT_AMT|DT_OPENED"
	set tWRITE = tWRITE_"|DT_CLOSED|OWNER_BR|OWNER_BR_DESC|INT_RECEIVE|INT_SUSPENSE"
	set tWRITE = tWRITE_"|LEGAL_ID|TOTAL_DUE|MISC_CHARGE|LATE_CHARGE_AMT"
	set tWRITE = tWRITE_"|INT_PASS_DUE|PRIN_PASS_DUE|LOAN_CLASS|RESCIDENCE_CLASS|ACCT_SUBTYPE_DESC|DATE_OF_NOTE|OD_LIMIT|TOTAL_LOAN_BAL|UNPAID_FEE|2012-01-01-00.00.00|CONVERSION|"
	
	do io.write(tWRITE)
	
	set ZPOINTER=$O(^ZCONV("CID",""))
	
	while 'ZPOINTER.isNull() do { 
		new ZDATA
		set ZDATA = ^ZCONV("CID",ZPOINTER)_"|2012-01-01-00.00.00|CONVERSION|"
		do io.write(ZDATA)
		set ZPOINTER=$O(^ZCONV("CID",ZPOINTER))
		
	}
	
	do io.close()
	
	quit

	
ZCOLEXT()
	
	do SYSVAR^SCADRV0()
	
	type IO io=Class.new("IO")
	set io.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_COL_"_ZEXTDAT_".TXT"
	set io.recordSize = 2048
	set io.openParams="NEWV/WRITE"
	do io.open()
	
	type IO io2=Class.new("IO")
	set io2.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCOLOWNLINK_"_ZEXTDAT_".TXT"
	set io2.recordSize = 1024
	set io2.openParams="NEWV/WRITE"
	do io2.open()
	
	
	
	set tWRITE = "AMPHUR"_"|"_"AO"_"|"_"APDCODE"_"|"_"APPBOO"_"|"_"APPBY"_"|"_"APPDT"_"|"_"APPOFF1"_"|"_"APPOFF2"_"|"_"APPOFF3"_"|"_"APPTID"_"|"_"APPVAL"
	set tWRITE = tWRITE_"|"_"ASDATE"_"|"_"BKNUMBER"_"|"_"BLASTID"_"|"_"BLDCODE"_"|"_"BLDNAME"_"|"_"BLDNUM"_"|"_"BLDTYPE"_"|"_"BLDVAL"_"|"_"BOO"
	set tWRITE = tWRITE_"|"_"BOOTFR"_"|"_"BOTCODE"_"|"_"BOTRSKRT"_"|"_"BSOI"_"|"_"BSTRTID"_"|"_"BUILDNO"_"|"_"CACN"_"|"_"CC"_"|"_"CCRDT"_"|"_"CCRNUM"
	set tWRITE = tWRITE_"|"_"CERNO"_"|"_"CID"_"|"_"CMDCD"_"|"_"COLL"_"|"_"COLSUBT"_"|"_"COLTYP"_"|"_"CONDPAR"_"|"_"CONVDT"_"|"_"CRCD"_"|"_"DATETRF"
	set tWRITE = tWRITE_"|"_"DESC"_"|"_"DOB"_"|"_"DOCLCT"_"|"_"DOD"_"|"_"ENGCAP"_"|"_"EXTRSKR"_"|"_"FLOOR"_"|"_"GRPNO"_"|"_"GTEL"_"|"_"INSREQ"_"|"_"KTBRKR"_"|"_"LNDINFO"
	set tWRITE = tWRITE_"|"_"LNDNO"_"|"_"LNDVAL"_"|"_"LNDVOL1"_"|"_"LNDVOL2"_"|"_"LNDVOL3"_"|"_"LNDVOL4"_"|"_"LOC1"_"|"_"LOC2"_"|"_"LOC3"_"|"_"LQCD"_"|"_"LRTRVDT"
	set tWRITE = tWRITE_"|"_"MCODE1"_"|"_"MCODE2"_"|"_"NONCRM"_"|"_"OPRIMKEY"_"|"_"OWNLNDVOL1"_"|"_"OWNLNDVOL2"_"|"_"OWNLNDVOL3"_"|"_"OWNLNDVOL4"_"|"_"OWNPORTN"
	set tWRITE = tWRITE_"|"_"PACN"_"|"_"PAGENO"_"|"_"PARTLFLG"_"|"_"PAYPARTY"_"|"_"PCHPRICE"_"|"_"PCOLVAL"_"|"_"PERSONID"_"|"_"PROVINCE"_"|"_"RAVANG"
	set tWRITE = tWRITE_"|"_"REASON"_"|"_"REMARKS"_"|"_"RESPUNIT"_"|"_"RIGHBAL"_"|"_"RIGHVAL"_"|"_"RMAREA"_"|"_"RMKPORTN"_"|"_"RMNUMBER"_"|"_"ROAD"
	set tWRITE = tWRITE_"|"_"RSCD"_"|"_"RULCOST"_"|"_"SEQNO"_"|"_"SHRHLDRG"_"|"_"SHRTNAME"_"|"_"STCKNO"_"|"_"STOREY"_"|"_"SUBBOT"_"|"_"SYMBOL"_"|"_"TAMBOL"
	set tWRITE = tWRITE_"|"_"TOTPORTN"_"|"_"UNITCD"_"|"_"USEDSTDT"_"|"_"SEFULIF"_"|"_"ZATEEXP"_"|"_"ZATEISSUEDT"_"|"_"ZATEISSUER"_"|"_"ZATENUM"_"|"_"ZCERTBAL"
	set tWRITE = tWRITE_"|"_"ZCERTCID"_"|"_"ZCERTGRP"_"|"_"ZCERTID"_"|"_"ZCERTLOTH"_"|"_"ZCERTLOTL"_"|"_"ZCERTPERIOD"_"|"_"ZCERTUNIT"_"|"_"ZLGISSUEDT"_"|"_"ZLGNUM"_"|"_"ZRADUR"_"|"_"ZRAEXP"_"|"_"ZRAISSUER"_"|"_"ZRANUM"_"|"_"ZRATYPE"
	set tWRITE = tWRITE_"|"_"BONDTYPE"_"|"_"BONDCODE"_"|"_"BONDNAME"_"|"_"ISSYEAR"_"|"_"BSEQ"_"|"_"BOWNNAME"_"|"_"BEXPDATE"_"|"_"BINTRATE"_"|"_"BUPRICE"
	set tWRITE = tWRITE_"|"_"MKDATE"_"|"_"MKPRICE"_"|"_"TOTBNVAL"_"|"_"LISTED"_"|"_"SENIORITY"_"|"_"APPAMT"_"|"_"SHRTNAME"_"|"_"STCKTYP"_"|"_"STCKNAME"
	set tWRITE = tWRITE_"|"_"ISSNAME"_"|"_"TAXID"_"|"_"ISSDATE"_"|"_"NOSHARE"_"|"_"PARPRC"_"|"_"PARD"_"|"_"BKPRICE"_"|"_"BKDATE"_"|"_"ISSRSKRT"_"|"_"STCKTYP2"_"|"_"RSKWOCL"_"|"_"STCKSHR"
	
	
	
	do io.write(tWRITE)
	
	
	set tWRITE = "ACN|COLL|PAROWNFLG|2012-01-01-00.00.00|CONVERSION|"
	
	
	do io2.write(tWRITE)
	set i = 0
	
	
	
	set ZPOINT1=$O(^ZCONV("COLLEXT",""))
	while 'ZPOINT1.isNull() do {
		new ZDATA1
		set ZDATA1=^ZCONV("COLLEXT",ZPOINT1)
		do io.write(ZDATA1)
		set ZPOINT1=$O(^ZCONV("COLLEXT",ZPOINT1))
	}
	
	
	set ZPOINT2=$O(^ZCONV("ZCOLOWNLINK",""))
	while 'ZPOINT2.isNull() do {
		new ZDATA2
		set ZDATA2=^ZCONV("ZCOLOWNLINK",ZPOINT2)_"|2012-01-01-00.00.00|CONVERSION|"
		do io2.write(ZDATA2)
		set ZPOINT2=$O(^ZCONV("ZCOLOWNLINK",ZPOINT2))
	}
	
	do io.close()	
	do io2.close()
		
	
	//type ResultSet rs = Db.select("DATA,KEY1","TMPRPT1","PID=:ZPID")
	//first 1000
	/*
	set ZPOINTER = $O(^ZCONV("COLL",""))
	while 'ZPOINTER.isNull() do { 
		
		
		set (ZDATA,ZDATA2,ZRSCOL,ZSUBBOTDES,ZCNT,ztmp,ZTMP2DATA,ZTMP5DATA)=""	
		//set ZRSCOL	= rs.getCol(2)
		set ZDATA 	= ^ZCONV("COLL",ZPOINTER)
		set ZBOO	= ZDATA.piece("|",20)
		set ZCOLTYP 	= ZDATA.piece("|",36)
		set ZCOLSUBT	= ZDATA.piece("|",35)
		set ZBOTCD	= ZDATA.piece("|",22)
		set ZSUBBOTCD	= ZDATA.piece("|",98)
		set ZAMT	= ZDATA.piece("|",11)
		set ZCOLLID	= ZDATA.piece("|",34)
		//set ZPACN	= ZDATA.piece("|",73)
		set ZCOLL	= ZDATA.piece("|",34)
		set APPRAISEDBY = ZDATA.piece("|",5)
		set APPRAISEDDT = ZDATA.piece("|",6).toString("DD/MM/YEAR")
		set APPRAISALVAL = ZDATA.piece("|",11)
		set ZDETAIL	= ""
		set ZPOINTER = $O(^ZCONV("COLL",ZPOINTER))		
	
		set (ZBRNAME,ZCOLTYPDES,ZSUBBOTDES,ZCOLSUBDESC)="N/A"
		
		
		if Db.isDefined("UTBLBRCD","BRCD=:ZBOO") do {
			type RecordUTBLBRCD zbr = Db.getRecord("UTBLBRCD","BRCD=:ZBOO")
			set ZBRNAME = zbr.desc
		}
		if Db.isDefined("ZUTBLCOLTYP","COLCD=:ZCOLTYP") do {
			type RecordZUTBLCOLTYP coldesc = Db.getRecord("ZUTBLCOLTYP","COLCD=:ZCOLTYP")  
			set ZCOLTYPDESC=coldesc.desc
		}
		if Db.isDefined("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT") do {
			type RecordZUTBLCOLSUBT colsubdesc = Db.getRecord("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT")
			set ZCOLSUBDESC = colsubdesc.desc
		}
		

		
		type ResultSet botdesc = Db.select("DESC","ZUTBLSUBBOT","BOTCODE=:ZBOTCD AND SUBBOT=:ZSUBBOTCD")
		if 'botdesc.isEmpty(),botdesc.next() set ZSUBBOTDES=botdesc.getCol(1)
		
		type ResultSet rscol = Db.select("ACN,COLL,PAROWNFLG","ZCOLOWNLINK","COLL=:ZCOLL")
		while rscol.next() do {
			set ZACN=rscol.getCol(1)
			type RecordTMPRPT5 rpt5 = Db.getRecord("TMPRPT5","PID='ZRPT5',ZBOO,ZCOLTYP,ZCOLSUBT,ZCOLLID,ZACN",1)
			type RecordCIF cif = Db.getRecord("CIF","ACN=:rscol.getCol(1)") 
			set ZTMP5DATA.piece("|",1) = ZBRNAME
			set ZTMP5DATA.piece("|",2) = ZCOLTYPDES
			set ZTMP5DATA.piece("|",3) = ZCOLSUBDESC
			set ZTMP5DATA.piece("|",4) = rscol.getCol(2)	//COLL
			set ZTMP5DATA.piece("|",5) = ZACN
			set ZTMP5DATA.piece("|",6) = cif.fname_"-"_cif.lnm
			
			set rpt5.DATA = ZTMP5DATA
			do rpt5.save()
			
			set ZDATA2 = rscol.getCol(1)_"|"_rscol.getCol(2)_"|"_rscol.getCol(3)
			do io2.write(ZDATA2)
		}
		
			if ZSUBBOTCD="" set ZSUBBOTCD="N/A"
			if ZBOTCD=""    set ZBOTCD="N/A"
			if ZBOO="" 	set ZBOO="N/A"
			if ZCOLTYP=""	set ZCOLTYP="N/A"
			if ZCOLSUBT=""	set ZCOLSUBT="N/A"
			
			
			
			
		type RecordTMPRPT5 rpt2 = Db.getRecord("TMPRPT5","PID=:ZRPT1,ZBOO,ZCOLTYP,ZCOLSUBT,ZBOTCD,ZSUBBOTCD",1)
		set ZTMP2DATA.piece("|",1) = ZBRNAME
		set ZTMP2DATA.piece("|",2) = ZCOLTYPDESC
		set ZTMP2DATA.piece("|",3) = ZCOLSUBDESC
		set ZTMP2DATA.piece("|",4) = ZSUBBOTDES
		set ZTMP2DATA.piece("|",5) = rpt2.DATA.piece("|",5)+1
		set ZTMP2DATA.piece("|",6) = rpt2.DATA.piece("|",6)+ZAMT
		set rpt2.DATA		   = ZTMP2DATA		
		do rpt2.save()
					
		do io.write(ZDATA)
		
			
	}
	*/
		
	
			
	quit

ZCTRCTEXT()
	
	do SYSVAR^SCADRV0()	
	
		
	new ZPID,tWRITE,ZDATA1,ZDATA2,ZDATA3,ZDATA4,ZTMP,ZCID,ZACN
	set ZPID = "ZCONVCNT"
	//set TJD = %Systemdate
	//set ZEXTDAT = $$DAT^%ZM(TJD,"YEARMMDD")
	
	
	type IO io1=Class.new("IO")
	set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCT_"_ZEXTDAT_".TXT"
	set io1.openParams="NEWV/WRITE"
	set io1.recordSize = 1024
	do io1.open()
	set tWRITE = "BOO"_"|"_"CC"_"|"_"CONTRREL"_"|"_"CONVDT"_"|"_"CRTDATE"_"|"_"CRTUSER"_"|"_"CTRCT"_"|"_"CTRCTDT"_"|"_"CTRSTAT"_"|"_"MCTRCT"
	set tWRITE = tWRITE_"|"_"PLDGAMT"_"|"_"PLDGSEQ"_"|"_"RELDATE"_"|"_"REMARKS"_"|"_"RESPUNIT"
	do io1.write(tWRITE)
	
	type IO io2=Class.new("IO")
	set io2.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTACN_"_ZEXTDAT_".TXT"
	set io2.openParams="NEWV/WRITE"
	set io2.recordSize = 1024
	do io2.open()
	set tWRITE = "CID|CTRCT|2012-01-01-00.00.00|CONVERSION|"
	do io2.write(tWRITE)
	
	set ZEXTDAT="20120403"
	type IO io3=Class.new("IO")
	set io3.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTCIF_"_ZEXTDAT_".TXT"
	set io3.openParams="NEWV/WRITE"
	set io3.recordSize = 1024
	do io3.open()
	set tWRITE = "ACN|CTRCT|2012-01-01-00.00.00|CONVERSION|"
	do io3.write(tWRITE)
	
	type DbSet ds3 = Db.selectDbSet("TMPRPT3","KEY1='ZCTRCTCIF'")
	while ds3.next() do {
		
		set DATA=ds3.getRecord().data
		do io3.write(DATA_"|2012-01-01-00.00.00|CONVERSION|")
	}
	//do Db.fastDelete("TMPRPT3","KEY1='ZCTRCTCIF'")
	
	quit
	
	type IO io4=Class.new("IO")
	set io4.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTCOL_"_ZEXTDAT_".TXT"
	set io4.openParams="NEWV/WRITE"
	set io4.recordSize = 1024
	do io4.open()
	set tWRITE = "CTRCT"_"|"_"COLL"_"|"_"CCSTAT"_"|"_"PLDGVAL"_"|"_"RELDATE"_"|"_"PLDGAMT"_"|"_"CRTDATE"_"|"_"CRTUSER"
	
	do io4.write(tWRITE)
	//type Date ZCTRCTDT,ZRELDATE
	set ZPOINTER1 = $O(^ZCONV("CONTRACT",""))
	set ZPOINTER2 = $O(^ZCONV("ZCTRCTACN",""))
	set ZPOINTER3 = $O(^ZCONV("ZCTRCTCIF",""))
	set ZPOINTER4 = $O(^ZCONV("ZCTRCTCOL",""))
	
	
	while 'ZPOINTER1.isNull() do {
	//type String ZDATA1
	set ZDATA1=^ZCONV("CONTRACT",ZPOINTER1)
	do io1.write(ZDATA1)
	set ZPOINTER1 = $O(^ZCONV("CONTRACT",ZPOINTER1))
	}
	
	while 'ZPOINTER2.isNull() do {
	//type String ZDATA2
	set ZDATA2=^ZCONV("ZCTRCTACN",ZPOINTER2)_"|2012-01-01-00.00.00|CONVERSION|"
	do io2.write(ZDATA2)
	set ZPOINTER2 = $O(^ZCONV("ZCTRCTACN",ZPOINTER2))
	}
	/*
	while 'ZPOINTER3.isNull() do {
	//type String ZDATA3
	set ZDATA3=^ZCONV("ZCTRCTCIF",ZPOINTER3)_"|2012-01-01-00.00.00|CONVERSION|"
	do io3.write(ZDATA3)
	set ZPOINTER3 = $O(^ZCONV("ZCTRCTCIF",ZPOINTER3))
	}
	*/
	while 'ZPOINTER4.isNull() do {
	//type String ZDATA4
	set ZDATA4=^ZCONV("ZCTRCTCOL",ZPOINTER4)
	do io4.write(ZDATA4)
	set ZPOINTER4 = $O(^ZCONV("ZCTRCTCOL",ZPOINTER4))
	}
	
	
		
	
	do io1.close()
	do io2.close()
	do io3.close()
	do io4.close()
	
	quit
	
ZRPT()	

	set TJD="20120402"
	set ZRPT1="ZRPT1"
	set ZRPT2="ZRPT2"
	set ZRPT3="ZRPT3"
	set ZTMP3="ZTMP3"
	
	
	set ZRPT5="ZRPT5"

	type IO io1=Class.new("IO")
	set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"CONV1_CBSRPT_"_TJD_".TXT"
	set io1.openParams="NEWV/WRITE"
	do io1.open()
	
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"COLTYP"_"|"_"COLTYP DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"BOTCODE"_"|"_"SUBBOTCODE"_"|"_"SUBBOTDESC"_"|"_"SUMCOL"_"|"_"SUMCOLAMT"
	do io1.write(tWRITE)
	
	type ResultSet rs1 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT1")
	while rs1.next() do {
		type String tWRITE
		set ZBRNAME     = rs1.getCol(6).piece("|",1)
		set ZCOLTYPDESC = rs1.getCol(6).piece("|",2)
		set ZCOLSUBDESC = rs1.getCol(6).piece("|",3)
		set ZSUBBOTDES	= rs1.getCol(6).piece("|",4)
		set ZSUM	= rs1.getCol(6).piece("|",5)
		set ZAMT	= rs1.getCol(6).piece("|",6)
		//set tWRITE = rs1.getCol(1)_"|"_rs1.getCol(2)_"|"_rs1.getCol(3)_"|"_rs1.getCol(4)_"|"_rs1.getCol(5)_"|"_rs1.getCol(6)_"|"
		set tWRITE.piece("|",1) = rs1.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs1.getCol(2)
		set tWRITE.piece("|",4) = ZCOLTYPDESC
		set tWRITE.piece("|",5) = rs1.getCol(3)
		set tWRITE.piece("|",6) = ZCOLSUBDESC
		set tWRITE.piece("|",7) = rs1.getCol(4)
		set tWRITE.piece("|",8) = rs1.getCol(5)
		set tWRITE.piece("|",9) = ZSUBBOTDES
		set tWRITE.piece("|",10) = ZSUM
		set tWRITE.piece("|",11) = ZAMT
		do io1.write(tWRITE)
		}
	do io1.close()
	
	
	type IO io2=Class.new("IO")
	set io2.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"CONV2_CBSRPT_"_TJD_".TXT"
	set io2.openParams="NEWV/WRITE"
	do io2.open()
	set tWRITE = "BOO|BOO_DESC|CTRTYP|CTRTYP_DESC|CTRSTATUS|CTRSTATUS_DESC|SUMCTR|SUMCTRAMT"
	do io2.write(tWRITE)
	
	type ResultSet rs2 = Db.select("KEY1,KEY2,KEY3,DATA","TMPRPT3","PID=:ZRPT2")
	while rs2.next() do {
		type String tWRITE
		set ZBRNAME     = rs2.getCol(4).piece("|",3)
		set ZCTRDESC 	= rs2.getCol(4).piece("|",4)
		set ZSTATDESC 	= rs2.getCol(4).piece("|",5)
		
		set tWRITE.piece("|",1) = rs2.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs2.getCol(2)
		set tWRITE.piece("|",4) = ZCTRDESC
		set tWRITE.piece("|",5) = rs2.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs2.getCol(4).piece("|",1)	//SUM
		set tWRITE.piece("|",8) = rs2.getCol(4).piece("|",2)	//AMOUNT
		do io2.write(tWRITE)
		}
	do io2.close()
	
	/*
	type IO io3=Class.new("IO")
	set io3.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT3_"_TJD_".TXT"
	set io3.openParams="NEWV/WRITE"
	do io3.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"PRODUCTTYP|PRODCUTTYP_DESC"_"|"_"SUMACCT"_"|"_"COLTYP"_"|"_"COLTYP_DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"SUMCOL"
	do io3.write(tWRITE)
	type ResultSet rs3 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT3")
	while rs3.next() do {
		new tWRITE
		set ZBOO		= rs3.getCol(1)
		set ZTYP		= rs3.getCol(2)
		set ZSTAT		= rs3.getCol(3)
		set ZPROD		= rs3.getCol(4)
		set ZBRNAME		= rs3.getCol(5).piece("|",2)
		set ZCTRTYPDES		= rs3.getCol(5).piece("|",3)
		set ZSTATDESC		= rs3.getCol(5).piece("|",4)
		set ZPRODDESC		= rs3.getCol(5).piece("|",5)
		
		set tWRITE.piece("|",1) = ZBOO
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = ZTYP
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = ZSTAT
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = ZPROD
		set tWRITE.piece("|",8) = ZPRODDESC
		set tWRITE.piece("|",9) = rs3.getCol(5).piece("|",1)
		
		
		type ResultSet ztmp3 = Db.select("KEY4,KEY5,DATA","TMPRPT5","PID=:ZTMP3 AND KEY1=:ZBOO AND KEY2=:ZTYP AND KEY3=:ZSTAT")
		if ztmp3.isEmpty() quit
			
		while ztmp3.next() do {
			set ZCOLTYPDESC		= ztmp3.getCol(3).piece("|",1)
			set ZCOLTSUBDESC	= ztmp3.getCol(3).piece("|",2)
			set ZSUM		= ztmp3.getCol(3).piece("|",3)
			set tWRITE.piece("|",10)	= ztmp3.getCol(1)	//COLTYP
			set tWRITE.piece("|",11)	= ZCOLTYPDESC
			set tWRITE.piece("|",12)	= ztmp3.getCol(2)	//COLSUBT
			set tWRITE.piece("|",13)	= ZCOLTSUBDESC
			set tWRITE.piece("|",14)	= ZSUM			//SUMCOL
			do io3.write(tWRITE)
		}
			
	}
	do io3.close()	
	*/
	/*
	type IO io4=Class.new("IO")
	set io4.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT4_"_TJD_".TXT"
	set io4.recordSize = 1024
	set io4.openParams="NEWV/WRITE"
	do io4.open()
	new tWRITE
	set tWRITE = "BOO"_"|"_"COLTYP"_"|"_"COLSUBT"_"|"_"COLLID"_"|"_"COLLDETAIL"_"|"_"APPRAISEDBY"_"|"_"APPRAISEDDT"_"|"_"APPRAISALVAL"
	do io4.write(tWRITE)
	set ZPOINT = $O(^TMP(ZRPT4,""))
	while ZPOINT do { 		
		set tWRITE = ^TMP(ZRPT4,ZPOINT)
		do io4.write(tWRITE)
		set ZPOINT = $O(^TMP(ZRPT4,ZPOINT))
		}
	do io4.close()
	quit
	*/
	
	
	/*
	type IO io5=Class.new("IO")
	set io5.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT5_"_TJD_".TXT"
	set io5.openParams="NEWV/WRITE"
	do io5.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"COLTYP"_"|"_"COLTYP DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"COLLID"_"|"_"COLLCIF"_"|"_"COLLOWNERNAME"
	do io5.write(tWRITE)
	type ResultSet rs5 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT5 AND KEY1 in ('1,2,565,94')")
	while rs5.next() do {
		set ZBOO		= rs5.getCol(1)
		set ZTYP		= rs5.getCol(2)
		set ZSTAT		= rs5.getCol(3)
		
		set ZBRNAME		= rs5.getCol(6).piece("|",1)
		set ZCTRTYPDES		= rs5.getCol(6).piece("|",2)
		set ZSTATDESC		= rs5.getCol(6).piece("|",3)
		
		set tWRITE.piece("|",1) = ZBOO
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = ZTYP
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = ZSTAT	
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs5.getCol(4)
		set tWRITE.piece("|",8) = rs5.getCol(5)
		set tWRITE.piece("|",9) = rs5.getCol(6).piece("|",6)
		do io5.write(tWRITE)
		}
	do io5.close()
	
	
	type IO io6=Class.new("IO")
	set io6.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT6_"_TJD_".TXT"
	set io6.openParams="NEWV/WRITE"
	do io6.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CONTRACTDT"_"|"_"PLEDGEAMT"_"|"_"MASTERCTRID"_"|"_"RELEASEDDT"
	do io6.write(tWRITE)
	type ResultSet rs6 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT6 AND KEY1=1")
	while rs6.next() do {
		new tWRITE
		set ZBOO		= rs6.getCol(1)
		set ZTYP		= rs6.getCol(2)
		set ZSTAT		= rs6.getCol(3)
	
		set ZBRNAME		= rs6.getCol(5).piece("|",1)
		set ZCTRTYPDES		= rs6.getCol(5).piece("|",2)
		set ZSTATDESC		= rs6.getCol(5).piece("|",3)
		
		set tWRITE.piece("|",1) = rs6.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs6.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs6.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs6.getCol(4)
		set tWRITE.piece("|",8) = rs6.getCol(5).piece("|",4,7)
		do io6.write(tWRITE)
		}
	do io6.close()
	
	
	
	type IO io7=Class.new("IO")
	set io7.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT7_"_TJD_".TXT"
	set io7.openParams="NEWV/WRITE"
	do io7.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CTRCIF"_"|"_"CTROWNERNAME"
	do io7.write(tWRITE)
	type ResultSet rs7 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT7 AND KEY1=1")
	while rs7.next() do {
		
		set ZBOO		= rs7.getCol(1)
		set ZTYP		= rs7.getCol(2)
		set ZSTAT		= rs7.getCol(3)
	
		set ZBRNAME		= rs7.getCol(6).piece("|",1)
		set ZCTRTYPDES		= rs7.getCol(6).piece("|",2)
		set ZSTATDESC		= rs7.getCol(6).piece("|",3)
		
		set tWRITE.piece("|",1) = rs7.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs7.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs7.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs7.getCol(4)
		set tWRITE.piece("|",8) = rs7.getCol(5)
		set tWRITE.piece("|",8) = rs7.getCol(6).piece("|",4)
		do io7.write(tWRITE)
		}
	do io7.close()
	
	
	type IO io8=Class.new("IO")
	set io8.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT8_"_TJD_".TXT"
	set io8.openParams="NEWV/WRITE"
	do io8.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"ACCTTYP"_"|"_"ACCTTYP_DESC"_"|"_"ACCTNO"_"|"_"ACCTNAME"
	do io8.write(tWRITE)
	type ResultSet rs8 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,KEY6,DATA","TMPRPT6","PID=:ZRPT8 AND KEY1=1")
	while rs8.next() do {
		set ZBRNAME		= rs8.getCol(7).piece("|",1)
		set ZCTRTYPDES		= rs8.getCol(7).piece("|",2)
		set ZSTATDESC		= rs8.getCol(7).piece("|",3)
		
		set tWRITE.piece("|",1) = rs8.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs8.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs8.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs8.getCol(4)
		set tWRITE.piece("|",8) = rs8.getCol(5)
		set tWRITE.piece("|",9) = rs8.getCol(7).piece("|",4)
		set tWRITE.piece("|",10) = rs8.getCol(6)
		set tWRITE.piece("|",11) = rs8.getCol(7).piece("|",5)
		do io8.write(tWRITE)
		}
	do io8.close()
	
	
	type IO io9=Class.new("IO")
	set io9.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT9_"_TJD_".TXT"
	set io9.openParams="NEWV/WRITE"
	do io9.open()
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"COLTYP"_"|"_"COLTYP_DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"COLLID"
	do io9.write(tWRITE)
	type ResultSet rs9 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT9 AND KEY1=1")
	while rs9.next() do {
		set ZBRNAME		= rs9.getCol(5).piece("|",1)
		set ZCTRTYPDES		= rs9.getCol(5).piece("|",2)
		set ZSTATDESC		= rs9.getCol(5).piece("|",3)
		set ZCOLTYP		= rs9.getCol(5).piece("|",4)
		set ZCOLTYPDESC		= rs9.getCol(5).piece("|",5)
		set ZCOLSUBT		= rs9.getCol(5).piece("|",6)
		set ZCOLSUBTDES		= rs9.getCol(5).piece("|",7)
		set ZCOLL		= rs9.getCol(5).piece("|",8)
		
		set tWRITE.piece("|",1) = rs9.getCol(1)
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rs9.getCol(2)
		set tWRITE.piece("|",4) = ZCTRTYPDES
		set tWRITE.piece("|",5) = rs9.getCol(3)
		set tWRITE.piece("|",6) = ZSTATDESC
		set tWRITE.piece("|",7) = rs9.getCol(4)
		set tWRITE.piece("|",8) = ZCOLTYP
		set tWRITE.piece("|",9) = ZCOLTYPDESC
		set tWRITE.piece("|",10) = ZCOLSUBT
		set tWRITE.piece("|",11) = ZCOLSUBTDES
		set tWRITE.piece("|",12) = ZCOLL
		
		
		do io9.write(tWRITE)
		}
	do io9.close()
	
	*/
	quit

	
	
ZRPT4(i,ZTYP)

	set TJD="20120402"	
	set ZBOO=i	
	//set ZTYP = $O(^TMP("ZRPT4",ZBOO,""))		//COLL TYP
	
	
	//while 'ZTYP.isNull() do {
	
		type IO io1=Class.new("IO")
		set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"CONV4_CBSRPT_TYP_"_ZTYP_"_BOO_"_ZBOO_"_"_TJD_".TXT"
		set io1.recordSize = 1024
		set io1.openParams="NEWV/WRITE"
		do io1.open()
		set zheader=$$GETHEADER(ZTYP)		
		do io1.write(zheader) 		
		
		set ZID = $O(^TMP("ZRPT4",ZBOO,ZTYP,"")) 	//COLL ID	
		while 'ZID.isNull() do {
				
			set ZTMP = ^TMP("ZRPT4",ZBOO,ZTYP,ZID)
			set ZID = $O(^TMP("ZRPT4",ZBOO,ZTYP,ZID))
			do io1.write(ZTMP)
			
		}
		//set ZTYP = $O(^TMP("ZRPT4",ZBOO,ZTYP))
		do io1.close()
	//}

	quit
COUNTRPT()
	set x=0
	set ZRPT1="ZRPT1"
	type ResultSet rs = Db.select("DATA","TMPRPT5","PID=:ZRPT1")
	while rs.next() do {
		set x=x+rs.getCol(1).piece("|",5)
	}
	write !,x
	quit
	//type RecordTMPRPT5 rpt1 = Db.getRecord("TMPRPT5","PID=:ZRPT1,ZBOO,ZCOLTYP,ZCOLSUBT,ZBOTCD,ZSUBBOTCD")	
	
	
	
ZRPT4A(i)

	set TJD="20120402"	
	set ZBOO=i	
	set ZTYP = $O(^TMP("ZRPT4",ZBOO,""))		//COLL TYP
	
	
	while 'ZTYP.isNull() do {
	
		type IO io1=Class.new("IO")
		set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"CONV4_CBSRPT_TYP_"_ZTYP_"_BOO_"_ZBOO_"_"_TJD_".TXT"
		set io1.recordSize = 1024
		set io1.openParams="NEWV/WRITE"
		do io1.open()
		set zheader=$$GETHEADER(ZTYP)		
		do io1.write(zheader) 		
		
		set ZID = $O(^TMP("ZRPT4",ZBOO,ZTYP,"")) 	//COLL ID	
		while 'ZID.isNull() do {
				
			set ZTMP = ^TMP("ZRPT4",ZBOO,ZTYP,ZID)
			set ZID = $O(^TMP("ZRPT4",ZBOO,ZTYP,ZID))
			do io1.write(ZTMP)
			
		}
		set ZTYP = $O(^TMP("ZRPT4",ZBOO,ZTYP))
		do io1.close()
	}
	
	quit
         
ZDETAILRPT()

	set i=1
	set TJD="20120402"
	set ZRPT5="ZRPT5"
	set ZRPT6="ZRPT6"
	set ZRPT7="ZRPT7"
	set ZRPT8="ZRPT8"
	set ZRPT9="ZRPT9"
	
	while (i'<0) do {
		type IO io5=Class.new("IO")
		set io5.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT5BRANCH"_i_"_"_TJD_".TXT"
		set io5.openParams="NEWV/WRITE"
		do io5.open()
		set tWRITE = "BOO|BOO_DESC|COLTYP|COLTYP_DESC|COLSUBT|COLSUBT_DESC|BOT_CODE|SUB_BOT_CODE|COLLID|COLLCIF|COLLOWNERNAME"
		do io5.write(tWRITE)
		type ResultSet rs5 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT5 AND KEY1=:i")
		while rs5.next() do {
			type String tWRITE
			set tWRITE=""
			set ZBOO		= rs5.getCol(1)
			set ZTYP		= rs5.getCol(2)
			set ZSUB		= rs5.getCol(3)
			
			set ZBRNAME		= rs5.getCol(6).piece("|",1)
			set ZTYPDES		= rs5.getCol(6).piece("|",2)
			set ZSUBDESC		= rs5.getCol(6).piece("|",3)
			set ZBOT		= rs5.getCol(6).piece("|",4)
			set ZSUBBOT		= rs5.getCol(6).piece("|",5)
			
			set tWRITE.piece("|",1) = ZBOO
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = ZTYP
			set tWRITE.piece("|",4) = ZTYPDES
			set tWRITE.piece("|",5) = ZSUB
			set tWRITE.piece("|",6) = ZSUBDESC
			set tWRITE.piece("|",7) = ZBOT
			set tWRITE.piece("|",8) = ZSUBBOT
			set tWRITE.piece("|",9) = rs5.getCol(4)
			set tWRITE.piece("|",10) = rs5.getCol(5)
			set tWRITE.piece("|",11) = rs5.getCol(6).piece("|",8)
			do io5.write(tWRITE)
		}
		do io5.close()
		
		type IO io6=Class.new("IO")
		set io6.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT6BRANCH"_i_"_"_TJD_".TXT"
		set io6.openParams="NEWV/WRITE"
		do io6.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CONTRACTDT"_"|"_"PLEDGEAMT"_"|"_"MASTERCTRID"_"|"_"RELEASEDDT"
		do io6.write(tWRITE)
		type ResultSet rs6 = Db.select("KEY1,KEY2,KEY3,KEY4,DATA","TMPRPT4","PID=:ZRPT6 AND KEY1=:i")
		while rs6.next() do {
			type String tWRITE
			set tWRITE=""
			set ZBOO		= rs6.getCol(1)
			set ZTYP		= rs6.getCol(2)
			set ZSTAT		= rs6.getCol(3)
			
			set ZBRNAME		= rs6.getCol(5).piece("|",1)
			set ZCTRTYPDES		= rs6.getCol(5).piece("|",2)
			set ZSTATDESC		= rs6.getCol(5).piece("|",3)
			
			set tWRITE.piece("|",1) = rs6.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs6.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs6.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs6.getCol(4)
			set tWRITE.piece("|",8) = rs6.getCol(5).piece("|",4,7)
			do io6.write(tWRITE)
		}
		do io6.close()
		
		type IO io7=Class.new("IO")
		set io7.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT7BRANCH"_i_"_"_TJD_".TXT"
		set io7.openParams="NEWV/WRITE"
		do io7.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"CTRCIF"_"|"_"CTROWNERNAME"
		do io7.write(tWRITE)
		type ResultSet rs7 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT7 AND KEY1=:i")
		while rs7.next() do {
			type String tWRITE
			set tWRITE=""
			set ZBOO		= rs7.getCol(1)
			set ZTYP		= rs7.getCol(2)
			set ZSTAT		= rs7.getCol(3)
		
			set ZBRNAME		= rs7.getCol(6).piece("|",1)
			set ZCTRTYPDES		= rs7.getCol(6).piece("|",2)
			set ZSTATDESC		= rs7.getCol(6).piece("|",3)
			
			set tWRITE.piece("|",1) = rs7.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs7.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs7.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs7.getCol(4)
			set tWRITE.piece("|",8) = rs7.getCol(5)
			set tWRITE.piece("|",9) = rs7.getCol(6).piece("|",4)
			do io7.write(tWRITE)
		}
		do io7.close()
		
		type IO io8=Class.new("IO")
		set io8.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT8BRANCH"_i_"_"_TJD_".TXT"
		set io8.openParams="NEWV/WRITE"
		do io8.open()
		set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"CTRTYP"_"|"_"CTRTYP_DESC"_"|"_"CTRSTATUS"_"|"_"CTRSTATUS_DESC"_"|"_"CONTRACTID"_"|"_"ACCTTYP"_"|"_"ACCTTYP_DESC"_"|"_"ACCTNO"_"|"_"ACCTNAME"
		do io8.write(tWRITE)
		type ResultSet rs8 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,KEY6,DATA","TMPRPT6","PID=:ZRPT8 AND KEY1=:i")
		while rs8.next() do {
			type String tWRITE
			set ZBRNAME		= rs8.getCol(7).piece("|",1)
			set ZCTRTYPDES		= rs8.getCol(7).piece("|",2)
			set ZSTATDESC		= rs8.getCol(7).piece("|",3)
			
			set tWRITE.piece("|",1) = rs8.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs8.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs8.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs8.getCol(4)
			set tWRITE.piece("|",8) = rs8.getCol(5)
			set tWRITE.piece("|",9) = rs8.getCol(7).piece("|",4)
			set tWRITE.piece("|",10) = rs8.getCol(6)
			set tWRITE.piece("|",11) = rs8.getCol(7).piece("|",5)
			do io8.write(tWRITE)
		}
		do io8.close()
		
		
		type IO io9=Class.new("IO")
		set io9.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT9BRANCH"_i_"_"_TJD_".TXT"
		set io9.openParams="NEWV/WRITE"
		do io9.open()
		set tWRITE = "BOO|BOO_DESC|CTRTYP|CTRTYP_DESC|CTRSTATUS|CTRSTATUS_DESC|CONTRACTID|COLTYP|COLTYP_DESC|COLSUBT|COLSUBT_DESC|BOT_CODE|SUB_BOT_CODE|COLLID"
		do io9.write(tWRITE)
		type ResultSet rs9 = Db.select("KEY1,KEY2,KEY3,KEY4,KEY5,DATA","TMPRPT5","PID=:ZRPT9 AND KEY1=:i")
		while rs9.next() do {
			type String tWRITE
			set ZBRNAME		= rs9.getCol(6).piece("|",1)
			set ZCTRTYPDES		= rs9.getCol(6).piece("|",2)
			set ZSTATDESC		= rs9.getCol(6).piece("|",3)
			set ZCOLTYP		= rs9.getCol(6).piece("|",4)
			set ZCOLTYPDESC		= rs9.getCol(6).piece("|",5)
			set ZCOLSUBT		= rs9.getCol(6).piece("|",6)
			set ZCOLSUBTDES		= rs9.getCol(6).piece("|",7)
			set ZBOT		= rs9.getCol(6).piece("|",8)
			set ZSUBBOT		= rs9.getCol(6).piece("|",9)
			set ZCOLL		= rs9.getCol(5)
			
			set tWRITE.piece("|",1) = rs9.getCol(1)
			set tWRITE.piece("|",2) = ZBRNAME
			set tWRITE.piece("|",3) = rs9.getCol(2)
			set tWRITE.piece("|",4) = ZCTRTYPDES
			set tWRITE.piece("|",5) = rs9.getCol(3)
			set tWRITE.piece("|",6) = ZSTATDESC
			set tWRITE.piece("|",7) = rs9.getCol(4)
			set tWRITE.piece("|",8) = ZCOLTYP
			set tWRITE.piece("|",9) = ZCOLTYPDESC
			set tWRITE.piece("|",10) = ZCOLSUBT
			set tWRITE.piece("|",11) = ZCOLSUBTDES
			set tWRITE.piece("|",12) = ZBOT
			set tWRITE.piece("|",13) = ZSUBBOT
			set tWRITE.piece("|",14) = ZCOLL
			
			
			do io9.write(tWRITE)
		}
		do io9.close()
		
		if i=1 set i=2 quit
		if i=2 set i=94 quit
		if i=94 set i=565 quit
		if i=565 set i=-1 quit
	}	

	quit
	

GETHEADER(ztyp)

		new tWRITE
		if (ztyp=1) do { 
		set tWRITE.piece("|",1) = "LRTRVDT"
		set tWRITE.piece("|",2) = "GRPNO"
		set tWRITE.piece("|",3) = "AMPHUR"
		set tWRITE.piece("|",4) = "BKNUMBER"
		set tWRITE.piece("|",5) = "PARTLFLG"
		set tWRITE.piece("|",6) ="LNDNO"
		set tWRITE.piece("|",7) ="LNDVOL1"
		set tWRITE.piece("|",8) ="LNDVOL2"
		set tWRITE.piece("|",9) ="LNDVOL3"
		set tWRITE.piece("|",10) ="LNDVOL4"
		set tWRITE.piece("|",11) ="LOC1"
		set tWRITE.piece("|",12) ="LOC2"
		set tWRITE.piece("|",13) ="LOC3"
		set tWRITE.piece("|",14) ="OWNPORTN"
		set tWRITE.piece("|",15) ="OWNLNDVOL1"
		set tWRITE.piece("|",16) ="OWNLNDVOL2"
		set tWRITE.piece("|",17) ="OWNLNDVOL3"
		set tWRITE.piece("|",18) ="OWNLNDVOL4"
		set tWRITE.piece("|",19) ="PAGENO"
		set tWRITE.piece("|",20) ="CONDPAR"
		set tWRITE.piece("|",21) ="RMKPORTN"
		set tWRITE.piece("|",22) ="PROVINCE"
		set tWRITE.piece("|",23) ="RAVANG"
		set tWRITE.piece("|",24) ="SEQNO"
		set tWRITE.piece("|",25) ="TAMBOL"
		set tWRITE.piece("|",26) ="TOTPORTN"
		set tWRITE.piece("|",27) ="LNDINFO"
		set tWRITE.piece("|",28) ="PROVINCE"
		set tWRITE.piece("|",29) ="ROAD"
		set tWRITE.piece("|",30) ="BSOI"
		set tWRITE.piece("|",31) ="TAMBOL"
		set tWRITE.piece("|",32) ="BLDCODE"
		set tWRITE.piece("|",33) ="BLDNAME"
		set tWRITE.piece("|",34) ="BLDNUM"
		set tWRITE.piece("|",35) ="BUILDNO"
		set tWRITE.piece("|",36) ="RMNUMBER"
		set tWRITE.piece("|",37) ="STOREY"
		set tWRITE.piece("|",38) ="RMAREA"
			
	}
	
	if (ztyp=2)!(ztyp=8) do { 
		set tWRITE.piece("|",1) = "LRTRVDT"
		set tWRITE.piece("|",2) = "PROVINCE"
		set tWRITE.piece("|",3) = "ROAD"
		set tWRITE.piece("|",4) = "BSOI"
		set tWRITE.piece("|",5) = "TAMBOL"
		set tWRITE.piece("|",6) ="BLDCODE"
		set tWRITE.piece("|",7) ="BLDNAME"
		set tWRITE.piece("|",8) ="BLDNUM"
		set tWRITE.piece("|",9) ="BUILDNO"
		set tWRITE.piece("|",10) ="RMNUMBER"
		set tWRITE.piece("|",11) ="STOREY"
		set tWRITE.piece("|",12) ="RMAREA"
			
	}
	
	if (ztyp=3)!(ztyp=10) do { 
		set tWRITE.piece("|",1) = "AMPHUR"
		set tWRITE.piece("|",2) = "ENGCAP"
		set tWRITE.piece("|",3) = "MCODE1"
		set tWRITE.piece("|",4) = "MCODE2"
		set tWRITE.piece("|",5) = "UNITCD"
		set tWRITE.piece("|",6) ="USEDSTDT"
		set tWRITE.piece("|",7) ="PROVINCE"
		set tWRITE.piece("|",8) ="ROAD"
		set tWRITE.piece("|",9) ="BSOI"
		set tWRITE.piece("|",10) ="TAMBOL"
		
			
	}
	
	if (ztyp=4) do {
		set tWRITE.piece("|",1) = "CID"
	}
	
	if (ztyp=5)!(ztyp=6) do { 
		set tWRITE.piece("|",1) = "BLASTID"
		set tWRITE.piece("|",2) = "BSTRTID"
		set tWRITE.piece("|",3) = "SHRHLDRG"
	}
	
	if (ztyp=7) do { 
		set tWRITE.piece("|",1) = "GTEL"
		set tWRITE.piece("|",2) = "BSTRTID"
		set tWRITE.piece("|",3) = "SHRHLDRG"
		
	}
	
	if (ztyp=11)!(ztyp=12)!(ztyp=9)!(ztyp=13) do { 

		set tWRITE.piece("|",1) ="AMPHUR"
		set tWRITE.piece("|",2) ="PROVINCE"
		set tWRITE.piece("|",3) ="ROAD"
		set tWRITE.piece("|",4) ="BSOI"
		set tWRITE.piece("|",5) ="TAMBOL"
		set tWRITE.piece("|",6) ="RIGHBAL"
		set tWRITE.piece("|",7) ="ZLGNUM"
		set tWRITE.piece("|",8) ="ZATEISSUER"
		set tWRITE.piece("|",9) ="ZLGISSUEDT"
		set tWRITE.piece("|",10) ="ZATEEXP"
		set tWRITE.piece("|",11) ="ZATEISSUEDT"
		set tWRITE.piece("|",12) ="ZATENUM"
		set tWRITE.piece("|",13) ="ZRAEXP"
		set tWRITE.piece("|",14) ="ZRAISSUER"
		set tWRITE.piece("|",15) ="ZRANUM"
		set tWRITE.piece("|",16) ="ZRATYPE"
		set tWRITE.piece("|",17) ="ASDATE"
		set tWRITE.piece("|",18) ="CCRDT"
		set tWRITE.piece("|",19) ="CCRNUM"
		set tWRITE.piece("|",20) ="PAYPARTY"
		set tWRITE.piece("|",21) ="RIGHVAL"
		set tWRITE.piece("|",22) ="BOOTFR"
		set tWRITE.piece("|",23) ="DATETRF"

			
	}
	
	if (ztyp=14) do { 

		set tWRITE.piece("|",1) ="CID"
		set tWRITE.piece("|",2) ="ZCERTID"
		set tWRITE.piece("|",3) ="ZCERTCID"
		set tWRITE.piece("|",4) ="ZCERTBAL"
		set tWRITE.piece("|",5) ="ZCERTGRP"
		set tWRITE.piece("|",6) ="ZCERTLOTH"
		set tWRITE.piece("|",7) ="ZCERTLOTL"
		set tWRITE.piece("|",8) ="ZCERTPERIOD"
		set tWRITE.piece("|",9) ="ZCERTUNIT"
		
	}
	if (ztyp=99) do { 

		set tWRITE.piece("|",1) ="DESC"
		
	}
	
	

			
	quit "BOO|BOO_DESC|COLTYP|COLTYP_DESC|COLSUBT|COLSUBT_DESC|BOT_CODE|COLLID|"_tWRITE_"|APPRAISEDBY|APPRAISEDDT|APPRAISALVAL"
	
TESTCNT(input,end)

	do SYSVAR^SCADRV0()
	
	
	type Date ZTJD
	new ZPID,tWRITE,ZDATA,ZDATA2,ZRSCOL,ZCNT,ztmp,zlength,ZTMP2DATA
	set ZPID = "ZCONVCNT"
	//set ZTJD = %SystemDate
	//set ZEXTDAT = $$DAT^%ZM(ZTJD,"YEARMMDD")	
	type IO io=Class.new("IO")
	set io.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCT_"_"TEMP"_".TXT"
	set io.recordSize = 2048
	set io.openParams="NEWV/WRITE"
	do io.open()

	
	
	
	set (i,exit)=0
	set ZPOINTER = $O(^TMP("ZCONVCNT",input))
	while 'ZPOINTER.isNull() do { quit:exit
		
		
		if i=end set exit=1 quit
		set ZDATA=""
		set ZDATA = ^TMP("ZCONVCNT",ZPOINTER)
		set ZPOINTER = $O(^TMP("ZCONVCNT",ZPOINTER))
		set i=i+1
		
		do io.write(ZDATA)
		
			
	}
	
		
	do io.close()	
	
			
	quit
	
TESTRPT2()
		kill ^TMP("ZRPT2")
		set i = $O(^ZCONV("CONTRACT",""))
		while 'i.isNull() do {
			set CTRCT=i
			set ZTAB=$C(9)
			set ZENTER=$C(13)
			set ZPROBLEM=$C(10)
			set i = $O(^ZCONV("CONTRACT",i))
		
			type RecordZCONTRACT zcnt = Db.getRecord("ZCONTRACT","CTRCT=:CTRCT")
			set (ZDATA1,ZDATA2,ZDATA3,ZDATA4,ZCID,ZACN,rpt2DATA,rpt3DATA,rpt6DATA,rpt7DATA,rpt8DATA,rpt9DATA,ZCTRCT,ZBOO,ZTYP,ZRELDATE)=""	
			
			set ZCTRCT 	= zcnt.CTRCT	
			set ZBOO 	= zcnt.BOO
	         	set ZTYP 	= zcnt.CONTRREL
	         	if zcnt.CTRCTDT'=0,zcnt.CTRCTDT'="" set ZCTRCTDT = zcnt.CTRCTDT.toString("YEAR-MM-DD")_"-00.00.00"
	         	set ZSTAT 	= zcnt.CTRSTAT
	         	set ZMCTRCT	= zcnt.MCTRCT
	         	set ZAMT	= zcnt.PLDGAMT
	         	if zcnt.RELDATE'=0,zcnt.RELDATE'="" set ZRELDATE = zcnt.RELDATE.toString("YEAR-MM-DD")_"-00.00.00"
	         	
	         
			
			set (ZBRNAME,ZCTRTYPDES,ZSTATDESC)="N/A"
			
			
			if Db.isDefined("UTBLBRCD","BRCD=:ZBOO") do {
				type RecordUTBLBRCD zbr = Db.getRecord("UTBLBRCD","BRCD=:ZBOO")
				set ZBRNAME = zbr.desc
			}
			if Db.isDefined("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT") do {
				type RecordZUTBLCNTSTAT CNTSTAT = Db.getRecord("ZUTBLCNTSTAT","CNTSTAT=:ZSTAT")  
				set ZSTATDESC=CNTSTAT.desc
			}
			if Db.isDefined("ZUTBLCONTREL","CONTRREL=:ZTYP") do {
				type RecordZUTBLCONTREL CONTRREL = Db.getRecord("ZUTBLCONTREL","CONTRREL=:ZTYP")
				set ZCTRTYPDES = CONTRREL.desc
			}
			type RecordTMPRPT3 rpt2 = Db.getRecord("TMPRPT3","PID='ZRPT2',ZBOO,ZTYP,ZSTAT",1)
		         
		         set ZTMPDATA.piece("|",1) = rpt2.DATA.piece("|",1)+1
			 set ZTMPDATA.piece("|",2) = rpt2.DATA.piece("|",2)+ZAMT
			 set ZTMPDATA.piece("|",3) = ZBRNAME
			 set ZTMPDATA.piece("|",4) = ZCTRTYPDES
			 set ZTMPDATA.piece("|",5) = ZSTATDESC
		         set rpt2.DATA	   = ZTMPDATA
		         	
		         do rpt2.save()
		}
	
	quit
TESTRPT1()
	
	set i = $O(^ZCONV("COL",""))
	while 'i.isNull() do {
		
		set COLL=i
		set i = $O(^ZCONV("COL",i))
		set ZTAB=$C(9)
		set ZENTER=$C(13)
		set ZPROBLEM=$C(10)
		
		type RecordZCOL zcol = Db.getRecord("ZCOL","COLL=:COLL")
		new ZDATA
		set ZDATA.piece("|",1) = zcol.AMPHUR
		set ZDATA.piece("|",2) = zcol.AO
		set ZDATA.piece("|",3) = zcol.APDCODE
		set ZDATA.piece("|",4) = zcol.APPBOO
		set ZDATA.piece("|",5) = zcol.APPBY
		set ZDATA.piece("|",6) = zcol.APPDT.toString("YEAR-MM-DD")
		set ZDATA.piece("|",7) = zcol.APPOFF1
		set ZDATA.piece("|",8) = zcol.APPOFF2
		set ZDATA.piece("|",9) = zcol.APPOFF3
		set ZDATA.piece("|",10) = zcol.APPTID
		set ZDATA.piece("|",11) = zcol.APPVAL
		set ZDATA.piece("|",12) = zcol.ASDATE.toString("YEAR-MM-DD")
		set ZDATA.piece("|",13) = zcol.BKNUMBER
		set ZDATA.piece("|",14) = zcol.BLASTID
		set ZDATA.piece("|",15) = zcol.BLDCODE
		set ZDATA.piece("|",16) = zcol.BLDNAME
		set ZDATA.piece("|",17) = zcol.BLDNUM
		set ZDATA.piece("|",18) = zcol.BLDTYPE
		set ZDATA.piece("|",19) = zcol.BLDVAL
		set ZDATA.piece("|",20) = zcol.BOO
		set ZDATA.piece("|",21) = zcol.BOOTFR
		set ZDATA.piece("|",22) = zcol.BOTCODE
		set ZDATA.piece("|",23) = zcol.BOTRSKRT
		set ZDATA.piece("|",24) = zcol.BSOI
		set ZDATA.piece("|",25) = zcol.BSTRTID
		set ZDATA.piece("|",26) = zcol.BUILDNO
		set ZDATA.piece("|",27) = zcol.CACN
		set ZDATA.piece("|",28) = zcol.CC
		set ZDATA.piece("|",29) = zcol.CCRDT.toString("YEAR-MM-DD")
		set ZDATA.piece("|",30) = zcol.CCRNUM
		set ZDATA.piece("|",31) = zcol.CERNO
		set ZDATA.piece("|",32) = zcol.CID
		set ZDATA.piece("|",33) = zcol.CMDCD
		set ZDATA.piece("|",34) = zcol.COLL
		set ZDATA.piece("|",35) = zcol.COLSUBT
		set ZDATA.piece("|",36) = zcol.COLTYP
		set ZDATA.piece("|",37) = zcol.CONDPAR
		set ZDATA.piece("|",38) = zcol.CONVDT.toString("YEAR-MM-DD")
		set ZDATA.piece("|",39) = zcol.CRCD
		set ZDATA.piece("|",40) = zcol.DATETRF.toString("YEAR-MM-DD")
		set ZDATA.piece("|",41) = zcol.DESC
		set ZDATA.piece("|",42) = zcol.DOB.toString("YEAR-MM-DD")
		set ZDATA.piece("|",43) = zcol.DOCLCT
		set ZDATA.piece("|",44) = zcol.DOD.toString("YEAR-MM-DD")
		set ZDATA.piece("|",45) = zcol.ENGCAP
		set ZDATA.piece("|",46) = zcol.EXTRSKR
		set ZDATA.piece("|",47) = zcol.FLOOR
		set ZDATA.piece("|",48) = zcol.GRPNO
		set ZDATA.piece("|",49)	= zcol.GTEL
		set ZDATA.piece("|",50) = zcol.INSREQ
		set ZDATA.piece("|",51) = zcol.KTBRKR
		set ZDATA.piece("|",52) = zcol.LNDINFO
		set ZDATA.piece("|",53) = zcol.LNDNO
		set ZDATA.piece("|",54) = zcol.LNDVAL
		set ZDATA.piece("|",55) = zcol.LNDVOL1
		set ZDATA.piece("|",56) = zcol.LNDVOL2
		set ZDATA.piece("|",57) = zcol.LNDVOL3
		set ZDATA.piece("|",58) = zcol.LNDVOL4
		set ZDATA.piece("|",59) = zcol.LOC1
		set ZDATA.piece("|",60) = zcol.LOC2
		set ZDATA.piece("|",61) = zcol.LOC3
		set ZDATA.piece("|",62) = zcol.LQCD
		set ZDATA.piece("|",63) = zcol.LRTRVDT.toString("YEAR-MM-DD")
		set ZDATA.piece("|",64) = zcol.MCODE1
		set ZDATA.piece("|",65) = zcol.MCODE2
		set ZDATA.piece("|",66) = zcol.NONCRM
		set ZDATA.piece("|",67) = zcol.OPRIMKEY
		set ZDATA.piece("|",68) = zcol.OWNLNDVOL1
		set ZDATA.piece("|",69) = zcol.OWNLNDVOL2
		set ZDATA.piece("|",70) = zcol.OWNLNDVOL3
		set ZDATA.piece("|",71) = zcol.OWNLNDVOL4
		set ZDATA.piece("|",72) = zcol.OWNPORTN
		set ZDATA.piece("|",73) = zcol.PACN
		set ZDATA.piece("|",74) = zcol.PAGENO
		set ZDATA.piece("|",75) = zcol.PARTLFLG
		set ZDATA.piece("|",76) = zcol.PAYPARTY
		set ZDATA.piece("|",77) = zcol.PCHPRICE
		set ZDATA.piece("|",78) = zcol.PCOLVAL
		set ZDATA.piece("|",79) = zcol.PERSONID
		set ZDATA.piece("|",80) = zcol.PROVINCE
		set ZDATA.piece("|",81) = zcol.RAVANG
		set ZDATA.piece("|",82) = zcol.REASON
		set ZDATA.piece("|",83) = zcol.REMARKS
		set ZDATA.piece("|",84) = zcol.RESPUNIT
		set ZDATA.piece("|",85) = zcol.RIGHBAL
		set ZDATA.piece("|",86) = zcol.RIGHVAL
		set ZDATA.piece("|",87) = zcol.RMAREA
		set ZDATA.piece("|",88) = zcol.RMKPORTN
		set ZDATA.piece("|",89) = zcol.RMNUMBER
		set ZDATA.piece("|",90) = zcol.ROAD
		set ZDATA.piece("|",91) = zcol.RSCD
		set ZDATA.piece("|",92) = zcol.RULCOST
		set ZDATA.piece("|",93) = zcol.SEQNO
		set ZDATA.piece("|",94) = zcol.SHRHLDRG
		set ZDATA.piece("|",95) = zcol.SHRTNAME
		set ZDATA.piece("|",96) = zcol.STCKNO
		set ZDATA.piece("|",97) = zcol.STOREY
		set ZDATA.piece("|",98) = zcol.SUBBOT
		set ZDATA.piece("|",99) = zcol.SYMBOL
		set ZDATA.piece("|",100) = zcol.TAMBOL
		set ZDATA.piece("|",101) = zcol.TOTPORTN
		set ZDATA.piece("|",102) = zcol.UNITCD
		set ZDATA.piece("|",103) = zcol.USEDSTDT.toString("YEAR-MM-DD")
		set ZDATA.piece("|",104) = zcol.USEFULIF
		set ZDATA.piece("|",105) = zcol.ZATEEXP.toString("YEAR-MM-DD")
		set ZDATA.piece("|",106) = zcol.ZATEISSUEDT.toString("YEAR-MM-DD")
		set ZDATA.piece("|",107) = zcol.ZATEISSUER
		set ZDATA.piece("|",108) = zcol.ZATENUM
		set ZDATA.piece("|",109) = zcol.ZCERTBAL
		set ZDATA.piece("|",110) = zcol.ZCERTCID
		set ZDATA.piece("|",111) = zcol.ZCERTGRP
		set ZDATA.piece("|",112) = zcol.ZCERTID
		set ZDATA.piece("|",113) = zcol.ZCERTLOTH
		set ZDATA.piece("|",114) = zcol.ZCERTLOTL
		set ZDATA.piece("|",115) = zcol.ZCERTPERIOD
		set ZDATA.piece("|",116) = zcol.ZCERTUNIT
		set ZDATA.piece("|",117) = zcol.ZLGISSUEDT.toString("YEAR-MM-DD")
		set ZDATA.piece("|",118) = zcol.ZLGNUM
		set ZDATA.piece("|",119) = zcol.ZRADUR
		set ZDATA.piece("|",120) = zcol.ZRAEXP.toString("YEAR-MM-DD")
		set ZDATA.piece("|",121) = zcol.ZRAISSUER
		set ZDATA.piece("|",122) = zcol.ZRANUM
		set ZDATA.piece("|",123) = zcol.ZRATYPE
		set ZDATA.piece("|",124) = zcol.BONDTYPE
		set ZDATA.piece("|",125) = zcol.BONDCODE
		set ZDATA.piece("|",126) = zcol.BONDNAME
		set ZDATA.piece("|",127) = zcol.ISSYEAR
		set ZDATA.piece("|",128) = zcol.BSEQ
		set ZDATA.piece("|",129) = zcol.BOWNNAME
		set ZDATA.piece("|",130) = zcol.BEXPDATE.toString("YEAR-MM-DD")
		set ZDATA.piece("|",131) = zcol.BINTRATE
		set ZDATA.piece("|",132) = zcol.BUPRICE
		set ZDATA.piece("|",133) = zcol.MKDATE.toString("YEAR-MM-DD")
		set ZDATA.piece("|",134) = zcol.MKPRICE
		set ZDATA.piece("|",135) = zcol.TOTBNVAL
		set ZDATA.piece("|",136) = zcol.LISTED
		set ZDATA.piece("|",137) = zcol.SENIORITY
		set ZDATA.piece("|",138) = zcol.APPAMT
		set ZDATA.piece("|",139) = zcol.SHRTNAME
		set ZDATA.piece("|",140) = zcol.STCKTYP
		set ZDATA.piece("|",141) = zcol.STCKNAME
		set ZDATA.piece("|",142) = zcol.ISSNAME
		set ZDATA.piece("|",143) = zcol.TAXID
		set ZDATA.piece("|",144) = zcol.ISSDATE.toString("YEAR-MM-DD")
		set ZDATA.piece("|",145) = zcol.NOSHARE
		set ZDATA.piece("|",146) = zcol.PARPRC
		set ZDATA.piece("|",147) = zcol.PARD.toString("YEAR-MM-DD")
		set ZDATA.piece("|",148) = zcol.BKPRICE
		set ZDATA.piece("|",149) = zcol.BKDATE.toString("YEAR-MM-DD")
		set ZDATA.piece("|",150) = zcol.ISSRSKRT
		set ZDATA.piece("|",151) = zcol.STCKTYP2
		set ZDATA.piece("|",152) = zcol.RSKWOCL
		set ZDATA.piece("|",153) = zcol.STCKSHR
		
		//set ^ZCONV("COLLEXT",COLL)=ZDATA
		
		
		set ZAMT = zcol.APPVAL
		set ZBOTCD = zcol.BOTCODE
		set ZSUBBOTCD		= zcol.SUBBOT
		set ZBOO		= zcol.BOO
		set ZCOLTYP		= zcol.COLTYP
		set ZCOLSUBT		= zcol.COLSUBT
		set APPRAISEDBY 	= zcol.APPBY
		set APPRAISEDDT 	= zcol.APPDT.toString("YEAR-MM-DD")
		set APPRAISALVAL 	= zcol.APPVAL
		set (ZDETAIL,ZDATA2)	= ""
		
		

		set ZRPT1="ZRPT1"
		set (ZBRNAME,ZCOLTYPDESC,ZSUBBOTDES,ZCOLSUBDESC)="N/A"
		
			
		
				
		if Db.isDefined("UTBLBRCD","BRCD=:ZBOO") do {
			type RecordUTBLBRCD zbr = Db.getRecord("UTBLBRCD","BRCD=:ZBOO")
			set ZBRNAME = zbr.desc
		}
		if Db.isDefined("ZUTBLCOLTYP","COLCD=:ZCOLTYP") do {
			type RecordZUTBLCOLTYP coldesc = Db.getRecord("ZUTBLCOLTYP","COLCD=:ZCOLTYP")  
			set ZCOLTYPDESC=coldesc.desc
		}
		if Db.isDefined("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT") do {
			type RecordZUTBLCOLSUBT colsubdesc = Db.getRecord("ZUTBLCOLSUBT","COLCD=:ZCOLTYP,COLSUBT=:ZCOLSUBT")
			set ZCOLSUBDESC = colsubdesc.desc
		}
		
		type ResultSet botdesc = Db.select("DESC","ZUTBLSUBBOT","BOTCODE=:ZBOTCD AND SUBBOT=:ZSUBBOTCD")
		if 'botdesc.isEmpty(),botdesc.next() set ZSUBBOTDES=botdesc.getCol(1)
		
		if ZSUBBOTCD="" set ZSUBBOTCD="N/A"
		if ZBOTCD=""    set ZBOTCD="N/A"
		if ZBOO="" 	set ZBOO="N/A"
		if ZCOLTYP=""	set ZCOLTYP="N/A"
		if ZCOLSUBT=""	set ZCOLSUBT="N/A"
		
					
		type RecordTMPRPT5 rpt1 = Db.getRecord("TMPRPT5","PID=0891308211,ZBOO,ZCOLTYP,ZCOLSUBT,ZBOTCD,ZSUBBOTCD",1)
		set ZTMP2DATA.piece("|",1) = ZBRNAME
		set ZTMP2DATA.piece("|",2) = ZCOLTYPDESC
		set ZTMP2DATA.piece("|",3) = ZCOLSUBDESC
		set ZTMP2DATA.piece("|",4) = ZSUBBOTDES
		set ZTMP2DATA.piece("|",5) = rpt1.DATA.piece("|",5)+1
		set ZTMP2DATA.piece("|",6) = rpt1.DATA.piece("|",6)+ZAMT
		set rpt1.DATA		   = ZTMP2DATA		
		do rpt1.save()
	}
	
	quit
	
ZRPT1()
	set TJD="TEST"
	type IO io1=Class.new("IO")
	set io1.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"CONV1_CBSRPT_"_TJD_".TXT"
	set io1.openParams="NEWV/WRITE"
	do io1.open()
	
	set tWRITE = "BOO"_"|"_"BOO_DESC"_"|"_"COLTYP"_"|"_"COLTYP DESC"_"|"_"COLSUBT"_"|"_"COLSUBT_DESC"_"|"_"BOTCODE"_"|"_"SUBBOTCODE"_"|"_"SUBBOTDESC"_"|"_"SUMCOL"_"|"_"SUMCOLAMT"
	do io1.write(tWRITE)	

	type DbSet ds=Db.selectDbSet("TMPRPT6","KEY1='ZRPT1'")
	while ds.next() do {
		type RecordTMPRPT6 rpt2=ds.getRecord("TMPRPT6")
		type RecordTMPRPT6 sum=Db.getRecord("TMPRPT6","PID=57069610,KEY1='SUMZRPT1',KEY2=:rpt2.key2,KEY3=:rpt2.key3,KEY4=:rpt2.key4,KEY5=:rpt2.key5,KEY6=:rpt2.key6",1)
		set THRDATA=rpt2.data
		set SUMDATA=sum.data
		
		set SUMDATA.piece("|",5) = SUMDATA.piece("|",5) + THRDATA.piece("|",5)
		set SUMDATA.piece("|",6) = SUMDATA.piece("|",6) + THRDATA.piece("|",6)
		
		set sum.data=SUMDATA
		do sum.save()
	}
	
	type DbSet ds=Db.selectDbSet("TMPRPT6","PID=57069610 AND KEY1='SUMZRPT1'")
	while ds.next() do {
		new tWRITE
		type RecordTMPRPT6 rpt2=ds.getRecord("TMPRPT6")
		set DATA=rpt2.data
		set ZBRNAME     = DATA.piece("|",1)
		set ZCOLTYPDESC = DATA.piece("|",2)
		set ZCOLSUBDESC = DATA.piece("|",3)
		set ZSUBBOTDES	= DATA.piece("|",4)
		set ZSUM	= DATA.piece("|",5)
		set ZAMT	= DATA.piece("|",6)

		set tWRITE.piece("|",1) = rpt2.key2
		set tWRITE.piece("|",2) = ZBRNAME
		set tWRITE.piece("|",3) = rpt2.key3
		set tWRITE.piece("|",4) = ZCOLTYPDESC
		set tWRITE.piece("|",5) = rpt2.key4
		set tWRITE.piece("|",6) = ZCOLSUBDESC
		set tWRITE.piece("|",7) = rpt2.key5
		set tWRITE.piece("|",8) = rpt2.key6
		set tWRITE.piece("|",9) = ZSUBBOTDES
		set tWRITE.piece("|",10) = ZSUM
		set tWRITE.piece("|",11) = ZAMT
		do io1.write(tWRITE)
	}
	do io1.close()
	
	quit
	
TESTCOUNT(inp)
	set i=$O(^ZCONV("ZCTRCTCIF",""))
	while 'i.isNull() do {
	set DATA=^ZCONV("ZCTRCTCIF",i)
	if DATA.piece(1,"|")'=inp set i=$O(^ZCONV("ZCTRCTCIF",i)) quit
	else set x=i set i="" quit
	}
	write !,x
	quit
	
FASTDEL()
	
	do Db.fastDelete("TMPRPT6","KEY1='ZRPT9'")
	do Db.fastDelete("TMPRPT2","KEY1='ZTMP3'")
	do Db.fastDelete("TMPRPT3","KEY1='ZCTRCTACN'")
	do Db.fastDelete("TMPRPT7","KEY1='ZRPT8'")
	do Db.fastDelete("TMPRPT6","KEY1='ZRPT3'")
	do Db.fastDelete("TMPRPT3","KEY1='ZCTRCTCIF'")
	do Db.fastDelete("TMPRPT3","KEY1='ZCTRCTCOL'")
	do Db.fastDelete("TMPRPT4","KEY1='ZRPT2'")
	do Db.fastDelete("TMPRPT5","KEY1='ZRPT6'")
	
	quit


ZCTRCTCIF()

	type IO io3=Class.new("IO")
	set io3.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCMSEXT_ZCTRCTCIF_"_ZEXTDAT_".TXT"
	set io3.openParams="NEWV/WRITE"
	set io3.recordSize = 1024
	do io3.open()
	set tWRITE = "ACN|CTRCT|2012-01-01-00.00.00|CONVERSION|"
	do io3.write(tWRITE)
	
	type DbSet ds3 = Db.selectDbSet("TMPRPT2","PID='ZMK'")
	while ds3.next() do {
		type RecordTMPRPT2 zcif = ds3.getRecord("TMPRPT2")
		set DATA=zcif.data
		do io3.write(DATA)
	}
	do io3.close()
	//do Db.fastDelete("TMPRPT2","PID='ZMK'")
	
	quit
		
ZREPORT3()

	do Db.fastDelete("TMPRPT2","KEY1='SUMCOL'")
	do Db.fastDelete("TMPRPT5","KEY1='SUMZRPT3'")
	
	set ZEXTDAT="TEST"
	type IO io3=Class.new("IO")
	set io3.fileName=$$TRNLNM^%ZFUNC("SCAU_SPOOL_EXTF")_"/"_"ZCBSRPT3_"_ZEXTDAT_".TXT"
	set io3.openParams="NEWV/WRITE"
	do io3.open()
	set tWRITE = "BOO|BOO_DESC|CTRTYP|CTRTYP_DESC|CTRSTATUS|CTRSTATUS_DESC|SUM_CTRCT|PRODUCTTYP|PRODCUTTYP_DESC|SUMACCT|SUMCOL"
	do io3.write(tWRITE)
	
	type DbSet dscol = Db.selectDbSet("TMPRPT2","KEY1='ZTMP3'")
	while dscol.next() do {
		type RecordTMPRPT2 col = dscol.getRecord("TMPRPT2")
		type RecordTMPRPT2 colsum = Db.getRecord("TMPRPT2","PID=:%ProcessID,KEY1='SUMCOL',KEY2=:col.key2",1)
		set SUMCOL=colsum.data
		set SUMCOL=SUMCOL+col.data
		set colsum.data=SUMCOL
		do colsum.save()
		
	}
	type DbSet ds3 = Db.selectDbSet("TMPRPT6","KEY1='ZRPT3'")
	while ds3.next() do {
		new SUMDATA,SUMCOL
		type RecordTMPRPT6 rs3 = ds3.getRecord("TMPRPT6")
		type RecordTMPRPT5 sum = Db.getRecord("TMPRPT5","PID=:%ProcessID,KEY1='SUMZRPT3',KEY2=rs3.key3,KEY3=rs3.key4,KEY4=rs3.key5,KEY5=rs3.key6",1)
		
		set SUMDATA=sum.data
		set ZDATA=rs3.data
		set CTRCT		= rs3.key2
		set ZBOO		= rs3.key3
		set ZTYP		= rs3.key4
		set ZSTAT		= rs3.key5
		set ZPROD		= rs3.key6
		set ZSUMACCT		= ZDATA.piece("|",1)
		set ZBRNAME		= ZDATA.piece("|",2)
		set ZCTRTYPDES		= ZDATA.piece("|",3)
		set ZSTATDESC		= ZDATA.piece("|",4)
		set ZPRODDESC		= ZDATA.piece("|",5)
		//type Dbset dscol = Db.getRecord("TMPRPT2","KEY1='ZTMP3'")
		
		
		set SUMDATA.piece("|",1) = ZBOO
		set SUMDATA.piece("|",2) = ZBRNAME
		set SUMDATA.piece("|",3) = ZTYP
		set SUMDATA.piece("|",4) = ZCTRTYPDES
		set SUMDATA.piece("|",5) = ZSTAT
		set SUMDATA.piece("|",6) = ZSTATDESC
		set SUMDATA.piece("|",7) = SUMDATA.piece("|",7)+1
		set SUMDATA.piece("|",8) = ZPROD
		set SUMDATA.piece("|",9) = ZPRODDESC
		set SUMDATA.piece("|",10) = SUMDATA.piece("|",10)+ZSUMACCT
		
		if 'Db.isDefined("TMPRPT2","PID=:%ProcessID,KEY1='SUMCOL',KEY2=:CTRCT") set ZSUMCOL=0		
		
		else do {
			
			type RecordTMPRPT2 getcol = Db.getRecord("TMPRPT2","PID=:%ProcessID,KEY1='SUMCOL',KEY2=:CTRCT")
			set ZSUMCOL		 = getcol.data
		
		}
		
		set SUMDATA.piece("|",11) = SUMDATA.piece("|",11)+ZSUMCOL		
		set sum.data=SUMDATA
		do sum.save()
	}
	type DbSet ds3 = Db.selectDbSet("TMPRPT5","KEY1='SUMZRPT3'")
	while ds3.next() do {
		type RecordTMPRPT5 rs3 = ds3.getRecord("TMPRPT5")
		set DATA=rs3.data
		do io3.write(DATA)
	}
	
	do io3.close()
	
	quit
	
DELRPT3()

	do Db.fastDelete("TMPRPT2","KEY1='ZTMP3'")
	do Db.fastDelete("TMPRPT2","KEY1='SUMCOL'")
	do Db.fastDelete("TMPRPT5","KEY1='SUMZRPT3'")
	
	quit
	
COUNT()	

	type ResultSet ds = Db.select("SEQ","ZCONVRPT","PID='CONTRACT'")
	while ds.next() do {
		set CTRCT=ds.getCol(1)
		type RecordZCONTRACT zcnt = Db.getRecord("ZCONTRACT","CTRCT=:CTRCT")
		set ZCTRCT 	= zcnt.CTRCT	
		set ZBOO 	= zcnt.BOO
         	set ZTYP 	= zcnt.CONTRREL
         	set ZSTAT 	= zcnt.CTRSTAT
         	
         	if (ZBOO'=1)!(ZTYP'=1)!(ZSTAT'=0) quit
        	
        	type ResultSet rs = Db.select("CID","ZCTRCTACN","CTRCT=:CTRCT")
        	while rs.next() do {
        		set ZCID=rs.getCol(1)
        		type RecordACN acn = Db.getRecord("ACN","CID=:ZCID")
        		set ZPRODTYP	= acn.type
        		if ZPRODTYP'=1001 quit
        		type RecordTMPRPT1 zmk = Db.getRecord("TMPRPT1","PID=:%ProcessID,'1001'",1)
        		set ZDATA=zmk.data
        		set ZDATA=ZDATA+1
        		set zmk.data=ZDATA
        		do zmk.save()
        	}
		
	}	
	quit  
	
	