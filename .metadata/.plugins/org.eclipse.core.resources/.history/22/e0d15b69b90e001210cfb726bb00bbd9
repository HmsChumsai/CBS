//DO NOT MODIFY  Litgation Web-Service|ZLITIGAT|||||||1

DEPINQ(input)

	do SYSVAR^SCADRV0()
	type Number ER,total,zcount,seq,EXIT,ZQUIT
	set (ER,total,zcount,seq,EXIT,ZQUIT) = 0
	type String RM,More,WHERE
	set RM = ""
	set MORE="N"
		
	set header 		= input.piece("|",1,10)	
	set FunctionFlg	 	= input.piece("|",11)	
	set Cif			= input.piece("|",12)
	set AcctId		= input.piece("|",13)
	set LastAcctId		= input.piece("|",14)
	set CurrentPage		= input.piece("|",15)
	set RecordPerPage 	= input.piece("|",16)
	set TotRec		= input.piece("|",17)
	
	if FunctionFlg="C" do {
		if Cif.isNull() set ER=1,RM="CIF Required" quit
		if 'Db.isDefined("DEP","ACN=:Cif") set ER=1,RM="Account Not Found" quit
		set WHERE="ACN=:Cif"
	}
	else do {
		if AcctId.isNull() set ER=1,RM="CID Required" quit
		if 'Db.isDefined("DEP","CID=:AcctId") set ER=1,RM="Account Not Found" quit
		set WHERE="CID=:AcctId"
	}
	
	type ResultSet rs = Db.select("CID","DEP",WHERE)
	if rs.isEmpty() quit header_"|1"
	while rs.next() do { quit:ZQUIT
		set zcount=zcount+1
		set CID=rs.getCol(1)
		type RecordDEP dep = Db.getRecord("DEP","CID=:CID")
		type String zstatdes,zgrpdes,zacnreldes
		set (zstatdes,zgrpdes,zacnreldes)=""
		if TotRec=0 do { quit:EXIT
			set seq=zcount
			set output.piece("|",1)=CID
			set output.piece("|",2)=dep.BOO
			set output.piece("|",3)=dep.cc
			set output.piece("|",4)=dep.crcd
			set output.piece("|",5)=dep.zstatcd
			
			type ResultSet zstatcd = Db.select("DES","ZUTBLSTATD","ZSTATCD=:dep.zstatcd")
			if zstatcd.next() set zstatdes=zstatcd.getCol(1)
				
			set output.piece("|",6)=zstatdes
			set output.piece("|",7)=dep.cls
			set output.piece("|",8)=dep.grp
			
			type ResultSet STBLGRP = Db.select("DES","STBLGRP","CLS=:dep.CLS AND GRP=:dep.GRP")
			if STBLGRP.next() set zgrpdes=STBLGRP.getCol(1)
			
			set output.piece("|",9)=zgrpdes
			set output.piece("|",10)=dep.acnrelc
			
			type ResultSet UTBLREL2 = Db.select("DESC","UTBLREL2","GRP=:dep.GRP AND KEY=:dep.ACNRELC")
			if UTBLREL2.next() set zacnreldes=UTBLREL2.getCol(1)
			
			set output.piece("|",11)=zacnreldes
			set output.piece("|",12)=dep.balavl
			set output.piece("|",13)=dep.bal
		
			
			if zcount=RecordPerPage set EXIT=1
		}
		else do { quit:EXIT
			if (zcount'>(CurrentPage*RecordPerPage))!(zcount>(CurrentPage+1)*RecordPerPage)) quit
			set seq=zcount
			set output.piece("|",1)=CID
			set output.piece("|",2)=dep.BOO
			set output.piece("|",3)=dep.cc
			set output.piece("|",4)=dep.crcd
			set output.piece("|",5)=dep.zstatcd
			
			type ResultSet zstatcd = Db.select("DES","ZUTBLSTATD","ZSTATCD=:dep.zstatcd")
			if zstatcd.next() set zstatdes=zstatcd.getCol(1)
				
			set output.piece("|",6)=zstatdes
			set output.piece("|",7)=dep.cls
			set output.piece("|",8)=dep.grp
			
			type ResultSet STBLGRP = Db.select("DES","STBLGRP","CLS=:dep.CLS AND GRP=:dep.GRP")
			if STBLGRP.next() set zgrpdes=STBLGRP.getCol(1)
			
			set output.piece("|",9)=zgrpdes
			set output.piece("|",10)=dep.acnrelc
			
			type ResultSet UTBLREL2 = Db.select("DESC","UTBLREL2","GRP=:dep.GRP AND KEY=:dep.ACNRELC")
			if UTBLREL2.next() set zacnreldes=UTBLREL2.getCol(1)
			
			set output.piece("|",11)=zacnreldes
			set output.piece("|",12)=dep.balavl
			set output.piece("|",13)=dep.bal
			
			if seq<zcount set MORE="Y"
			if zcount=RecordPerPage set (EXIT,ZQUIT)=1 quit
			
		}
		
		
	}
	
	if TotRec'=0 set Total = TotRec
	else set Total = zcount
	
	set output=header_"|0|"_Total_"|"_output_"|"_CID_"|"_seq_"|"_MORE
	quit output
	
LNINQ(input)

	do SYSVAR^SCADRV0()
	type Number ER,total,zcount,seq,EXIT,ZQUIT
	set (ER,total,zcount,seq,EXIT,ZQUIT) = 0
	type String RM,More
	set RM = ""
	set MORE="N"
		
	set header 		= input.piece("|",1,10)	
	set FunctionFlg	 	= input.piece("|",11)	
	set Cif			= input.piece("|",12)
	set AcctId		= input.piece("|",13)
	set LastAcctId		= input.piece("|",14)
	set CurrentPage		= input.piece("|",15)
	set RecordPerPage 	= input.piece("|",16)
	set TotRec		= input.piece("|",17)
	
	if FunctionFlg="C" do {
		if Cif.isNull() set ER=1,RM="CIF Required" quit
		if 'Db.isDefined("LN","ACN=:Cif") set ER=1,RM="Account Not Found" quit
		set WHERE="ACN=:Cif"
	}
	else do {
		if AcctId.isNull() set ER=1,RM="CID Required" quit
		if 'Db.isDefined("LN","CID=:AcctId") set ER=1,RM="Account Not Found" quit
		set WHERE="CID=:AcctId"
	}
	
	type ResultSet rs = Db.select("LN","DEP",WHERE)
	while rs.next() do {
		type String zstatdes,zgrpdes,zacnreldes,zmktdesc,ZFWOSDES,ZLEGFDES
		set (zstatdes,zgrpdes,zacnreldes,zmktdesc,ZFWOSDES,ZLEGFDES)=""
		set zcount=zcount+1
		set CID=rs.getCol(1)
		if TotRec=0 do { quit:EXIT
			type RecordLN ln = Db.getRecord("LN","CID=:CID")
			set output.piece("|",1)= CID
			set output.piece("|",2)= ln.boo
			set output.piece("|",3)= ln.CC
			set output.piece("|",4)= ln.CRCD
			set output.piece("|",5)= ln.STAT
			
			type ResultSet zstatcd = Db.select("DESC","STBLSTATL","STAT=:ln.stat")
			if zstatcd.next() set zstatdes=zstatcd.getCol(1)
			
			set output.piece("|",6)= zstatdes
			set output.piece("|",7)= ln.cls
			set output.piece("|",8)= ln.grp
			
			type ResultSet STBLGRP = Db.select("DES","STBLGRP","CLS=:ln.CLS AND GRP=:ln.GRP")
			if STBLGRP.next() set zgrpdes=STBLGRP.getCol(1)
			
			set output.piece("|",9)= zgrpdes
			set output.piece("|",10)= ln.ZMKTCD
			
			type ResultSet ZMKTCD = Db.select("DESC","ZUTBLMKTCD","GRP=:ln.grp AND SUBT=:ln.subt AND CODE=:ln.ZMKTCD")
			if ZMKTCD.next() set zmktdesc=ZMKTCD.getCol(1)
			
			set output.piece("|",11)= zmktdesc
			set output.piece("|",12)= ln.ACNRELC
			
			type ResultSet UTBLREL2 = Db.select("DESC","UTBLREL2","GRP=:ln.GRP AND KEY=:ln.ACNRELC")
			if UTBLREL2.next() set zacnreldes=UTBLREL2.getCol(1)
			
			set output.piece("|",13)= zacnreldes
			set output.piece("|",14)= ln.crlmt
			set output.piece("|",15)= ln.bal
			//set output.piece("|",16)= ln
			set output.piece("|",17)= ln.LCHG
			set output.piece("|",18)= ln.TDUE
			set output.piece("|",19)= ln.SCHSEQ
			set output.piece("|",20)= ln.DSEQ
			set output.piece("|",21)= ln.LPDT.toString("DD/MM/YEAR")
			set output.piece("|",22)= ln.ZFWOS
			type ResultSet ZFWOS = Db.select("DESC","ZUTBLWOSTAT","CODE=:ln.ZFWOS")
			if ZFWOS.next() set ZFWOSDES=ZFWOS.getCol(1)
			set output.piece("|",23)= ZFWOSDES
			set output.piece("|",24)= ln.ZRESFLG
			set output.piece("|",25)= ln.ZLEGF
			type ResultSet ZLEGF = Db.select("DESC","ZUTBLLEGAL","CODE=:ln.ZLEGF")
			if ZLEGF.next() set ZLEGFDES=ZLEGF.getCol(1)
			set output.piece("|",26)= ZLEGFDES
		
			if zcount=RecordPerPage set EXIT=1
		}
		else do { quit:EXIT
			if (zcount'>(CurrentPage*RecordPerPage))!(zcount>(CurrentPage+1)*RecordPerPage)) quit
			set seq=zcount
					type String zstatdes,zgrpdes,zacnreldes,zmktdesc,ZFWOSDES,ZLEGFDES
		set (zstatdes,zgrpdes,zacnreldes,zmktdesc,ZFWOSDES,ZLEGFDES)=""
		set zcount=zcount+1
		set CID=rs.getCol(1)
		if TotRec=0 do { quit:EXIT
			type RecordLN ln = Db.getRecord("LN","CID=:CID")
			set output.piece("|",1)= CID
			set output.piece("|",2)= ln.boo
			set output.piece("|",3)= ln.CC
			set output.piece("|",4)= ln.CRCD
			set output.piece("|",5)= ln.STAT
			
			type ResultSet zstatcd = Db.select("DESC","STBLSTATL","STAT=:ln.stat")
			if zstatcd.next() set zstatdes=zstatcd.getCol(1)
			
			set output.piece("|",6)= zstatdes
			set output.piece("|",7)= ln.cls
			set output.piece("|",8)= ln.grp
			
			type ResultSet STBLGRP = Db.select("DES","STBLGRP","CLS=:ln.CLS AND GRP=:ln.GRP")
			if STBLGRP.next() set zgrpdes=STBLGRP.getCol(1)
			
			set output.piece("|",9)= zgrpdes
			set output.piece("|",10)= ln.ZMKTCD
			
			type ResultSet ZMKTCD = Db.select("DESC","ZUTBLMKTCD","GRP=:ln.grp AND SUBT=:ln.subt AND CODE=:ln.ZMKTCD")
			if ZMKTCD.next() set zmktdesc=ZMKTCD.getCol(1)
			
			set output.piece("|",11)= zmktdesc
			set output.piece("|",12)= ln.ACNRELC
			
			type ResultSet UTBLREL2 = Db.select("DESC","UTBLREL2","GRP=:ln.GRP AND KEY=:ln.ACNRELC")
			if UTBLREL2.next() set zacnreldes=UTBLREL2.getCol(1)
			
			set output.piece("|",13)= zacnreldes
			set output.piece("|",14)= ln.crlmt
			set output.piece("|",15)= ln.bal
			//set output.piece("|",16)= ln
			set output.piece("|",17)= ln.LCHG
			set output.piece("|",18)= ln.TDUE
			set output.piece("|",19)= ln.SCHSEQ
			set output.piece("|",20)= ln.DSEQ
			set output.piece("|",21)= ln.LPDT.toString("DD/MM/YEAR")
			set output.piece("|",22)= ln.ZFWOS
			type ResultSet ZFWOS = Db.select("DESC","ZUTBLWOSTAT","CODE=:ln.ZFWOS")
			if ZFWOS.next() set ZFWOSDES=ZFWOS.getCol(1)
			set output.piece("|",23)= ZFWOSDES
			set output.piece("|",24)= ln.ZRESFLG
			set output.piece("|",25)= ln.ZLEGF
			type ResultSet ZLEGF = Db.select("DESC","ZUTBLLEGAL","CODE=:ln.ZLEGF")
			if ZLEGF.next() set ZLEGFDES=ZLEGF.getCol(1)
			set output.piece("|",26)= ZLEGFDES
			
			if seq<zcount set MORE="Y"
			if zcount=RecordPerPage set (EXIT,ZQUIT)=1 quit
			
		}
		
		
	}
	
	if TotRec'=0 set Total = TotRec
	else set Total = zcount
	
	set output=header_"|0|"_Total_"|"_output_"|"_CID_"|"_seq_"|"_MORE
	quit output
	
	
	